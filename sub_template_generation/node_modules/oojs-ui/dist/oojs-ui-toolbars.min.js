/*! OOUI v0.51.6 | http://oojs.mit-license.org */
!function(u){"use strict";u.ui.Toolbar=function(o,t,i){u.isPlainObject(o)&&void 0===i&&(o=(i=o).toolFactory,t=i.toolGroupFactory),u.ui.Toolbar.super.call(this,i=i||{}),u.EventEmitter.call(this),u.ui.mixin.GroupElement.call(this,i),this.toolFactory=o,this.toolGroupFactory=t,this.groupsByName={},this.activeToolGroups=0,this.tools={},this.position=i.position||"top",this.$bar=$("<div>"),this.$after=$("<div>"),this.$actions=$("<div>"),this.$popups=$("<div>"),this.initialized=!1,this.narrow=!1,this.narrowThreshold=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$overlay=(!0===i.$overlay?u.ui.getDefaultOverlay():i.$overlay)||this.$element,this.$element.add(this.$bar).add(this.$group).add(this.$after).add(this.$actions).on("mousedown keydown",this.onPointerDown.bind(this)),this.$bar.addClass("oo-ui-toolbar-bar"),this.$group.addClass("oo-ui-toolbar-tools"),this.$after.addClass("oo-ui-toolbar-tools oo-ui-toolbar-after"),this.$popups.addClass("oo-ui-toolbar-popups"),this.$bar.append(this.$group,this.$after),i.actions&&this.$bar.append(this.$actions.addClass("oo-ui-toolbar-actions")),this.$bar.append($("<div>").css("clear","both")),this.$element.addClass("oo-ui-toolbar oo-ui-toolbar-position-"+this.position).append(this.$bar),this.$overlay.append(this.$popups)},u.inheritClass(u.ui.Toolbar,u.ui.Element),u.mixinClass(u.ui.Toolbar,u.EventEmitter),u.mixinClass(u.ui.Toolbar,u.ui.mixin.GroupElement),u.ui.Toolbar.prototype.getToolFactory=function(){return this.toolFactory},u.ui.Toolbar.prototype.getToolGroupFactory=function(){return this.toolGroupFactory},u.ui.Toolbar.prototype.insertItemElements=function(o){u.ui.mixin.GroupElement.prototype.insertItemElements.apply(this,arguments),"after"===o.align&&this.$after.append(o.$element)},u.ui.Toolbar.prototype.onPointerDown=function(o){var o=$(o.target).closest(".oo-ui-widget"),t=this.$element.closest(".oo-ui-widget");if(!o.length||o[0]===t[0])return!1},u.ui.Toolbar.prototype.onWindowResize=function(){this.setNarrow(this.$bar[0].clientWidth<=this.getNarrowThreshold())},u.ui.Toolbar.prototype.isNarrow=function(){return this.narrow},u.ui.Toolbar.prototype.setNarrow=function(o){o!==this.narrow&&(this.narrow=o,this.$element.add(this.$popups).toggleClass("oo-ui-toolbar-narrow",this.narrow),this.emit("resize"))},u.ui.Toolbar.prototype.getNarrowThreshold=function(){return null===this.narrowThreshold&&(this.narrowThreshold=this.$group[0].offsetWidth+this.$after[0].offsetWidth+this.$actions[0].offsetWidth),this.narrowThreshold},u.ui.Toolbar.prototype.initialize=function(){this.initialized||(this.initialized=!0,$(this.getElementWindow()).on("resize",this.onWindowResizeHandler),this.onWindowResize())},u.ui.Toolbar.prototype.setup=function(i){this.reset();var e=[];for(let o=0,t=i.length;o<t;o++){var s=i[o],l=("*"===s.include&&(void 0===s.type&&(s.type="list"),void 0===s.label)&&(s.label=u.ui.msg("ooui-toolbar-more")),this.getToolGroupFactory().lookup(s.type)?s.type:"bar"),l=this.getToolGroupFactory().create(l,this,s);e.push(l),(this.groupsByName[s.name]=l).connect(this,{active:"onToolGroupActive"})}this.addItems(e)},u.ui.Toolbar.prototype.onToolGroupActive=function(o){o?(this.activeToolGroups++,1===this.activeToolGroups&&this.emit("active",!0)):(this.activeToolGroups--,0===this.activeToolGroups&&this.emit("active",!1))},u.ui.Toolbar.prototype.getToolGroupByName=function(o){return this.groupsByName[o]||null},u.ui.Toolbar.prototype.reset=function(){this.groupsByName={},this.tools={};for(let o=0,t=this.items.length;o<t;o++)this.items[o].destroy();this.clearItems()},u.ui.Toolbar.prototype.destroy=function(){$(this.getElementWindow()).off("resize",this.onWindowResizeHandler),this.reset(),this.$element.remove()},u.ui.Toolbar.prototype.isToolAvailable=function(o){return!this.tools[o]},u.ui.Toolbar.prototype.reserveTool=function(o){this.tools[o.getName()]=o},u.ui.Toolbar.prototype.releaseTool=function(o){delete this.tools[o.getName()]},u.ui.Toolbar.prototype.getToolAccelerator=function(){},u.ui.Tool=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolGroup),u.ui.Tool.super.call(this,t=t||{}),this.toolGroup=o,this.toolbar=this.toolGroup.getToolbar(),this.active=!1,this.$title=$("<span>"),this.$accel=$("<span>"),this.$link=$("<a>"),this.title=null,this.checkIcon=new u.ui.IconWidget({icon:"check",classes:["oo-ui-tool-checkIcon"]}),this.displayBothIconAndLabel=(void 0!==t.displayBothIconAndLabel?t:this.constructor.static).displayBothIconAndLabel,this.narrowConfig=t.narrowConfig||this.constructor.static.narrowConfig,u.ui.mixin.IconElement.call(this,t),u.ui.mixin.FlaggedElement.call(this,t),u.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$link},t)),this.toolbar.connect(this,{updateState:"onUpdateState",resize:"onToolbarResize"}),this.$title.addClass("oo-ui-tool-title"),this.$accel.addClass("oo-ui-tool-accel").prop({dir:"ltr",lang:"en"}),this.$link.addClass("oo-ui-tool-link").append(this.checkIcon.$element,this.$icon,this.$title,this.$accel).attr("role","button"),u.ui.isMobile()||this.$link.append(this.$accel),this.$element.data("oo-ui-tool",this).addClass("oo-ui-tool").addClass("oo-ui-tool-name-"+this.constructor.static.name.replace(/^([^/]+)\/([^/]+).*$/,"$1-$2")).append(this.$link),this.setTitle(t.title||this.constructor.static.title)},u.inheritClass(u.ui.Tool,u.ui.Widget),u.mixinClass(u.ui.Tool,u.ui.mixin.IconElement),u.mixinClass(u.ui.Tool,u.ui.mixin.FlaggedElement),u.mixinClass(u.ui.Tool,u.ui.mixin.TabIndexedElement),u.ui.Tool.static.tagName="span",u.ui.Tool.static.name="",u.ui.Tool.static.group="",u.ui.Tool.static.title="",u.ui.Tool.static.displayBothIconAndLabel=!1,u.ui.Tool.static.autoAddToCatchall=!0,u.ui.Tool.static.autoAddToGroup=!0,u.ui.Tool.static.isCompatibleWith=function(){return!1},u.ui.Tool.static.narrowConfig=null,u.ui.Tool.prototype.onUpdateState=null,u.ui.Tool.prototype.onSelect=null,u.ui.Tool.prototype.isActive=function(){return this.active},u.ui.Tool.prototype.setActive=function(o){this.active=!!o,this.$element.toggleClass("oo-ui-tool-active",this.active),this.updateThemeClasses()},u.ui.Tool.prototype.setTitle=function(o){return this.title=u.ui.resolveMsg(o),this.updateTitle(),this.setDisplayBothIconAndLabel(this.displayBothIconAndLabel),this},u.ui.Tool.prototype.setDisplayBothIconAndLabel=function(o){return this.displayBothIconAndLabel=o,this.$element.toggleClass("oo-ui-tool-with-label",!!this.title&&this.displayBothIconAndLabel),this},u.ui.Tool.prototype.getTitle=function(){return this.title},u.ui.Tool.prototype.getName=function(){return this.constructor.static.name},u.ui.Tool.prototype.onToolbarResize=function(){this.narrowConfig&&(this.toolbar.isNarrow()?(void 0!==this.narrowConfig.displayBothIconAndLabel&&(this.wideDisplayBothIconAndLabel=this.displayBothIconAndLabel,this.setDisplayBothIconAndLabel(this.narrowConfig.displayBothIconAndLabel)),void 0!==this.narrowConfig.title&&(this.wideTitle=this.title,this.setTitle(this.narrowConfig.title)),void 0!==this.narrowConfig.icon&&(this.wideIcon=this.icon,this.setIcon(this.narrowConfig.icon))):(void 0!==this.wideDisplayBothIconAndLabel&&this.setDisplayBothIconAndLabel(this.wideDisplayBothIconAndLabel),void 0!==this.wideTitle&&this.setTitle(this.wideTitle),void 0!==this.wideIcon&&this.setIcon(this.wideIcon)))},u.ui.Tool.prototype.updateTitle=function(){var o=this.toolGroup.constructor.static.titleTooltips,t=this.toolGroup.constructor.static.accelTooltips,i=this.toolbar.getToolAccelerator(this.constructor.static.name),e=[];this.$title.text(this.title),this.$accel.text(i),o&&"string"==typeof this.title&&this.title.length&&e.push(this.title),t&&"string"==typeof i&&i.length&&e.push(i),e.length?this.$link.attr("title",e.join(" ")):this.$link.removeAttr("title")},u.ui.Tool.prototype.setIcon=function(o){return u.ui.mixin.IconElement.prototype.setIcon.call(this,o),this.$element.toggleClass("oo-ui-tool-with-icon",!!this.icon),this},u.ui.Tool.prototype.destroy=function(){this.toolbar.disconnect(this),this.$element.remove()},u.ui.ToolGroup=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolbar),u.ui.ToolGroup.super.call(this,t=t||{}),u.ui.mixin.GroupElement.call(this,t),this.toolbar=o,this.tools={},this.pressed=null,this.autoDisabled=!1,this.include=t.include||[],this.exclude=t.exclude||[],this.promote=t.promote||[],this.demote=t.demote||[],this.align=t.align||"before",this.onDocumentMouseKeyUpHandler=this.onDocumentMouseKeyUp.bind(this),this.$group.on({mousedown:this.onMouseKeyDown.bind(this),mouseup:this.onMouseKeyUp.bind(this),keydown:this.onMouseKeyDown.bind(this),keyup:this.onMouseKeyUp.bind(this),focus:this.onMouseOverFocus.bind(this),blur:this.onMouseOutBlur.bind(this),mouseover:this.onMouseOverFocus.bind(this),mouseout:this.onMouseOutBlur.bind(this)}),this.toolbar.getToolFactory().connect(this,{register:"onToolFactoryRegister"}),this.aggregate({disable:"itemDisable"}),this.connect(this,{itemDisable:"updateDisabled",disable:"onDisable"}),this.$group.addClass("oo-ui-toolGroup-tools"),this.$element.addClass("oo-ui-toolGroup").append(this.$group),this.onDisable(this.isDisabled()),this.populate()},u.inheritClass(u.ui.ToolGroup,u.ui.Widget),u.mixinClass(u.ui.ToolGroup,u.ui.mixin.GroupElement),u.ui.ToolGroup.static.titleTooltips=!1,u.ui.ToolGroup.static.accelTooltips=!1,u.ui.ToolGroup.static.autoDisable=!0,u.ui.ToolGroup.static.name=null,u.ui.ToolGroup.prototype.isDisabled=function(){return this.autoDisabled||u.ui.ToolGroup.super.prototype.isDisabled.apply(this,arguments)},u.ui.ToolGroup.prototype.updateDisabled=function(){let t=!0;if(this.constructor.static.autoDisable){for(let o=this.items.length-1;0<=o;o--)if(!this.items[o].isDisabled()){t=!1;break}this.autoDisabled=t}u.ui.ToolGroup.super.prototype.updateDisabled.apply(this,arguments)},u.ui.ToolGroup.prototype.onDisable=function(o){this.$group.toggleClass("oo-ui-toolGroup-disabled-tools",o),this.$group.toggleClass("oo-ui-toolGroup-enabled-tools",!o)},u.ui.ToolGroup.prototype.onMouseKeyDown=function(o){if(!this.isDisabled()&&(o.which===u.ui.MouseButtons.LEFT||o.which===u.ui.Keys.SPACE||o.which===u.ui.Keys.ENTER)&&(this.pressed=this.findTargetTool(o),this.pressed))return this.pressed.setActive(!0),this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onDocumentMouseKeyUpHandler,!0),!1},u.ui.ToolGroup.prototype.onDocumentMouseKeyUp=function(o){this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onDocumentMouseKeyUpHandler,!0),this.onMouseKeyUp(o)},u.ui.ToolGroup.prototype.onMouseKeyUp=function(o){var t=this.findTargetTool(o);this.isDisabled()||!this.pressed||this.pressed!==t||o.which!==u.ui.MouseButtons.LEFT&&o.which!==u.ui.Keys.SPACE&&o.which!==u.ui.Keys.ENTER||(this.pressed.onSelect(),this.pressed=null,o.preventDefault(),o.stopPropagation()),this.pressed=null},u.ui.ToolGroup.prototype.onMouseOverFocus=function(o){o=this.findTargetTool(o);this.pressed&&this.pressed===o&&this.pressed.setActive(!0)},u.ui.ToolGroup.prototype.onMouseOutBlur=function(o){o=this.findTargetTool(o);this.pressed&&this.pressed===o&&this.pressed.setActive(!1)},u.ui.ToolGroup.prototype.findTargetTool=function(o){o=$(o.target).closest(".oo-ui-tool-link");let t;return(t=o.length?o.parent().data("oo-ui-tool"):t)&&!t.isDisabled()?t:null},u.ui.ToolGroup.prototype.onToolFactoryRegister=function(){this.populate()},u.ui.ToolGroup.prototype.getToolbar=function(){return this.toolbar},u.ui.ToolGroup.prototype.populate=function(){var i=this.toolbar.getToolFactory(),e={},s=[],o=[],l=this.toolbar.getToolFactory().getTools(this.include,this.exclude,this.promote,this.demote);let n;for(let o=0,t=l.length;o<t;o++)if(n=l[o],i.lookup(n)&&(this.toolbar.isToolAvailable(n)||this.tools[n])){this.toolbar.tools[n]=!0;let o=this.tools[n];o||(this.tools[n]=o=i.create(n,this),o.updateTitle()),this.toolbar.reserveTool(o),s.push(o),e[n]=!0}for(n in this.tools)e[n]||(this.tools[n].destroy(),this.toolbar.releaseTool(this.tools[n]),o.push(this.tools[n]),delete this.tools[n]);o.length&&this.removeItems(o),this.$element.toggleClass("oo-ui-toolGroup-empty",!s.length),this.addItems(s),this.updateDisabled()},u.ui.ToolGroup.prototype.destroy=function(){this.clearItems(),this.toolbar.getToolFactory().disconnect(this);for(const o in this.tools)this.toolbar.releaseTool(this.tools[o]),this.tools[o].disconnect(this).destroy(),delete this.tools[o];this.$element.remove()},u.ui.ToolFactory=function(){u.ui.ToolFactory.super.call(this)},u.inheritClass(u.ui.ToolFactory,u.Factory),u.ui.ToolFactory.prototype.getTools=function(o,t,i,e){var s=[],l={},n=u.simpleArrayDifference(this.extract(o),this.extract(t)),o=this.extract(i,l),t=this.extract(e,l);for(let o=0,t=n.length;o<t;o++)l[n[o]]||s.push(n[o]);return o.concat(s).concat(t)},u.ui.ToolFactory.prototype.extract=function(s,l){var n=[];for(let e=0,o=(s=Array.isArray(s)?s:[s]).length;e<o;e++){let o=s[e],t,i;if("*"===o)for(t in this.registry)!(i=this.registry[t]).static.autoAddToCatchall||l&&l[t]||(n.push(t),l&&(l[t]=!0));else if("string"==typeof o&&(o={name:o}),u.isPlainObject(o))if(o.group)for(t in this.registry)(i=this.registry[t]).static.group!==o.group||!i.static.autoAddToGroup||l&&l[t]||(n.push(t),l&&(l[t]=!0));else!o.name||l&&l[o.name]||(n.push(o.name),l&&(l[o.name]=!0))}return n},u.ui.ToolGroupFactory=function(){u.Factory.call(this);var i=this.constructor.static.getDefaultClasses();for(let o=0,t=i.length;o<t;o++)this.register(i[o])},u.inheritClass(u.ui.ToolGroupFactory,u.Factory),u.ui.ToolGroupFactory.static.getDefaultClasses=function(){return[u.ui.BarToolGroup,u.ui.ListToolGroup,u.ui.MenuToolGroup]},u.ui.PopupTool=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolGroup),u.ui.PopupTool.super.call(this,o,t),u.ui.mixin.PopupElement.call(this,t),this.popup.connect(this,{toggle:"onPopupToggle"}),this.popup.setAutoFlip(!1),this.popup.setPosition("bottom"===o.getToolbar().position?"above":"below"),this.$element.addClass("oo-ui-popupTool"),this.popup.$element.addClass("oo-ui-popupTool-popup"),this.toolbar.$popups.append(this.popup.$element)},u.inheritClass(u.ui.PopupTool,u.ui.Tool),u.mixinClass(u.ui.PopupTool,u.ui.mixin.PopupElement),u.ui.PopupTool.prototype.onSelect=function(){return this.isDisabled()||this.popup.toggle(),!1},u.ui.PopupTool.prototype.onUpdateState=function(){},u.ui.PopupTool.prototype.onPopupToggle=function(o){this.setActive(o),this.toolGroup.emit("active",o)},u.ui.ToolGroupTool=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolGroup),u.ui.ToolGroupTool.super.call(this,o,t),this.innerToolGroup=this.createGroup(this.constructor.static.groupConfig),this.innerToolGroup.connect(this,{disable:"onToolGroupDisable",active:this.toolGroup.emit.bind(this.toolGroup,"active")}),this.$link.remove(),this.$element.addClass("oo-ui-toolGroupTool").append(this.innerToolGroup.$element)},u.inheritClass(u.ui.ToolGroupTool,u.ui.Tool),u.ui.ToolGroupTool.static.groupConfig={},u.ui.ToolGroupTool.prototype.onSelect=function(){return this.innerToolGroup.setActive(!this.innerToolGroup.active),!1},u.ui.ToolGroupTool.prototype.onToolGroupDisable=function(o){this.setDisabled(o)},u.ui.ToolGroupTool.prototype.onUpdateState=function(){this.setActive(!1)},u.ui.ToolGroupTool.prototype.createGroup=function(o){return"*"===o.include&&void 0===o.label&&(o.label=u.ui.msg("ooui-toolbar-more")),this.toolbar.getToolGroupFactory().create("list",this.toolbar,o)},u.ui.BarToolGroup=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolbar),u.ui.BarToolGroup.super.call(this,o,t),this.$element.addClass("oo-ui-barToolGroup"),this.$group.addClass("oo-ui-barToolGroup-tools")},u.inheritClass(u.ui.BarToolGroup,u.ui.ToolGroup),u.ui.BarToolGroup.static.titleTooltips=!0,u.ui.BarToolGroup.static.accelTooltips=!0,u.ui.BarToolGroup.static.name="bar",u.ui.PopupToolGroup=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolbar),t=Object.assign({indicator:void 0===t.indicator?"bottom"===o.position?"up":"down":t.indicator},t),u.ui.PopupToolGroup.super.call(this,o,t),this.active=!1,this.dragging=!1,this.onPopupDocumentMouseKeyUpHandler=this.onPopupDocumentMouseKeyUp.bind(this),this.$handle=$("<span>"),this.narrowConfig=t.narrowConfig||this.constructor.static.narrowConfig,u.ui.mixin.IconElement.call(this,t),u.ui.mixin.IndicatorElement.call(this,t),u.ui.mixin.LabelElement.call(this,t),u.ui.mixin.TitledElement.call(this,t),u.ui.mixin.FlaggedElement.call(this,t),u.ui.mixin.ClippableElement.call(this,Object.assign({$clippable:this.$group},t)),u.ui.mixin.FloatableElement.call(this,Object.assign({$floatable:this.$group,$floatableContainer:this.$handle,hideWhenOutOfView:!1,verticalPosition:"bottom"===this.toolbar.position?"above":"below"},t)),u.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$handle},t)),this.$handle.on({keydown:this.onHandleMouseKeyDown.bind(this),keyup:this.onHandleMouseKeyUp.bind(this),mousedown:this.onHandleMouseKeyDown.bind(this),mouseup:this.onHandleMouseKeyUp.bind(this)}),this.toolbar.connect(this,{resize:"onToolbarResize"}),this.$handle.addClass("oo-ui-popupToolGroup-handle").attr({role:"button","aria-expanded":"false"}).append(this.$icon,this.$label,this.$indicator),void 0!==t.header&&this.$group.prepend($("<span>").addClass("oo-ui-popupToolGroup-header").text(t.header)),this.$element.addClass("oo-ui-popupToolGroup").prepend(this.$handle),this.$group.addClass("oo-ui-popupToolGroup-tools"),this.toolbar.$popups.append(this.$group)},u.inheritClass(u.ui.PopupToolGroup,u.ui.ToolGroup),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.IconElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.IndicatorElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.LabelElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.TitledElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.FlaggedElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.ClippableElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.FloatableElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.TabIndexedElement),u.ui.PopupToolGroup.static.narrowConfig=null,u.ui.PopupToolGroup.prototype.setDisabled=function(){u.ui.PopupToolGroup.super.prototype.setDisabled.apply(this,arguments),this.isDisabled()&&this.isElementAttached()&&this.setActive(!1)},u.ui.PopupToolGroup.prototype.onToolbarResize=function(){this.narrowConfig&&(this.toolbar.isNarrow()?(void 0!==this.narrowConfig.invisibleLabel&&(this.wideInvisibleLabel=this.invisibleLabel,this.setInvisibleLabel(this.narrowConfig.invisibleLabel)),void 0!==this.narrowConfig.label&&(this.wideLabel=this.label,this.setLabel(this.narrowConfig.label)),void 0!==this.narrowConfig.icon&&(this.wideIcon=this.icon,this.setIcon(this.narrowConfig.icon))):(void 0!==this.wideInvisibleLabel&&this.setInvisibleLabel(this.wideInvisibleLabel),void 0!==this.wideLabel&&this.setLabel(this.wideLabel),void 0!==this.wideIcon&&this.setIcon(this.wideIcon)))},u.ui.PopupToolGroup.prototype.onPopupDocumentMouseKeyUp=function(o){o=$(o.target);o.closest(".oo-ui-popupToolGroup")[0]!==this.$element[0]&&o.closest(".oo-ui-popupToolGroup-tools")[0]!==this.$group[0]&&this.setActive(!1)},u.ui.PopupToolGroup.prototype.onMouseKeyUp=function(o){return this.isDisabled()||!this.pressed||this.pressed!==this.findTargetTool(o)||o.which!==u.ui.MouseButtons.LEFT&&o.which!==u.ui.Keys.SPACE&&o.which!==u.ui.Keys.ENTER||this.setActive(!1),u.ui.PopupToolGroup.super.prototype.onMouseKeyUp.call(this,o)},u.ui.PopupToolGroup.prototype.onMouseKeyDown=function(o){if(!this.isDisabled()&&o.which===u.ui.Keys.TAB){var t=$(document.activeElement),i=u.ui.findFocusable(this.$group);if(t[0]===i[0]&&o.shiftKey)return this.$handle.trigger("focus"),!1;i=u.ui.findFocusable(this.$group,!0);t[0]!==i[0]||o.shiftKey||(this.$handle.trigger("focus"),this.setActive(!1))}return u.ui.PopupToolGroup.super.prototype.onMouseKeyDown.call(this,o)},u.ui.PopupToolGroup.prototype.onHandleMouseKeyUp=function(o){if(!this.isDisabled()&&(o.which===u.ui.MouseButtons.LEFT||o.which===u.ui.Keys.SPACE||o.which===u.ui.Keys.ENTER))return!1},u.ui.PopupToolGroup.prototype.onHandleMouseKeyDown=function(o){var t;if(!this.isDisabled())return o.which===u.ui.Keys.TAB&&!o.shiftKey&&(t=u.ui.findFocusable(this.$group)).length?(t.trigger("focus"),!1):o.which===u.ui.MouseButtons.LEFT||o.which===u.ui.Keys.SPACE||o.which===u.ui.Keys.ENTER?(this.setActive(!this.active),!1):void 0},u.ui.PopupToolGroup.prototype.isActive=function(){return this.active},u.ui.PopupToolGroup.prototype.setActive=function(o){var t,i;this.active!==(o=!!o)&&((this.active=o)?(this.getElementDocument().addEventListener("mouseup",this.onPopupDocumentMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onPopupDocumentMouseKeyUpHandler,!0),this.$clippable.css({left:"",width:"","margin-left":"","min-width":""}),this.$element.addClass("oo-ui-popupToolGroup-active"),this.$group.addClass("oo-ui-popupToolGroup-active-tools"),this.$handle.attr("aria-expanded",!0),this.togglePositioning(!0),this.toggleClipping(!0),o="before"===this.align?"start":"end",i="before"===this.align?"end":"start",this.setHorizontalPosition(o),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.setHorizontalPosition(i),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.setHorizontalPosition("center"),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&(t=(i=this.$clippableScrollableContainer[0]===document.documentElement)?document.documentElement.clientWidth:this.$clippableScrollableContainer.width(),i=i?0:this.$clippableScrollableContainer.offset().left,this.toggleClipping(!1),this.setHorizontalPosition(o),this.$clippable.css({"margin-left":-(this.$element.offset().left-i),width:t,"min-width":t}))):(this.getElementDocument().removeEventListener("mouseup",this.onPopupDocumentMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onPopupDocumentMouseKeyUpHandler,!0),this.$element.removeClass("oo-ui-popupToolGroup-active"),this.$group.removeClass("oo-ui-popupToolGroup-active-tools"),this.$handle.attr("aria-expanded",!1),this.togglePositioning(!1),this.toggleClipping(!1)),this.emit("active",this.active),this.updateThemeClasses())},u.ui.ListToolGroup=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolbar),this.allowCollapse=(t=t||{}).allowCollapse,this.forceExpand=t.forceExpand,this.expanded=!!t.expanded,this.collapsibleTools=[],u.ui.ListToolGroup.super.call(this,o,t),this.$element.addClass("oo-ui-listToolGroup"),this.$group.addClass("oo-ui-listToolGroup-tools")},u.inheritClass(u.ui.ListToolGroup,u.ui.PopupToolGroup),u.ui.ListToolGroup.static.name="list",u.ui.ListToolGroup.prototype.populate=function(){u.ui.ListToolGroup.super.prototype.populate.call(this);let i=[];void 0!==this.allowCollapse?i=this.allowCollapse:void 0!==this.forceExpand&&(i=u.simpleArrayDifference(Object.keys(this.tools),this.forceExpand)),this.collapsibleTools=[];for(let o=0,t=i.length;o<t;o++)void 0!==this.tools[i[o]]&&this.collapsibleTools.push(this.tools[i[o]]);this.$group.append(this.getExpandCollapseTool().$element),this.getExpandCollapseTool().toggle(0!==this.collapsibleTools.length),this.updateCollapsibleState()},u.ui.ListToolGroup.prototype.getExpandCollapseTool=function(){if(void 0===this.expandCollapseTool){const o=function(){o.super.apply(this,arguments)};u.inheritClass(o,u.ui.Tool),o.prototype.onSelect=function(){this.toolGroup.expanded=!this.toolGroup.expanded,this.toolGroup.updateCollapsibleState(),this.setActive(!1)},o.prototype.onUpdateState=function(){},o.static.name="more-fewer",this.expandCollapseTool=new o(this)}return this.expandCollapseTool},u.ui.ListToolGroup.prototype.onMouseKeyUp=function(o){return(!$(o.target).closest(".oo-ui-tool-name-more-fewer").length||o.which!==u.ui.MouseButtons.LEFT&&o.which!==u.ui.Keys.SPACE&&o.which!==u.ui.Keys.ENTER?u.ui.ListToolGroup:u.ui.ListToolGroup.super).super.prototype.onMouseKeyUp.call(this,o)},u.ui.ListToolGroup.prototype.updateCollapsibleState=function(){var o="bottom"===this.toolbar.position,o=this.expanded===o?"expand":"collapse";this.getExpandCollapseTool().setIcon(o).setTitle(u.ui.msg(this.expanded?"ooui-toolgroup-collapse":"ooui-toolgroup-expand"));for(let o=0;o<this.collapsibleTools.length;o++)this.collapsibleTools[o].toggle(this.expanded);this.clip()},u.ui.MenuToolGroup=function(o,t){u.isPlainObject(o)&&void 0===t&&(o=(t=o).toolbar),u.ui.MenuToolGroup.super.call(this,o,t=t||{}),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$element.addClass("oo-ui-menuToolGroup"),this.$group.addClass("oo-ui-menuToolGroup-tools")},u.inheritClass(u.ui.MenuToolGroup,u.ui.PopupToolGroup),u.ui.MenuToolGroup.static.name="menu",u.ui.MenuToolGroup.prototype.onUpdateState=function(){var o=[];for(const t in this.tools)this.tools[t].isActive()&&o.push(this.tools[t].getTitle());this.setLabel(o.join(", ")||" ")}}(OO);
//# sourceMappingURL=oojs-ui-toolbars.min.js.map