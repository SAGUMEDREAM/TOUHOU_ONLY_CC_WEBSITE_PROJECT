/*! OOUI v0.51.6 | http://oojs.mit-license.org */
!function(a){"use strict";a.ui.ActionWidget=function(t){t=Object.assign({framed:!1},t),a.ui.ActionWidget.super.call(this,t),a.ui.mixin.PendingElement.call(this,t),this.action=t.action||"",this.modes=t.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},a.inheritClass(a.ui.ActionWidget,a.ui.ButtonWidget),a.mixinClass(a.ui.ActionWidget,a.ui.mixin.PendingElement),a.ui.ActionWidget.prototype.hasMode=function(t){return-1!==this.modes.indexOf(t)},a.ui.ActionWidget.prototype.getAction=function(){return this.action},a.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},a.ui.ActionSet=function(t){a.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},a.mixinClass(a.ui.ActionSet,a.EventEmitter),a.ui.ActionSet.static.specialFlags=["safe","primary"],a.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},a.ui.ActionSet.prototype.isSpecial=function(t){for(const e in this.special)if(t===this.special[e])return!0;return!1},a.ui.ActionSet.prototype.get=function(s){if(s){this.organize();let e,i;var n=[];for(const a in this.categorized){let t=s[a];if(t)for(Array.isArray(t)||(t=[t]),e=0,i=t.length;e<i;e++){var r=this.categorized[a][t[e]];Array.isArray(r)&&n.push.apply(n,r)}}let o;for(e=0,i=n.length;e<i;e++)o=n[e],(void 0!==s.visible&&o.isVisible()!==s.visible||void 0!==s.disabled&&o.isDisabled()!==s.disabled)&&(n.splice(e,1),i--,e--);for(e=0,i=n.length;e<i;e++){o=n[e];let t=n.lastIndexOf(o);for(;t!==e;)n.splice(t,1),i--,t=n.lastIndexOf(o)}return n}return this.list.slice()},a.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),Object.assign({},this.special)},a.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},a.ui.ActionSet.prototype.setMode=function(i){this.changing=!0;for(let t=0,e=this.list.length;t<e;t++){var o=this.list[t];o.toggle(o.hasMode(i))}return this.organized=!1,this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.setAbilities=function(i){for(let t=0,e=this.list.length;t<e;t++){var o=this.list[t],s=o.getAction();void 0!==i[s]&&o.setDisabled(!i[s])}return this},a.ui.ActionSet.prototype.forEach=function(t,e){return this.changed=!1,this.changing=!0,this.get(t).forEach(e),this.changing=!1,this.changed&&this.emit("change"),this},a.ui.ActionSet.prototype.add=function(i){this.changing=!0;for(let t=0,e=i.length;t<e;t++){var o=i[t];o.connect(this,{click:["emit","click",o],toggle:["onActionChange"]}),this.list.push(o)}return this.organized=!1,this.emit("add",i),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.remove=function(i){this.changing=!0;for(let t=0,e=i.length;t<e;t++){var o=i[t],s=this.list.indexOf(o);-1!==s&&(o.disconnect(this),this.list.splice(s,1))}return this.organized=!1,this.emit("remove",i),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.clear=function(){var t=this.list.slice();this.changing=!0;for(let t=0,e=this.list.length;t<e;t++)this.list[t].disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",t),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.organize=function(){var o=this.constructor.static.specialFlags;if(!this.organized){this.categorized={},this.special={},this.others=[];for(let t=0,e=this.list.length;t<e;t++){var s=this.list[t];let e,i;for(const a in this.categories){this.categorized[a]||(this.categorized[a]={});let t=s[this.categories[a]]();for(Array.isArray(t)||(t=[t]),e=0,i=t.length;e<i;e++){var n=t[e];this.categorized[a][n]||(this.categorized[a][n]=[]),this.categorized[a][n].push(s)}}if(s.isVisible()){let t=!1;for(e=0,i=o.length;e<i;e++){var r=o[e];if(!this.special[r]&&s.hasFlag(r)){this.special[r]=s,t=!0;break}}t||this.others.push(s)}}this.organized=!0}return this},a.ui.Error=function(t,e){a.isPlainObject(t)&&void 0===e&&(t=(e=t).message),e=e||{},this.message=t instanceof $?t:String(t),this.recoverable=void 0===e.recoverable||!!e.recoverable,this.warning=!!e.warning},a.initClass(a.ui.Error),a.ui.Error.prototype.isRecoverable=function(){return this.recoverable},a.ui.Error.prototype.isWarning=function(){return this.warning},a.ui.Error.prototype.getMessage=function(){return this.message instanceof $?this.message.clone():$("<div>").text(this.message).contents()},a.ui.Error.prototype.getMessageText=function(){return this.message instanceof $?this.message.text():this.message},a.ui.Process=function(t,e){this.steps=[],void 0!==t&&this.next(t,e)},a.initClass(a.ui.Process),a.ui.Process.prototype.execute=function(){function i(i){return function(){var t=i.callback.call(i.context);if(!1===t)return $.Deferred().reject([]).promise();if("number"!=typeof t)return(t instanceof a.ui.Error?$.Deferred().reject([t]):Array.isArray(t)&&t.length&&t[0]instanceof a.ui.Error?$.Deferred().reject(t):t&&"function"==typeof t.then?$.when(t):$.Deferred().resolve()).promise();if(t<0)throw new Error("Cannot go back in time: flux capacitor is out of service");var e=$.Deferred();return setTimeout(e.resolve,t),e.promise()}}let o;if(this.steps.length){o=i(this.steps[0])();for(let t=1,e=this.steps.length;t<e;t++)o=o.then(i(this.steps[t]))}else o=$.Deferred().resolve().promise();return o},a.ui.Process.prototype.createStep=function(t,e){if("number"==typeof t||"function"==typeof t.then)return{callback:function(){return t},context:null};if("function"==typeof t)return{callback:t,context:e};throw new Error("Cannot create process step: number, promise or function expected")},a.ui.Process.prototype.first=function(t,e){return this.steps.unshift(this.createStep(t,e)),this},a.ui.Process.prototype.next=function(t,e){return this.steps.push(this.createStep(t,e)),this},a.ui.WindowInstance=function(){const t={opening:$.Deferred(),opened:$.Deferred(),closing:$.Deferred(),closed:$.Deferred()};this.deferreds=t,this.opening=t.opening.promise(),this.opened=this.opening.then(()=>t.opened),this.closing=this.opened.then(()=>t.closing),this.closed=this.closing.then(()=>t.closed)},a.initClass(a.ui.WindowInstance),a.ui.WindowInstance.prototype.isOpening=function(){return"pending"===this.deferreds.opened.state()},a.ui.WindowInstance.prototype.isOpened=function(){return"resolved"===this.deferreds.opened.state()&&"pending"===this.deferreds.closing.state()},a.ui.WindowInstance.prototype.isClosing=function(){return"resolved"===this.deferreds.closing.state()&&"pending"===this.deferreds.closed.state()},a.ui.WindowInstance.prototype.isClosed=function(){return"resolved"===this.deferreds.closed.state()},a.ui.WindowManager=function(t){a.ui.WindowManager.super.call(this,t=t||{}),a.EventEmitter.call(this),this.factory=t.factory,this.modal=void 0===t.modal||!!t.modal,this.windows={},this.compatOpened=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.lastSize=null,this.globalEvents=!1,this.$returnFocusTo=null,this.isolated=!1,this.$ariaHidden=null,this.$inert=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.onWindowFocusHandler=this.onWindowFocus.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.isModal()).toggleClass("oo-ui-windowManager-forceTrapFocus",!!t.forceTrapFocus),this.isModal()&&this.$element.attr("aria-hidden","true").attr("inert","")},a.inheritClass(a.ui.WindowManager,a.ui.Element),a.mixinClass(a.ui.WindowManager,a.EventEmitter),a.ui.WindowManager.static.sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},a.ui.WindowManager.static.defaultSize="medium",a.ui.WindowManager.prototype.isModal=function(){return this.modal},a.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)},a.ui.WindowManager.prototype.onWindowFocus=function(){var t=this.getCurrentWindow();t&&!a.ui.contains(t.$element[0],document.activeElement)&&t.focus()},a.ui.WindowManager.prototype.afterWindowResize=function(){var t=document.activeElement;this.currentWindow&&(this.updateWindowSize(this.currentWindow),t!==document.activeElement)&&t.focus()},a.ui.WindowManager.prototype.isOpening=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpening()},a.ui.WindowManager.prototype.isClosing=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isClosing()},a.ui.WindowManager.prototype.isOpened=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpened()},a.ui.WindowManager.prototype.hasWindow=function(t){for(const e in this.windows)if(this.windows[e]===t)return!0;return!1},a.ui.WindowManager.prototype.getSetupDelay=function(){return 0},a.ui.WindowManager.prototype.getReadyDelay=function(){return this.isModal()?a.ui.theme.getDialogTransitionDuration():0},a.ui.WindowManager.prototype.getHoldDelay=function(){return 0},a.ui.WindowManager.prototype.getTeardownDelay=function(){return this.isModal()?a.ui.theme.getDialogTransitionDuration():0},a.ui.WindowManager.prototype.getWindow=function(t){var e=$.Deferred();let i=this.windows[t];return i instanceof a.ui.Window?e.resolve(i):this.factory?this.factory.lookup(t)?(i=this.factory.create(t),this.addWindows([i]),e.resolve(i)):e.reject(new a.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):e.reject(new a.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),e.promise()},a.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},a.ui.WindowManager.prototype.openWindow=function(e,i,o,s){if(i=i||{},o=o||new a.ui.WindowInstance,s=s||$.Deferred(),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(t=>{o[t]=function(){return a.ui.warnDeprecation("Using the return value of openWindow as a promise is deprecated. Use .openWindow( ... ).opening."+t+"( ... ) instead."),s[t].apply(this,arguments)}}),"string"==typeof e)this.getWindow(e).then(t=>{this.openWindow(t,i,o,s)},t=>{o.deferreds.opening.reject(t)});else{let t;this.hasWindow(e)?this.lifecycle&&this.lifecycle.isOpened()?t="Cannot open window: another window is open":(this.preparingToOpen||this.lifecycle&&this.lifecycle.isOpening())&&(t="Cannot open window: another window is opening"):t="Cannot open window: window is not attached to manager",t?(s.reject(new a.ui.Error(t)),o.deferreds.opening.reject(new a.ui.Error(t))):(this.preparingToOpen=$.when(this.lifecycle&&this.lifecycle.closed),this.preparingToOpen.done(()=>{this.isModal()&&(this.toggleGlobalEvents(!0,e),this.toggleIsolation(!0)),this.$returnFocusTo=void 0!==i.$returnFocusTo?i.$returnFocusTo:$(document.activeElement),this.currentWindow=e,this.lifecycle=o,this.preparingToOpen=null,this.emit("opening",e,s,i),o.deferreds.opening.resolve(i),setTimeout(()=>{this.compatOpened=$.Deferred(),e.setup(i).then(()=>{s.notify({state:"setup"}),setTimeout(()=>{e.ready(i).then(()=>{s.notify({state:"ready"}),o.deferreds.opened.resolve(i),s.resolve(this.compatOpened.promise(),i),this.togglePreventIosScrolling(!0)},t=>{o.deferreds.opened.reject(),s.reject(),this.closeWindow(e),t instanceof Error&&setTimeout(()=>{throw t})})},this.getReadyDelay())},t=>{o.deferreds.opened.reject(),s.reject(),this.closeWindow(e),t instanceof Error&&setTimeout(()=>{throw t})})},this.getSetupDelay())}))}return o},a.ui.WindowManager.prototype.closeWindow=function(e,i){const o=$.Deferred();let s=this.lifecycle;"string"==typeof e?e=this.windows[e]:this.hasWindow(e)||(e=null);let t;return s?e?e!==this.currentWindow||this.lifecycle.isClosed()?t="Cannot close window: window already closed with different data":(this.preparingToClose||this.lifecycle.isClosing())&&(t="Cannot close window: window already closing with different data"):t="Cannot close window: window is not attached to manager":t="Cannot close window: no window is currently open",t&&((s=new a.ui.WindowInstance).deferreds.opening.resolve({}),s.deferreds.opened.resolve({})),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(t=>{s[t]=function(){return a.ui.warnDeprecation("Using the return value of closeWindow as a promise is deprecated. Use .closeWindow( ... ).closed."+t+"( ... ) instead."),o[t].apply(this,arguments)}}),t?(o.reject(new a.ui.Error(t)),s.deferreds.closing.reject(new a.ui.Error(t))):(this.preparingToClose=$.when(this.lifecycle.opened),this.preparingToClose.always(()=>{this.preparingToClose=null,this.emit("closing",e,o,i),s.deferreds.closing.resolve(i);var t=this.compatOpened;this.compatOpened=null,t.resolve(o.promise(),i),this.togglePreventIosScrolling(!1),setTimeout(()=>{e.hold(i).then(()=>{o.notify({state:"hold"}),setTimeout(()=>{e.teardown(i).then(()=>{o.notify({state:"teardown"}),this.isModal()&&(this.toggleGlobalEvents(!1),this.toggleIsolation(!1)),this.$returnFocusTo&&this.$returnFocusTo.length&&this.$returnFocusTo[0].focus(),this.currentWindow=null,this.lifecycle=null,s.deferreds.closed.resolve(i),o.resolve(i)})},this.getTeardownDelay())})},this.getHoldDelay())})),s},a.ui.WindowManager.prototype.addWindows=function(i){let o;if(Array.isArray(i)){o={};for(let t=0,e=i.length;t<e;t++){var s=i[t].constructor.static.name;if(!s)throw new Error("Windows must have a `name` static property defined.");o[s]=i[t]}}else a.isPlainObject(i)&&(o=i);for(const e in o){var t=o[e];this.windows[e]=t.toggle(!1),this.$element.append(t.$element),t.setManager(this)}},a.ui.WindowManager.prototype.removeWindows=function(t){const i=(t,e)=>{delete this.windows[t],e.$element.detach()};t=t.map(t=>{var e=this.windows[t];if(e)return e=i.bind(null,t,e),this.closeWindow(t).closed.then(e,e);throw new Error("Cannot remove window")});return $.when.apply($,t)},a.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},a.ui.WindowManager.prototype.updateWindowSize=function(t){var e,i;if(t===this.currentWindow)return e=t.getSize(),this.$element.removeClass("oo-ui-windowManager-size-"+this.lastSize).addClass("oo-ui-windowManager-size-"+e),e="full"===(this.lastSize=e),this.$element.toggleClass("oo-ui-windowManager-fullscreen",e),this.$element.toggleClass("oo-ui-windowManager-floating",!e),i=(e=$(this.getElementDocument().body)).data("windowManagerGlobalEvents")||[],e.add(e.parent()).toggleClass("oo-ui-windowManager-modal-active-fullscreen",i.some(t=>"full"===t.getSize())),t.setDimensions(t.getSizeProperties()),this.emit("resize",t),this},a.ui.WindowManager.prototype.togglePreventIosScrolling=function(t){var e=/ipad|iphone|ipod/i.test(navigator.userAgent),i=$(this.getElementDocument().body),o=(i.data("windowManagerGlobalEvents")||[]).length;return e&&1===o&&(e=a.ui.Element.static.getRootScrollableElement(i[0]),t?(this.iosOrigScrollPosition=e.scrollTop,"full"===this.getCurrentWindow().getSize()&&i.add(i.parent()).addClass("oo-ui-windowManager-ios-modal-ready")):(i.add(i.parent()).removeClass("oo-ui-windowManager-ios-modal-ready"),"full"===this.getCurrentWindow().getSize()&&(e.scrollTop=this.iosOrigScrollPosition))),this},a.ui.WindowManager.prototype.toggleGlobalEvents=function(t,e){var i=$(this.getElementDocument().body),o=$(this.getElementWindow()),s=i.data("windowManagerGlobalEvents")||[],n=(t=void 0===t?!!this.globalEvents:!!t,i.add(i.parent()));return t?this.globalEvents||(o.on({"orientationchange resize":this.onWindowResizeHandler,focus:this.onWindowFocusHandler}),s.push(e),this.globalEvents=!0):this.globalEvents&&(o.off({"orientationchange resize":this.onWindowResizeHandler,focus:this.onWindowFocusHandler}),s.pop(),this.globalEvents=!1),n.toggleClass("oo-ui-windowManager-modal-active",0<s.length),0===s.length&&n.removeClass("oo-ui-windowManager-modal-active-fullscreen"),i.data("windowManagerGlobalEvents",s),this},a.ui.WindowManager.prototype.toggleIsolation=function(t){if(this.isolated=void 0===t?!this.isolated:!!t,this.isolated){this.$element.removeAttr("aria-hidden").removeAttr("inert");let t=this.$element;for(var e=[],i=[];!t.is("body")&&t.length;){var o=t.siblings().not("script");t.removeAttr("aria-hidden").removeAttr("inert"),e.push.apply(e,o.not("[aria-hidden=true]").toArray()),i.push.apply(i,o.not("[inert]").toArray()),t=t.parent()}this.$ariaHidden=$(e),this.$inert=$(i),this.$ariaHidden.attr("aria-hidden","true"),this.$inert.attr("inert","")}else this.$ariaHidden.removeAttr("aria-hidden"),this.$inert.removeAttr("inert"),this.$ariaHidden=null,this.$inert=null,this.$element.attr("aria-hidden","true").attr("inert","");return this},a.ui.WindowManager.prototype.destroy=function(){this.clearWindows(),this.$element.remove()},a.ui.Window=function(t){a.ui.Window.super.call(this,t=t||{}),a.EventEmitter.call(this),this.manager=null,this.size=t.size||this.constructor.static.size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$focusTrapBefore=$("<div>").addClass("oo-ui-window-focusTrap").prop("tabIndex",0),this.$focusTrapAfter=this.$focusTrapBefore.clone(),this.$focusTraps=this.$focusTrapBefore.add(this.$focusTrapAfter),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabindex",-1),this.$frame.addClass("oo-ui-window-frame").append(this.$focusTrapBefore,this.$content,this.$focusTrapAfter),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},a.inheritClass(a.ui.Window,a.ui.Element),a.mixinClass(a.ui.Window,a.EventEmitter),a.ui.Window.static.size="medium",a.ui.Window.prototype.onMouseDown=function(t){if(t.target===this.$element[0])return!1},a.ui.Window.prototype.isInitialized=function(){return!!this.manager},a.ui.Window.prototype.isVisible=function(){return this.visible},a.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},a.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},a.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},a.ui.Window.prototype.getManager=function(){return this.manager},a.ui.Window.prototype.getSize=function(){var t=a.ui.Element.static.getDimensions(this.getElementWindow()),e=this.manager.constructor.static.sizes;let i=this.size;return i="full"!==(i=e[i]?i:this.manager.constructor.static.defaultSize)&&t.rect.right-t.rect.left<e[i].width?"full":i},a.ui.Window.prototype.getSizeProperties=function(){return this.manager.constructor.static.sizes[this.getSize()]},a.ui.Window.prototype.withoutSizeTransitions=function(t){var e=this.$frame.css("transition-property")+" "+this.$frame.css("transition-duration")+" "+this.$frame.css("transition-timing-function")+" "+this.$frame.css("transition-delay");this.$frame.css("transition","none"),t(),this.$frame.height(),this.$frame.css("transition",e)},a.ui.Window.prototype.getContentHeight=function(){const o=this.$body[0],s=this.$frame[0];let n;return this.withoutSizeTransitions(()=>{var t=s.style.height,e=o.style.position,i=o.scrollTop;s.style.height="1px",o.style.position="relative",n=this.getBodyHeight(),s.style.height=t,o.style.position=e,o.scrollTop=i}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+n+this.$foot.outerHeight(!0))},a.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},a.ui.Window.prototype.getDir=function(){return a.ui.Element.static.getDir(this.$content)||"ltr"},a.ui.Window.prototype.getSetupProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getReadyProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getHoldProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getTeardownProcess=function(){return new a.ui.Process},a.ui.Window.prototype.setManager=function(t){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=t,this.initialize(),this},a.ui.Window.prototype.setSize=function(t){return this.size=t,this.updateSize(),this},a.ui.Window.prototype.updateSize=function(){if(this.manager)return this.manager.updateWindowSize(this),this;throw new Error("Cannot update window size, must be attached to a manager")},a.ui.Window.prototype.setDimensions=function(e){const i=this.$frame[0].style;let o;return void 0===e.height?this.withoutSizeTransitions(()=>{var t=i.width;this.$frame.css("width",e.width||""),o=this.getContentHeight(),i.width=t}):o=e.height,this.$frame.css({width:e.width||"",minWidth:e.minWidth||"",maxWidth:e.maxWidth||"",height:o||"",minHeight:e.minHeight||"",maxHeight:e.maxHeight||""}),this},a.ui.Window.prototype.initialize=function(){if(this.manager)return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$focusTraps.on("focus",this.onFocusTrapFocused.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$content.append(this.$head,this.$body,this.$foot),this;throw new Error("Cannot initialize window, must be attached to a manager")},a.ui.Window.prototype.onFocusTrapFocused=function(t){t=this.$focusTrapBefore.is(t.target);this.focus(t)},a.ui.Window.prototype.focus=function(t){t=a.ui.findFocusable(this.$content,!!t);return t?t.focus():this.$content.trigger("focus"),this},a.ui.Window.prototype.open=function(t){if(this.manager)return this.manager.openWindow(this,t);throw new Error("Cannot open window, must be attached to a manager")},a.ui.Window.prototype.close=function(t){if(this.manager)return this.manager.closeWindow(this,t);throw new Error("Cannot close window, must be attached to a manager")},a.ui.Window.prototype.setup=function(t){return this.toggle(!0),this.getSetupProcess(t).execute().then(()=>{this.updateSize(),this.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),this.$content.addClass("oo-ui-window-content-setup").width()})},a.ui.Window.prototype.ready=function(t){return this.$content.trigger("focus"),this.getReadyProcess(t).execute().then(()=>{this.$element.addClass("oo-ui-window-ready").width(),this.$content.addClass("oo-ui-window-content-ready").width()})},a.ui.Window.prototype.hold=function(t){return this.getHoldProcess(t).execute().then(()=>{var t=this.$content.find(a.ui.Element.static.getDocument(this.$content).activeElement);t.length&&t[0].blur(),this.$element.removeClass("oo-ui-window-ready oo-ui-window-setup").width(),this.$content.removeClass("oo-ui-window-content-ready oo-ui-window-content-setup").width()})},a.ui.Window.prototype.teardown=function(t){return this.getTeardownProcess(t).execute().then(()=>{this.$element.removeClass("oo-ui-window-active").width(),this.toggle(!1)})},a.ui.Dialog=function(t){a.ui.Dialog.super.call(this,t),a.ui.mixin.PendingElement.call(this),this.actions=new a.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDialogKeyDownHandler=this.onDialogKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},a.inheritClass(a.ui.Dialog,a.ui.Window),a.mixinClass(a.ui.Dialog,a.ui.mixin.PendingElement),a.ui.Dialog.static.name="",a.ui.Dialog.static.title="",a.ui.Dialog.static.actions=[],a.ui.Dialog.static.escapable=!0,a.ui.Dialog.prototype.getEscapeAction=function(){return""},a.ui.Dialog.prototype.onDialogKeyDown=function(t){var e;t.which===a.ui.Keys.ESCAPE&&this.constructor.static.escapable?null!==(e=this.getEscapeAction())&&(this.executeAction(e),t.preventDefault(),t.stopPropagation()):t.which===a.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)&&0<(e=this.actions.get({flags:"primary",visible:!0,disabled:!1})).length&&(this.executeAction(e[0].getAction()),t.preventDefault(),t.stopPropagation())},a.ui.Dialog.prototype.onActionClick=function(t){this.isPending()||this.executeAction(t.getAction())},a.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||(this.attachActions(),this.isOpening())||this.updateSize()},a.ui.Dialog.prototype.getActions=function(){return this.actions},a.ui.Dialog.prototype.getActionProcess=function(t){return(new a.ui.Process).next(()=>{t||this.close()})},a.ui.Dialog.prototype.getSetupProcess=function(i){return i=i||{},a.ui.Dialog.super.prototype.getSetupProcess.call(this,i).next(()=>{var t=this.constructor.static,e=(void 0!==i.actions?i:t).actions,t=(void 0!==i.title?i:t).title;this.title.setLabel(t),this.actions.add(this.getActionWidgets(e)),this.$element.on("keydown",this.onDialogKeyDownHandler)})},a.ui.Dialog.prototype.getTeardownProcess=function(t){return a.ui.Dialog.super.prototype.getTeardownProcess.call(this,t).first(()=>{this.$element.off("keydown",this.onDialogKeyDownHandler),this.actions.clear(),this.currentAction=null})},a.ui.Dialog.prototype.initialize=function(){a.ui.Dialog.super.prototype.initialize.call(this),this.title=new a.ui.LabelWidget,this.$content.addClass("oo-ui-dialog-content"),this.$element.attr("aria-labelledby",this.title.getElementId()),this.setPendingElement(this.$head)},a.ui.Dialog.prototype.getActionWidgets=function(i){var o=[];for(let t=0,e=i.length;t<e;t++)o.push(this.getActionWidget(i[t]));return o},a.ui.Dialog.prototype.getActionWidget=function(t){return new a.ui.ActionWidget(this.getActionWidgetConfig(t))},a.ui.Dialog.prototype.getActionWidgetConfig=function(t){return t},a.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},a.ui.Dialog.prototype.detachActions=function(){for(let t=0,e=this.attachedActions.length;t<e;t++)this.attachedActions[t].$element.detach();return this.attachedActions=[],this},a.ui.Dialog.prototype.executeAction=function(t){var e=this.actions.get({actions:[t],visible:!0});return e.length&&e.every(t=>t.isDisabled())?$.Deferred().reject().promise():(this.pushPending(),this.currentAction=t,this.getActionProcess(t).execute().always(this.popPending.bind(this)))},a.ui.MessageDialog=function(t){a.ui.MessageDialog.super.call(this,t),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},a.inheritClass(a.ui.MessageDialog,a.ui.Dialog),a.ui.MessageDialog.static.name="message",a.ui.MessageDialog.static.size="small",a.ui.MessageDialog.static.title=null,a.ui.MessageDialog.static.message=null,a.ui.MessageDialog.static.actions=[{action:"accept",label:a.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:a.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],a.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(t){return(t=void 0===t?!this.verticalActionLayout:!!t)!==this.verticalActionLayout&&(this.verticalActionLayout=t,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",t).toggleClass("oo-ui-messageDialog-actions-horizontal",!t)),this},a.ui.MessageDialog.prototype.getActionProcess=function(t){return t?new a.ui.Process(()=>{this.close({action:t})}):a.ui.MessageDialog.super.prototype.getActionProcess.call(this,t)},a.ui.MessageDialog.prototype.getSetupProcess=function(t){return t=t||{},a.ui.MessageDialog.super.prototype.getSetupProcess.call(this,t).next(()=>{this.title.setLabel((void 0!==t.title?t:this.constructor.static).title),this.message.setLabel((void 0!==t.message?t:this.constructor.static).message),this.size=(void 0!==t.size?t:this.constructor.static).size})},a.ui.MessageDialog.prototype.getReadyProcess=function(t){return a.ui.MessageDialog.super.prototype.getReadyProcess.call(this,t=t||{}).next(()=>{let t=this.actions.get();0<(t=t.filter(t=>-1<t.getFlags().indexOf("primary"))).length&&t[0].focus()})},a.ui.MessageDialog.prototype.getBodyHeight=function(){var t=this.container.$element,e=t[0].style.overflow,i=(t[0].style.overflow="hidden",a.ui.Element.static.reconsiderScrollbars(t[0]),this.text.$element.outerHeight(!0));return t[0].style.overflow=e,i},a.ui.MessageDialog.prototype.setDimensions=function(t){const i=this.container.$element;return a.ui.MessageDialog.super.prototype.setDimensions.call(this,t),setTimeout(()=>{var t=i[0].style.overflow,e=document.activeElement;i[0].style.overflow="hidden",a.ui.Element.static.reconsiderScrollbars(i[0]),e&&e!==document.activeElement&&e.focus&&e.focus(),i[0].style.overflow=t},300),this.fitActions(),setTimeout(()=>{this.fitActions()},300),this},a.ui.MessageDialog.prototype.initialize=function(){a.ui.MessageDialog.super.prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new a.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new a.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new a.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},a.ui.MessageDialog.prototype.getActionWidgetConfig=function(t){return Object.assign({},t,{framed:!1})},a.ui.MessageDialog.prototype.attachActions=function(){a.ui.MessageDialog.super.prototype.attachActions.call(this);var t=this.actions.getSpecial(),i=this.actions.getOthers();t.safe&&(this.$actions.append(t.safe.$element),t.safe.toggleFramed(!0));for(let t=0,e=i.length;t<e;t++)this.$actions.append(i[t].$element),i[t].toggleFramed(!0);t.primary&&(this.$actions.append(t.primary.$element),t.primary.toggleFramed(!0))},a.ui.MessageDialog.prototype.fitActions=function(){var t=this.verticalActionLayout;this.toggleVerticalActionLayout(!1),this.$actions[0].scrollWidth>this.$actions[0].clientWidth&&this.toggleVerticalActionLayout(!0),this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==t&&this.updateSize()},a.ui.ProcessDialog=function(t){a.ui.ProcessDialog.super.call(this,t),this.fitOnOpen=!1,this.$element.addClass("oo-ui-processDialog"),a.ui.isMobile()&&this.$element.addClass("oo-ui-isMobile")},a.inheritClass(a.ui.ProcessDialog,a.ui.Dialog),a.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},a.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction)},a.ui.ProcessDialog.prototype.initialize=function(){a.ui.ProcessDialog.super.prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new a.ui.ButtonWidget({label:a.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new a.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.connect(this,{labelChange:"fitLabel"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(a.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors oo-ui-element-hidden").append(this.$errorsTitle,$("<div>").addClass("oo-ui-processDialog-errors-actions").append(this.dismissButton.$element,this.retryButton.$element)),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$primaryActions,this.$location,this.$safeActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},a.ui.ProcessDialog.prototype.getActionWidgetConfig=function(e){function t(t){return e.flags===t||Array.isArray(e.flags)&&-1!==e.flags.indexOf(t)}return e=Object.assign({framed:!0},e),t("close")?Object.assign(e,{icon:"close",invisibleLabel:!0}):t("back")&&Object.assign(e,{icon:"previous",invisibleLabel:!0}),e},a.ui.ProcessDialog.prototype.attachActions=function(){a.ui.ProcessDialog.super.prototype.attachActions.call(this);var t=this.actions.getSpecial(),i=this.actions.getOthers();t.primary&&this.$primaryActions.append(t.primary.$element);for(let t=0,e=i.length;t<e;t++){var o=i[t];this.$otherActions.append(o.$element)}t.safe&&this.$safeActions.append(t.safe.$element)},a.ui.ProcessDialog.prototype.executeAction=function(t){return a.ui.ProcessDialog.super.prototype.executeAction.call(this,t).fail(t=>{this.showErrors(t||[])})},a.ui.ProcessDialog.prototype.setDimensions=function(){a.ui.ProcessDialog.super.prototype.setDimensions.apply(this,arguments),this.fitLabel(),this.$body.css("bottom",this.$foot.outerHeight(!0)),setTimeout(()=>{this.$body.css("bottom",this.$foot.outerHeight(!0))},300)},a.ui.ProcessDialog.prototype.fitLabel=function(){var t=this.getSizeProperties();let e;if("number"!=typeof t.width){if(!this.isOpened())return this.isOpening()?void(this.fitOnOpen||(this.manager.lifecycle.opened.done(this.fitLabel.bind(this)),this.fitOnOpen=!0)):void 0;e=this.$head.width()-20}else e=t.width-20;var t=this.$safeActions.width(),i=this.$primaryActions.width(),o=Math.max(t,i),s=this.title.$element.width();let n,r;return!a.ui.isMobile()&&2*o+s<e?n=r=o:r="ltr"===this.getDir()?(n=t,i):(n=i,t),this.$location.css({paddingLeft:n,paddingRight:r}),this},a.ui.ProcessDialog.prototype.showErrors=function(i){var t,o=[],e={};let s=!0,n=!1;for(let t=0,e=(i=i instanceof a.ui.Error?[i]:i).length;t<e;t++)i[t].isRecoverable()||(s=!1),i[t].isWarning()&&(n=!0),o.push(new a.ui.MessageWidget({type:"error",label:i[t].getMessage()}).$element[0]);this.$errorItems=$(o),s?(e[this.currentAction]=!0,(t=this.actions.get({actions:this.currentAction})).length&&this.retryButton.clearFlags().setFlags(t[0].getFlags())):(e[this.currentAction]=!1,this.actions.setAbilities(e)),n?this.retryButton.setLabel(a.ui.msg("ooui-dialog-process-continue")):this.retryButton.setLabel(a.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(s),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-element-hidden").scrollTop(0)},a.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-element-hidden"),this.$errorItems&&(this.$errorItems.remove(),this.$errorItems=null)},a.ui.ProcessDialog.prototype.getTeardownProcess=function(t){return a.ui.ProcessDialog.super.prototype.getTeardownProcess.call(this,t).first(()=>{this.hideErrors(),this.fitOnOpen=!1})},a.ui.getWindowManager=function(){return a.ui.windowManager||(a.ui.windowManager=new a.ui.WindowManager,$(a.ui.getTeleportTarget()).append(a.ui.windowManager.$element),a.ui.windowManager.addWindows([new a.ui.MessageDialog])),a.ui.windowManager},a.ui.alert=function(t,e){return a.ui.getWindowManager().openWindow("message",Object.assign({message:t,actions:[a.ui.MessageDialog.static.actions[0]]},e)).closed.then(()=>{})},a.ui.confirm=function(t,e){return a.ui.getWindowManager().openWindow("message",Object.assign({message:t},e)).closed.then(t=>!(!t||"accept"!==t.action))},a.ui.prompt=function(t,e){const i=a.ui.getWindowManager(),o=new a.ui.TextInputWidget(e&&e.textInput||{}),s=new a.ui.FieldLayout(o,{align:"top",label:t});t=i.openWindow("message",Object.assign({message:s.$element},e));return t.opened.then(()=>{o.on("enter",()=>{i.getCurrentWindow().close({action:"accept"})}),o.focus()}),t.closed.then(t=>t&&"accept"===t.action?o.getValue():null)}}(OO);
//# sourceMappingURL=oojs-ui-windows.min.js.map