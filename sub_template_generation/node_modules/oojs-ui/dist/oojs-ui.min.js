/*! OOUI v0.51.6 | http://oojs.mit-license.org */
!function(m){"use strict";m.ui={},m.ui.bind=$.proxy,m.ui.Keys={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},m.ui.MouseButtons={LEFT:1,MIDDLE:2,RIGHT:3},m.ui.elementId=0,m.ui.generateElementId=function(){return m.ui.elementId++,"ooui-"+m.ui.elementId},m.ui.isFocusableElement=function(t){var e=t[0];return!e.disabled&&!(!$.expr.pseudos.visible(e)||t.parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length)&&("true"===e.contentEditable||0<=t.prop("tabIndex")||(e=e.nodeName.toLowerCase(),-1!==["input","select","textarea","button","object"].indexOf(e))||("a"===e||"area"===e)&&void 0!==t.attr("href"))},m.ui.findFocusable=function(t,e){let i=$([]),o=t.find("input, select, textarea, button, object, a, area, [contenteditable], [tabindex]");return(o=e?Array.prototype.reverse.call(o):o).each((t,e)=>{e=$(e);if(m.ui.isFocusableElement(e))return i=e,!1}),i},m.ui.getUserLanguages=function(){return["en"]},m.ui.getLocalValue=function(i,o,t){if(i[o])return i[o];var n=m.ui.getUserLanguages();for(let t=0,e=n.length;t<e;t++)if(i[o=n[t]])return i[o];if(i[t])return i[t];for(o in i)return i[o]},m.ui.contains=function(e,i,o){for(let t=(e=Array.isArray(e)?e:[e]).length-1;0<=t;t--)if(o&&i===e[t]||$.contains(e[t],i))return!0;return!1},m.ui.debounce=function(i,o,n){let s;return function(){const t=this,e=arguments;n&&!s&&i.apply(t,e),s&&!o||(clearTimeout(s),s=setTimeout(function(){s=null,n||i.apply(t,e)},o))}},m.ui.warnDeprecation=function(t){void 0!==m.getProp(window,"console","warn")&&console.warn(t)},m.ui.throttle=function(t,e){let i,o,n,s=Date.now()-e;function l(){n=null,s=Date.now(),t.apply(i,o)}return function(){var t=Math.max(e-(Date.now()-s),0);i=this,o=arguments,n=n||setTimeout(l,t)}},m.ui.infuse=function(t,e){return"string"==typeof t&&m.ui.warnDeprecation("Passing a selector to infuse is deprecated. Use an HTMLElement or jQuery collection instead."),m.ui.Element.static.infuse(t,e)},m.ui.msg=function(t,...o){let e=m.ui.msg.messages[t];return e="string"==typeof e?e.replace(/\$(\d+)/g,(t,e)=>{var i=parseInt(e,10);return void 0!==o[i-1]?o[i-1]:"$"+e}):"["+t+"]"},m.ui.deferMsg=function(){return()=>m.ui.msg(...arguments)},m.ui.resolveMsg=function(t){return"function"==typeof t?t():t},m.ui.isSafeUrl=function(e){function i(t,e){return t.slice(0,e.length)===e}var o=["bitcoin","ftp","ftps","geo","git","gopher","http","https","irc","ircs","magnet","mailto","mms","news","nntp","redis","sftp","sip","sips","sms","ssh","svn","tel","telnet","urn","worldwind","xmpp"];if(""===e)return!0;for(let t=0;t<o.length;t++)if(i(e,o[t]+":"))return!0;return!!(i(e,"/")||i(e,"./")||i(e,"?")||i(e,"#"))},m.ui.isMobile=function(){return!1},m.ui.getViewportSpacing=function(){return{top:0,right:0,bottom:0,left:0}},m.ui.getTeleportTarget=function(){return document.body},m.ui.getDefaultOverlay=function(){return m.ui.$defaultOverlay||(m.ui.$defaultOverlay=$("<div>").addClass("oo-ui-defaultOverlay"),$(m.ui.getTeleportTarget()).append(m.ui.$defaultOverlay)),m.ui.$defaultOverlay},window.customElements&&window.customElements.define("ooui-connect-detector",class extends HTMLElement{connectedCallback(){this.onConnectOOUI instanceof Function&&this.onConnectOOUI()}}),m.ui.msg.messages={"ooui-copytextlayout-copy":"Copy","ooui-outline-control-move-down":"Move item down","ooui-outline-control-move-up":"Move item up","ooui-outline-control-remove":"Remove item","ooui-toolbar-more":"More","ooui-toolgroup-expand":"More","ooui-toolgroup-collapse":"Fewer","ooui-item-remove":"Remove","ooui-dialog-message-accept":"OK","ooui-dialog-message-reject":"Cancel","ooui-dialog-process-error":"Something went wrong","ooui-dialog-process-dismiss":"Dismiss","ooui-dialog-process-retry":"Try again","ooui-dialog-process-continue":"Continue","ooui-combobox-button-label":"Toggle options","ooui-selectfile-button-select":"Select a file","ooui-selectfile-button-select-multiple":"Select files","ooui-selectfile-placeholder":"No file is selected","ooui-selectfile-dragdrop-placeholder":"Drop file here","ooui-selectfile-dragdrop-placeholder-multiple":"Drop files here","ooui-popup-widget-close-button-aria-label":"Close","ooui-field-help":"Help"},m.ui.mixin={},m.ui.Element=function(t){m.ui.isDemo&&(this.initialConfig=t),t=t||{},this.elementId=null,this.visible=!0,this.data=t.data,this.$element=t.$element||$(window.document.createElement(this.getTagName())),this.elementGroup=null;const e=m.ui.Element.static.getDocument(this.$element);Array.isArray(t.classes)&&this.$element.addClass(t.classes),t.id&&this.setElementId(t.id),t.text&&this.$element.text(t.text),t.content&&this.$element.append(t.content.map(t=>"string"==typeof t?t?e.createTextNode(t):void 0:t instanceof m.ui.HtmlSnippet?t.toString():t instanceof m.ui.Element?t.$element:t)),t.$content&&this.$element.append(t.$content)},m.initClass(m.ui.Element),m.ui.Element.static.tagName="div",m.ui.Element.static.infuse=function(t,e){return m.ui.Element.static.unsafeInfuse(t,e,!1)},m.ui.Element.static.unsafeInfuse=function(t,i,o){let n=$(t);if(1<n.length)throw new Error("Collection contains more than one element");if(!n.length)throw new Error("Widget not found");t=(n=n[0].$oouiInfused?n[0].$oouiInfused:n).attr("id");const s=this.getDocument(n);let e=n.data("ooui-infused");if(e){if(!0===e)throw new Error("Circular dependency! "+t);return o&&(l=e.constructor.static.gatherPreInfuseState(n,e),o.done(e.restorePreInfuseState.bind(e,l)),l=n.data("ooui-infused-children"))&&l.length&&l.forEach(t=>{var e=t.constructor.static.gatherPreInfuseState(n,t);o.done(t.restorePreInfuseState.bind(t,e))}),e}if(!(e=n.attr("data-ooui")))throw new Error("No infusion data found: "+t);try{e=JSON.parse(e)}catch(t){e=null}if(!e||!e._)throw new Error("No valid infusion data found: "+t);if("Tag"===e._)return new m.ui.Element(Object.assign({},i,{$element:n}));var l=e._.split("."),l=m.getProp.apply(m,[window].concat(l));if(!l||!(l===m.ui.Element||l.prototype instanceof m.ui.Element))throw new Error("Unknown widget type: id: "+t+", class: "+e._);let u;o||(u=$.Deferred(),o=u.promise()),n.data("ooui-infused",!0),e.id=t;const a=[];e=m.copy(e,null,t=>{var e;if(m.isPlainObject(t))return t.tag&&s.getElementById(t.tag)?(e=m.ui.Element.static.unsafeInfuse(s.getElementById(t.tag),i,o),a.push(e),a.push.apply(a,e.$element.data("ooui-infused-children")||[]),e.$element.removeData("ooui-infused-children"),e):void 0!==t.html?new m.ui.HtmlSnippet(t.html):void 0}),e=l.static.reusePreInfuseDOM(n[0],e);t=l.static.gatherPreInfuseState(n[0],e),l=new l(Object.assign({},i,e));return n[0].$oouiInfused=l.$element,u&&(n[0]!==l.$element[0]&&n.replaceWith(l.$element),u.resolve()),l.$element.data({"ooui-infused":l,"ooui-infused-children":a}).attr("data-ooui",""),o.done(l.restorePreInfuseState.bind(l,t)),l},m.ui.Element.static.reusePreInfuseDOM=function(t,e){return e},m.ui.Element.static.gatherPreInfuseState=function(){return{}},m.ui.Element.static.getDocument=function(t){return t.ownerDocument||t.document||t.nodeType===Node.DOCUMENT_NODE&&t||t[0]&&t[0].ownerDocument||t.context||null},m.ui.Element.static.getWindow=function(t){return this.getDocument(t).defaultView},m.ui.Element.static.getDir=function(t){var e=(t=t instanceof $?t[0]:t).nodeType===Node.DOCUMENT_NODE,i=void 0!==t.document;return(e||i)&&(t=(t=i?t.document:t).body),$(t).css("direction")},m.ui.Element.static.getFrameOffset=function(o,t,e){if(t=t||window,e=e||{top:0,left:0},o.parent!==o){let i;var n,s=o.parent.document.getElementsByTagName("iframe");for(let t=0,e=s.length;t<e;t++)if(s[t].contentWindow===o){i=s[t];break}i&&(n=i.getBoundingClientRect(),e.left+=n.left,e.top+=n.top,o!==t)&&this.getFrameOffset(o.parent,e)}return e},m.ui.Element.static.getRelativePosition=function(t,e){var i=t.offset(),o=e.offset(),n=this.getDocument(e);let s=this.getDocument(t);for(;s!==n;){var l=s.defaultView.frameElement;if(!l)throw new Error("$element frame is not contained in $anchor frame");var u=$(l).offset();i.left+=u.left,i.top+=u.top,s=this.getDocument(l)}return i.left-=o.left,i.top-=o.top,i},m.ui.Element.static.getBorders=function(t){var e=this.getDocument(t).defaultView.getComputedStyle(t,null),t=$(t);return{top:parseFloat(e?e.borderTopWidth:t.css("borderTopWidth"))||0,left:parseFloat(e?e.borderLeftWidth:t.css("borderLeftWidth"))||0,bottom:parseFloat(e?e.borderBottomWidth:t.css("borderBottomWidth"))||0,right:parseFloat(e?e.borderRightWidth:t.css("borderRightWidth"))||0}},m.ui.Element.static.getDimensions=function(t){var e=this.getDocument(t),i=e.defaultView;return i===t||t===e.documentElement?{borders:{top:0,left:0,bottom:0,right:0},scroll:{top:(e=$(i)).scrollTop(),left:m.ui.Element.static.getScrollLeft(i)},scrollbar:{right:0,bottom:0},rect:{top:0,left:0,bottom:e.innerHeight(),right:e.innerWidth()}}:(i=$(t),{borders:this.getBorders(t),scroll:{top:i.scrollTop(),left:m.ui.Element.static.getScrollLeft(t)},scrollbar:{right:i.innerWidth()-t.clientWidth,bottom:i.innerHeight()-t.clientHeight},rect:t.getBoundingClientRect()})};{let i=null;function o(){var t=$("<div>").attr({dir:"rtl",style:"font-size: 14px; width: 4px; height: 1px; position: absolute; top: -1000px; overflow: scroll;"}).text("ABCD"),e=t[0];t.appendTo("body"),0<e.scrollLeft?i="default":(e.scrollLeft=1,0===e.scrollLeft&&(i="negative")),t.remove()}function n(t){return t===t.window||t===t.ownerDocument.body||t===t.ownerDocument.documentElement}m.ui.Element.static.computeNormalizedScrollLeft=function(t,e){if("rtl"===(n(e)?"ltr":$(e).css("direction"))){if(null===i&&o(),"reverse"===i)return-t;if("default"===i)return t-e.scrollWidth+e.clientWidth}return t},m.ui.Element.static.computeNativeScrollLeft=function(t,e){if("rtl"===(n(e)?"ltr":$(e).css("direction"))){if(null===i&&o(),"reverse"===i)return-t;if("default"===i)return t+e.scrollWidth-e.clientWidth}return t},m.ui.Element.static.getScrollLeft=function(t){var e=n(t)?$(window).scrollLeft():t.scrollLeft;return m.ui.Element.static.computeNormalizedScrollLeft(e,t)},m.ui.Element.static.setScrollLeft=function(t,e){e=m.ui.Element.static.computeNativeScrollLeft(e,t),n(t)?$(window).scrollLeft(e):t.scrollLeft=e}}m.ui.Element.static.getRootScrollableElement=function(t){var e,i,t=this.getDocument(t);return void 0===m.ui.scrollableElement&&(i=(e=t.body).scrollTop,(e.scrollTop=1)===Math.round(e.scrollTop)?(e.scrollTop=i,m.ui.scrollableElement="body"):m.ui.scrollableElement="documentElement"),t[m.ui.scrollableElement]},m.ui.Element.static.getClosestScrollableContainer=function(t,e){var i=this.getDocument(t),o=this.getRootScrollableElement(t);let n=["overflow-x","overflow-y"],s=$(t).parent();if(t!==i.documentElement)for("x"!==e&&"y"!==e||(n=["overflow-"+e]);s.length&&s[0]!==i;){if(s[0]===o)return s[0];let t=n.length;for(;t--;){var l=s.css(n[t]);if("auto"===l||"scroll"===l)return s[0]===i.body?o:s[0]}s=s.parent()}return o},m.ui.Element.static.scrollIntoView=function(t,e){var i=$.Deferred(),o=(e=e||{},Object.assign({top:0,bottom:0,left:0,right:0},e.padding));let n=!1!==e.animate;window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(n=!1);var s={},l=t instanceof HTMLElement?this.getDimensions(t).rect:t,t=e.scrollContainer||(t instanceof HTMLElement?this.getClosestScrollableContainer(t,e.direction):this.getClosestScrollableContainer(window.document.body)),u=$(t),a=this.getDimensions(t),r=$(this.getWindow(t));let h;if(h=u.is("html, body")?{top:l.top,bottom:r.innerHeight()-l.bottom,left:l.left,right:r.innerWidth()-l.right}:{top:l.top-(a.rect.top+a.borders.top),bottom:a.rect.bottom-a.borders.bottom-a.scrollbar.bottom-l.bottom,left:l.left-(a.rect.left+a.borders.left),right:a.rect.right-a.borders.right-a.scrollbar.right-l.right},e.direction&&"y"!==e.direction||(h.top<o.top||e.alignToTop?s.scrollTop=a.scroll.top+h.top-o.top:h.bottom<o.bottom&&(s.scrollTop=a.scroll.top+Math.min(h.top-o.top,-h.bottom+o.bottom))),e.direction&&"x"!==e.direction||(h.left<o.left?s.scrollLeft=a.scroll.left+h.left-o.left:h.right<o.right&&(s.scrollLeft=a.scroll.left+Math.min(h.left-o.left,-h.right+o.right)),void 0!==s.scrollLeft&&(s.scrollLeft=m.ui.Element.static.computeNativeScrollLeft(s.scrollLeft,t))),$.isEmptyObject(s))i.resolve();else if(n)u.stop(!0).animate(s,{duration:void 0===e.duration?"fast":e.duration,always:i.resolve});else{u.stop(!0);for(const d in s)u[d](s[d]);i.resolve()}return i.promise()},m.ui.Element.static.reconsiderScrollbars=function(i){for(var t=i.scrollLeft,e=i.scrollTop,o=[];i.firstChild;)o.push(i.firstChild),i.removeChild(i.firstChild);i.offsetHeight;for(let t=0,e=o.length;t<e;t++)i.appendChild(o[t]);i.scrollLeft=t,i.scrollTop=e},m.ui.Element.prototype.toggle=function(t){return(t=void 0===t?!this.visible:!!t)!==this.isVisible()&&(this.visible=t,this.$element.toggleClass("oo-ui-element-hidden",!this.visible),this.emit("toggle",t)),this},m.ui.Element.prototype.isVisible=function(){return this.visible},m.ui.Element.prototype.getData=function(){return this.data},m.ui.Element.prototype.setData=function(t){return this.data=t,this},m.ui.Element.prototype.setElementId=function(t){return this.elementId=t,this.$element.attr("id",t),this},m.ui.Element.prototype.getElementId=function(){return null===this.elementId&&this.setElementId(m.ui.generateElementId()),this.elementId},m.ui.Element.prototype.supports=function(t){return Array.isArray(t)?t.every(t=>"function"==typeof this[t]):"function"==typeof this[t]},m.ui.Element.prototype.updateThemeClasses=function(){m.ui.theme.queueUpdateElementClasses(this)},m.ui.Element.prototype.getTagName=function(){return this.constructor.static.tagName},m.ui.Element.prototype.isElementAttached=function(){return this.$element[0].isConnected},m.ui.Element.prototype.getElementDocument=function(){return m.ui.Element.static.getDocument(this.$element)},m.ui.Element.prototype.getElementWindow=function(){return m.ui.Element.static.getWindow(this.$element)},m.ui.Element.prototype.getClosestScrollableElementContainer=function(){return m.ui.Element.static.getClosestScrollableContainer(this.$element[0])},m.ui.Element.prototype.getElementGroup=function(){return this.elementGroup},m.ui.Element.prototype.setElementGroup=function(t){return this.elementGroup=t,this},m.ui.Element.prototype.scrollElementIntoView=function(t){return!this.isElementAttached()||!this.isVisible()||this.getElementGroup()&&!this.getElementGroup().isVisible()?$.Deferred().resolve():m.ui.Element.static.scrollIntoView(this.$element[0],t)},m.ui.Element.prototype.restorePreInfuseState=function(){},m.ui.HtmlSnippet=function(t){this.content=t},m.initClass(m.ui.HtmlSnippet),m.ui.HtmlSnippet.prototype.toString=function(){return this.content},m.ui.Layout=function(t){m.ui.Layout.super.call(this,t=t||{}),m.EventEmitter.call(this),this.$element.addClass("oo-ui-layout")},m.inheritClass(m.ui.Layout,m.ui.Element),m.mixinClass(m.ui.Layout,m.EventEmitter),m.ui.Layout.prototype.resetScroll=function(){return this.$element[0].scrollTop=0,m.ui.Element.static.setScrollLeft(this.$element[0],0),this},m.ui.Widget=function(t){m.ui.Widget.super.call(this,t),m.EventEmitter.call(this),this.disabled=null,this.wasDisabled=null,this.$element.addClass("oo-ui-widget"),this.setDisabled(t&&t.disabled)},m.inheritClass(m.ui.Widget,m.ui.Element),m.mixinClass(m.ui.Widget,m.EventEmitter),m.ui.Widget.prototype.isDisabled=function(){return this.disabled},m.ui.Widget.prototype.setDisabled=function(t){this.disabled=!!t;t=this.isDisabled();return t!==this.wasDisabled&&(this.$element.toggleClass("oo-ui-widget-disabled",t),this.$element.toggleClass("oo-ui-widget-enabled",!t),this.$element.attr("aria-disabled",t?"true":null),this.emit("disable",t),this.updateThemeClasses(),this.wasDisabled=t),this},m.ui.Widget.prototype.updateDisabled=function(){return this.setDisabled(this.disabled),this},m.ui.Widget.prototype.getInputId=function(){return null},m.ui.Widget.prototype.simulateLabelClick=function(){},m.ui.Widget.prototype.setLabelledBy=function(t){t?this.$element.attr("aria-labelledby",t):this.$element.removeAttr("aria-labelledby")},m.ui.Theme=function(){this.elementClassesQueue=[],this.debouncedUpdateQueuedElementClasses=m.ui.debounce(this.updateQueuedElementClasses)},m.initClass(m.ui.Theme),m.ui.Theme.prototype.getElementClasses=function(){return{on:[],off:[]}},m.ui.Theme.prototype.updateElementClasses=function(t){var e=[];t.$icon&&e.push(t.$icon[0]),t.$indicator&&e.push(t.$indicator[0]),e.length&&(t=this.getElementClasses(t),$(e).removeClass(t.off).addClass(t.on))},m.ui.Theme.prototype.updateQueuedElementClasses=function(){for(let t=0;t<this.elementClassesQueue.length;t++)this.updateElementClasses(this.elementClassesQueue[t]);this.elementClassesQueue=[]},m.ui.Theme.prototype.queueUpdateElementClasses=function(t){-1===this.elementClassesQueue.lastIndexOf(t)&&(this.elementClassesQueue.push(t),this.debouncedUpdateQueuedElementClasses())},m.ui.Theme.prototype.getDialogTransitionDuration=function(){return 0},m.ui.mixin.TabIndexedElement=function(t){t=Object.assign({tabIndex:0},t),this.$tabIndexed=null,this.tabIndex=null,this.connect(this,{disable:"onTabIndexedElementDisable"}),this.setTabIndex(t.tabIndex),this.setTabIndexedElement(t.$tabIndexed||this.$element)},m.initClass(m.ui.mixin.TabIndexedElement),m.ui.mixin.TabIndexedElement.prototype.setTabIndexedElement=function(t){var e=this.tabIndex;return this.setTabIndex(null),this.$tabIndexed=t,this.tabIndex=e,this.updateTabIndex()},m.ui.mixin.TabIndexedElement.prototype.setTabIndex=function(t){return t=/^-?\d+$/.test(t)?Number(t):null,this.tabIndex!==t&&(this.tabIndex=t,this.updateTabIndex()),this},m.ui.mixin.TabIndexedElement.prototype.updateTabIndex=function(){return this.$tabIndexed&&(null!==this.tabIndex?this.$tabIndexed.attr({tabindex:this.isDisabled()?-1:this.tabIndex,"aria-disabled":this.isDisabled()?"true":null}):this.$tabIndexed.removeAttr("tabindex aria-disabled")),this},m.ui.mixin.TabIndexedElement.prototype.onTabIndexedElementDisable=function(){this.updateTabIndex()},m.ui.mixin.TabIndexedElement.prototype.getTabIndex=function(){return this.tabIndex},m.ui.mixin.TabIndexedElement.prototype.getInputId=function(){if(!this.$tabIndexed)return null;if(!this.isLabelableNode(this.$tabIndexed))return null;let t=this.$tabIndexed.attr("id");return void 0===t&&(t=m.ui.generateElementId(),this.$tabIndexed.attr("id",t)),t},m.ui.mixin.TabIndexedElement.prototype.isLabelableNode=function(t){var e=(t.prop("tagName")||"").toLowerCase();return"input"===e&&"hidden"!==t.attr("type")||-1!==["button","meter","output","progress","select","textarea"].indexOf(e)},m.ui.mixin.TabIndexedElement.prototype.focus=function(){return this.isDisabled()||this.$tabIndexed.trigger("focus"),this},m.ui.mixin.TabIndexedElement.prototype.blur=function(){return this.$tabIndexed.trigger("blur"),this},m.ui.mixin.TabIndexedElement.prototype.simulateLabelClick=function(){this.focus()},m.ui.mixin.ButtonElement=function(t){t=t||{},this.$button=null,this.framed=null,this.active=void 0!==t.active&&t.active,this.onDocumentMouseUpHandler=this.onDocumentMouseUp.bind(this),this.onMouseDownHandler=this.onMouseDown.bind(this),this.onDocumentKeyUpHandler=this.onDocumentKeyUp.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this),this.onClickHandler=this.onClick.bind(this),this.onKeyPressHandler=this.onKeyPress.bind(this),this.$element.addClass("oo-ui-buttonElement"),this.toggleFramed(void 0===t.framed||t.framed),this.setButtonElement(t.$button||$("<a>"))},m.initClass(m.ui.mixin.ButtonElement),m.ui.mixin.ButtonElement.static.cancelButtonMouseDownEvents=!0,m.ui.mixin.ButtonElement.prototype.setButtonElement=function(t){this.$button&&this.$button.removeClass("oo-ui-buttonElement-button").removeAttr("role accesskey").off({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),this.$button=t.addClass("oo-ui-buttonElement-button").on({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),"A"===this.$button.prop("tagName").toUpperCase()&&this.$button.attr("role","button")},m.ui.mixin.ButtonElement.prototype.onMouseDown=function(t){if(!this.isDisabled()&&t.which===m.ui.MouseButtons.LEFT)return this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseUpHandler,!0),!this.constructor.static.cancelButtonMouseDownEvents&&void 0},m.ui.mixin.ButtonElement.prototype.onDocumentMouseUp=function(t){this.isDisabled()||t.which!==m.ui.MouseButtons.LEFT||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseUpHandler,!0))},m.ui.mixin.ButtonElement.prototype.onClick=function(t){if(!this.isDisabled()&&t.which===m.ui.MouseButtons.LEFT&&this.emit("click"))return!1},m.ui.mixin.ButtonElement.prototype.onKeyDown=function(t){this.isDisabled()||t.which!==m.ui.Keys.SPACE&&t.which!==m.ui.Keys.ENTER||(this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("keyup",this.onDocumentKeyUpHandler,!0))},m.ui.mixin.ButtonElement.prototype.onDocumentKeyUp=function(t){this.isDisabled()||t.which!==m.ui.Keys.SPACE&&t.which!==m.ui.Keys.ENTER||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("keyup",this.onDocumentKeyUpHandler,!0))},m.ui.mixin.ButtonElement.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===m.ui.Keys.SPACE||t.which===m.ui.Keys.ENTER)&&this.emit("click"))return!1},m.ui.mixin.ButtonElement.prototype.isFramed=function(){return this.framed},m.ui.mixin.ButtonElement.prototype.toggleFramed=function(t){return(t=void 0===t?!this.framed:!!t)!==this.framed&&(this.framed=t,this.$element.toggleClass("oo-ui-buttonElement-frameless",!t).toggleClass("oo-ui-buttonElement-framed",t),this.updateThemeClasses()),this},m.ui.mixin.ButtonElement.prototype.setActive=function(t){return this.active=!!t,this.$element.toggleClass("oo-ui-buttonElement-active",this.active),this.updateThemeClasses(),this},m.ui.mixin.ButtonElement.prototype.isActive=function(){return this.active},m.ui.mixin.GroupElement=function(t){m.EmitterList.call(this,t=t||{}),this.$group=null,this.setGroupElement(t.$group||$("<div>"))},m.mixinClass(m.ui.mixin.GroupElement,m.EmitterList),m.ui.mixin.GroupElement.prototype.setGroupElement=function(t){this.$group=t;for(let t=0,e=this.items.length;t<e;t++)this.$group.append(this.items[t].$element)},m.ui.mixin.GroupElement.prototype.findItemFromData=function(t){var i=m.getHash(t);for(let t=0,e=this.items.length;t<e;t++){var o=this.items[t];if(i===m.getHash(o.getData()))return o}return null},m.ui.mixin.GroupElement.prototype.findItemsFromData=function(t){var i=m.getHash(t),o=[];for(let t=0,e=this.items.length;t<e;t++){var n=this.items[t];i===m.getHash(n.getData())&&o.push(n)}return o},m.ui.mixin.GroupElement.prototype.addItems=function(t,e){return t&&0!==t.length&&(m.EmitterList.prototype.addItems.call(this,t,e),this.emit("change",this.getItems())),this},m.ui.mixin.GroupElement.prototype.moveItem=function(t,e){return this.insertItemElements(t,e),e=m.EmitterList.prototype.moveItem.call(this,t,e)},m.ui.mixin.GroupElement.prototype.insertItem=function(t,e){return t.setElementGroup(this),this.insertItemElements(t,e),e=m.EmitterList.prototype.insertItem.call(this,t,e)},m.ui.mixin.GroupElement.prototype.insertItemElements=function(t,e){void 0===e||e<0||e>=this.items.length?this.$group.append(t.$element):0===e?this.$group.prepend(t.$element):this.items[e].$element.before(t.$element)},m.ui.mixin.GroupElement.prototype.removeItems=function(i){if(0!==i.length){for(let t=0,e=i.length;t<e;t++){var o=i[t];-1!==this.items.indexOf(o)&&(o.setElementGroup(null),o.$element.detach())}m.EmitterList.prototype.removeItems.call(this,i),this.emit("change",this.getItems())}return this},m.ui.mixin.GroupElement.prototype.clearItems=function(){for(let t=0,e=this.items.length;t<e;t++)this.items[t].setElementGroup(null),this.items[t].$element.detach();return m.EmitterList.prototype.clearItems.call(this),this.emit("change",this.getItems()),this},m.ui.mixin.LabelElement=function(t){t=t||{},this.$label=null,this.label=null,this.invisibleLabel=!1,this.setLabel(t.label||this.constructor.static.label),this.setLabelElement(t.$label||$("<span>")),this.setInvisibleLabel(t.invisibleLabel)},m.initClass(m.ui.mixin.LabelElement),m.ui.mixin.LabelElement.static.label=null,m.ui.mixin.LabelElement.static.highlightQuery=function(e,i,o,t){let n=-1,s=0,l,u;var a=$("<span>");if(o){var r=e.length,h=i.length;for(let t=0;-1===n&&t<=r-h;t++)0===o(i,e.slice(t,t+h))&&(n=t)}else n=e.toLowerCase().indexOf(i.toLowerCase());return i.length&&-1!==n?(t&&(l=new RegExp("(^)[̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣ৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఀ-ఄా-ౄె-ైొ-్ౕౖౢౣಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝᠋-᠍ᢅᢆᢩᤠ-ᤫᤰ-᤻ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼᪰-᪾ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-ᮭ᯦-᯳ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ-᳴᳷-᳹᷀-᷹᷻-᷿⃐-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣠-꣱ꣿꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꧥꨩ-ꨶꩃꩌꩍꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︯]*"),u=e.slice(n+i.length).match(l))&&u.length&&(s=u[0].length),a.append(document.createTextNode(e.slice(0,n)),$("<span>").addClass("oo-ui-labelElement-label-highlight").text(e.slice(n,n+i.length+s)),document.createTextNode(e.slice(n+i.length+s)))):a.text(e),a.contents()},m.ui.mixin.LabelElement.prototype.setLabelElement=function(t){return this.$label&&this.$label.removeClass("oo-ui-labelElement-label").empty(),this.$label=t.addClass("oo-ui-labelElement-label"),this.setLabelContent(this.label),this},m.ui.mixin.LabelElement.prototype.setLabelId=function(t){return this.$label.attr("id",t),this},m.ui.mixin.LabelElement.prototype.setLabel=function(t){return t=("string"==typeof(t=m.ui.resolveMsg(t))||t instanceof $)&&t.length||t instanceof m.ui.HtmlSnippet&&t.toString().length?t:null,this.label!==t&&(this.$label&&this.setLabelContent(t),this.label=t,this.$element.toggleClass("oo-ui-labelElement",!!this.label&&!this.invisibleLabel),this.emit("labelChange")),this},m.ui.mixin.LabelElement.prototype.setInvisibleLabel=function(t){return this.invisibleLabel!==(t=!!t)&&(this.invisibleLabel=t,this.$label.toggleClass("oo-ui-labelElement-invisible",this.invisibleLabel),this.$element.toggleClass("oo-ui-labelElement",!!this.label&&!this.invisibleLabel),this.emit("labelChange")),this},m.ui.mixin.LabelElement.prototype.setHighlightedQuery=function(t,e,i,o){return this.setLabel(this.constructor.static.highlightQuery(t,e,i,o))},m.ui.mixin.LabelElement.prototype.getLabel=function(){return this.label},m.ui.mixin.LabelElement.prototype.setLabelContent=function(t){"string"==typeof t?t.match(/^\s*$/)?this.$label.html("&nbsp;"):this.$label.text(t):t instanceof m.ui.HtmlSnippet?this.$label.html(t.toString()):t instanceof $?this.$label.empty().append(t):this.$label.empty()},m.ui.mixin.IconElement=function(t){t=t||{},this.$icon=null,this.icon=null,this.setIcon(t.icon||this.constructor.static.icon),this.setIconElement(t.$icon||$("<span>"))},m.initClass(m.ui.mixin.IconElement),m.ui.mixin.IconElement.static.icon=null,m.ui.mixin.IconElement.static.iconTitle=null,m.ui.mixin.IconElement.prototype.setIconElement=function(t){this.$icon&&this.$icon.removeClass("oo-ui-iconElement-icon oo-ui-icon-"+this.icon).removeAttr("title"),this.$icon=t.addClass("oo-ui-iconElement-icon").toggleClass("oo-ui-iconElement-noIcon",!this.icon).toggleClass("oo-ui-icon-"+this.icon,!!this.icon),null!==this.iconTitle&&this.$icon.attr("title",this.iconTitle),this.updateThemeClasses()},m.ui.mixin.IconElement.prototype.setIcon=function(t){return t&&"string"!=typeof t&&(t=m.ui.getLocalValue(t,null,"default")),this.icon!==t&&(this.$element.toggleClass("oo-ui-iconElement",!!t),this.$icon&&(this.icon&&this.$icon.removeClass("oo-ui-icon-"+this.icon),t&&this.$icon.addClass("oo-ui-icon-"+t),this.$icon.toggleClass("oo-ui-iconElement-noIcon",!t)),this.icon=t,this.updateThemeClasses()),this},m.ui.mixin.IconElement.prototype.getIcon=function(){return this.icon},m.ui.mixin.IndicatorElement=function(t){t=t||{},this.$indicator=null,this.indicator=null,this.setIndicator(t.indicator||this.constructor.static.indicator),this.setIndicatorElement(t.$indicator||$("<span>"))},m.initClass(m.ui.mixin.IndicatorElement),m.ui.mixin.IndicatorElement.static.indicator=null,m.ui.mixin.IndicatorElement.static.indicatorTitle=null,m.ui.mixin.IndicatorElement.prototype.setIndicatorElement=function(t){this.$indicator&&this.$indicator.removeClass("oo-ui-indicatorElement-indicator oo-ui-indicator-"+this.indicator).removeAttr("title"),this.$indicator=t.addClass("oo-ui-indicatorElement-indicator").toggleClass("oo-ui-indicatorElement-noIndicator",!this.indicator).toggleClass("oo-ui-indicator-"+this.indicator,!!this.indicator),null!==this.indicatorTitle&&this.$indicator.attr("title",this.indicatorTitle),this.updateThemeClasses()},m.ui.mixin.IndicatorElement.prototype.setIndicator=function(t){return t="string"==typeof t&&t.length?t.trim():null,this.indicator!==t&&(this.$indicator&&(null!==this.indicator&&this.$indicator.removeClass("oo-ui-indicator-"+this.indicator),null!==t)&&this.$indicator.addClass("oo-ui-indicator-"+t),this.indicator=t),this.$element.toggleClass("oo-ui-indicatorElement",!!this.indicator),this.$indicator&&this.$indicator.toggleClass("oo-ui-indicatorElement-noIndicator",!this.indicator),this.updateThemeClasses(),this},m.ui.mixin.IndicatorElement.prototype.getIndicator=function(){return this.indicator},m.ui.mixin.FlaggedElement=function(t){t=t||{},this.flags={},this.$flagged=null,this.setFlags(t.flags||this.constructor.static.flags),this.setFlaggedElement(t.$flagged||this.$element)},m.initClass(m.ui.mixin.FlaggedElement),m.ui.mixin.FlaggedElement.static.flags=null,m.ui.mixin.FlaggedElement.prototype.setFlaggedElement=function(t){var e=Object.keys(this.flags).map(t=>"oo-ui-flaggedElement-"+t);this.$flagged&&this.$flagged.removeClass(e),this.$flagged=t.addClass(e)},m.ui.mixin.FlaggedElement.prototype.hasFlag=function(t){return this.flags&&t in this.flags},m.ui.mixin.FlaggedElement.prototype.getFlags=function(){return Object.keys(this.flags||{})},m.ui.mixin.FlaggedElement.prototype.clearFlags=function(){var t={},e=[];for(const o in this.flags){var i="oo-ui-flaggedElement-"+o;t[o]=!1,delete this.flags[o],e.push(i)}return this.$flagged&&this.$flagged.removeClass(e),this.updateThemeClasses(),this.emit("flag",t),this},m.ui.mixin.FlaggedElement.prototype.setFlags=function(i){var o={},n=[],t=[],s="oo-ui-flaggedElement-";let l,u;if("string"==typeof i)l=s+i,this.flags[i]||(this.flags[i]=!0,n.push(l));else if(Array.isArray(i))for(let t=0,e=i.length;t<e;t++)u=i[t],l=s+u,this.flags[u]||(o[u]=!0,this.flags[u]=!0,n.push(l));else if(m.isPlainObject(i))for(u in i)l=s+u,i[u]?this.flags[u]||(o[u]=!0,this.flags[u]=!0,n.push(l)):this.flags[u]&&(o[u]=!1,delete this.flags[u],t.push(l));return this.$flagged&&this.$flagged.addClass(n).removeClass(t),this.updateThemeClasses(),this.emit("flag",o),this},m.ui.mixin.TitledElement=function(t){t=t||{},this.$titled=null,this.title=null;let e=(void 0!==t.title?t:this.constructor.static).title;null===e&&t.invisibleLabel&&"string"==typeof t.label&&(e=t.label),this.setTitle(e),this.setTitledElement(t.$titled||this.$element)},m.initClass(m.ui.mixin.TitledElement),m.ui.mixin.TitledElement.static.title=null,m.ui.mixin.TitledElement.prototype.setTitledElement=function(t){this.$titled&&this.$titled.removeAttr("title"),this.$titled=t,this.updateTitle()},m.ui.mixin.TitledElement.prototype.setTitle=function(t){return t=m.ui.resolveMsg(t),this.title!==(t="string"==typeof t?t:null)&&(this.title=t,this.updateTitle()),this},m.ui.mixin.TitledElement.prototype.updateTitle=function(){let t=this.getTitle();return this.$titled&&(null!==t?(this.formatTitleWithAccessKey&&(t=this.formatTitleWithAccessKey(t)),this.$titled.attr("title",t)):this.$titled.removeAttr("title")),this},m.ui.mixin.TitledElement.prototype.getTitle=function(){return this.title},m.ui.mixin.AccessKeyedElement=function(t){t=t||{},this.$accessKeyed=null,this.accessKey=null,this.setAccessKey(t.accessKey||null),this.setAccessKeyedElement(t.$accessKeyed||this.$element),this.updateTitle&&this.updateTitle()},m.initClass(m.ui.mixin.AccessKeyedElement),m.ui.mixin.AccessKeyedElement.static.accessKey=null,m.ui.mixin.AccessKeyedElement.prototype.setAccessKeyedElement=function(t){this.$accessKeyed&&this.$accessKeyed.removeAttr("accesskey"),this.$accessKeyed=t,this.accessKey&&this.$accessKeyed.attr("accesskey",this.accessKey)},m.ui.mixin.AccessKeyedElement.prototype.setAccessKey=function(t){return t=m.ui.resolveMsg(t),this.accessKey!==(t="string"==typeof t?t:null)&&(this.$accessKeyed&&(null!==t?this.$accessKeyed.attr("accesskey",t):this.$accessKeyed.removeAttr("accesskey")),this.accessKey=t,this.updateTitle)&&this.updateTitle(),this},m.ui.mixin.AccessKeyedElement.prototype.getAccessKey=function(){return this.accessKey},m.ui.mixin.AccessKeyedElement.prototype.formatTitleWithAccessKey=function(e){if(this.$accessKeyed){let t;(t=$.fn.updateTooltipAccessKeys&&$.fn.updateTooltipAccessKeys.getAccessKeyLabel?$.fn.updateTooltipAccessKeys.getAccessKeyLabel(this.$accessKeyed[0]):this.getAccessKey())&&(e+=" ["+t+"]")}return e},m.ui.mixin.RequiredElement=function(t){if(this.$required=(t=t||{}).$required||this.$input||this.$element,this.required=!1,this.indicatorElement=void 0!==t.indicatorElement?t.indicatorElement:this,this.indicatorElement&&!this.indicatorElement.getIndicator)throw new Error("config.indicatorElement must mixin OO.ui.mixin.IndicatorElement.");this.setRequired(!!t.required)},m.initClass(m.ui.mixin.RequiredElement),m.ui.mixin.RequiredElement.prototype.setRequiredElement=function(t){this.$required!==t&&(this.$required&&this.required&&this.updateRequiredElement(!1),this.$required=t,this.updateRequiredElement())},m.ui.mixin.RequiredElement.prototype.updateRequiredElement=function(t){void 0===t&&(t=this.required),this.$required.prop("required",t)},m.ui.mixin.RequiredElement.prototype.isRequired=function(){return this.required},m.ui.mixin.RequiredElement.prototype.setRequired=function(t){var e;return this.required!==t&&(this.required=!!t,this.updateRequiredElement(),this.indicatorElement&&(e=t?null:"required",this.indicatorElement.getIndicator()===e))&&this.indicatorElement.setIndicator(t?"required":null),this},m.ui.ButtonWidget=function(t){m.ui.ButtonWidget.super.call(this,t=t||{}),m.ui.mixin.ButtonElement.call(this,t),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.IndicatorElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$button},t)),m.ui.mixin.FlaggedElement.call(this,t),m.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$button},t)),m.ui.mixin.AccessKeyedElement.call(this,Object.assign({$accessKeyed:this.$button},t)),this.href=null,this.target=null,this.noFollow=!1,this.rel=[],this.connect(this,{disable:"onDisable"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonWidget").append(this.$button),this.setActive(t.active),this.setHref(t.href),this.setTarget(t.target),void 0!==t.rel?this.setRel(t.rel):this.setNoFollow(t.noFollow)},m.inheritClass(m.ui.ButtonWidget,m.ui.Widget),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.ButtonElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.IndicatorElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.FlaggedElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.TabIndexedElement),m.mixinClass(m.ui.ButtonWidget,m.ui.mixin.AccessKeyedElement),m.ui.ButtonWidget.static.cancelButtonMouseDownEvents=!1,m.ui.ButtonWidget.static.tagName="span",m.ui.ButtonWidget.prototype.getHref=function(){return this.href},m.ui.ButtonWidget.prototype.getTarget=function(){return this.target},m.ui.ButtonWidget.prototype.getNoFollow=function(){return this.noFollow},m.ui.ButtonWidget.prototype.getRel=function(){return this.rel},m.ui.ButtonWidget.prototype.setHref=function(t){return(t=null===(t="string"==typeof t?t:null)||m.ui.isSafeUrl(t)?t:"./"+t)!==this.href&&(this.href=t,this.updateHref()),this},m.ui.ButtonWidget.prototype.updateHref=function(){return null===this.href||this.isDisabled()?this.$button.removeAttr("href"):this.$button.attr("href",this.href),this},m.ui.ButtonWidget.prototype.onDisable=function(){this.updateHref()},m.ui.ButtonWidget.prototype.setTarget=function(t){return(t="string"==typeof t?t:null)!==this.target&&(null!==(this.target=t)?this.$button.attr("target",t):this.$button.removeAttr("target")),this},m.ui.ButtonWidget.prototype.setNoFollow=function(e){if((e="boolean"!=typeof e||e)!==this.noFollow){let t;t=e?this.rel.concat(["nofollow"]):this.rel.filter(t=>"nofollow"!==t),this.setRel(t)}return this},m.ui.ButtonWidget.prototype.setRel=function(t){return Array.isArray(t)||(t=t?[t]:[]),this.rel=t,this.noFollow=-1!==t.indexOf("nofollow"),this.$button.attr("rel",t.join(" ")||null),this},m.ui.ButtonGroupWidget=function(t){m.ui.ButtonGroupWidget.super.call(this,t=t||{}),m.ui.mixin.GroupElement.call(this,Object.assign({$group:this.$element},t)),m.ui.mixin.TitledElement.call(this,t),this.$element.addClass("oo-ui-buttonGroupWidget"),this.addItems(t.items||[])},m.inheritClass(m.ui.ButtonGroupWidget,m.ui.Widget),m.mixinClass(m.ui.ButtonGroupWidget,m.ui.mixin.GroupElement),m.mixinClass(m.ui.ButtonGroupWidget,m.ui.mixin.TitledElement),m.ui.ButtonGroupWidget.static.tagName="span",m.ui.ButtonGroupWidget.prototype.focus=function(){return this.isDisabled()||this.items[0]&&this.items[0].focus(),this},m.ui.ButtonGroupWidget.prototype.simulateLabelClick=function(){this.focus()},m.ui.IconWidget=function(t){m.ui.IconWidget.super.call(this,t=t||{}),m.ui.mixin.IconElement.call(this,Object.assign({$icon:this.$element},t)),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$element},t)),m.ui.mixin.LabelElement.call(this,Object.assign({$label:this.$element,invisibleLabel:!0},t)),m.ui.mixin.FlaggedElement.call(this,Object.assign({$flagged:this.$element},t)),this.$element.addClass("oo-ui-iconWidget"),this.$element.removeClass("oo-ui-labelElement-label")},m.inheritClass(m.ui.IconWidget,m.ui.Widget),m.mixinClass(m.ui.IconWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.IconWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.IconWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.IconWidget,m.ui.mixin.FlaggedElement),m.ui.IconWidget.static.tagName="span",m.ui.IndicatorWidget=function(t){m.ui.IndicatorWidget.super.call(this,t=t||{}),m.ui.mixin.IndicatorElement.call(this,Object.assign({$indicator:this.$element},t)),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$element},t)),m.ui.mixin.LabelElement.call(this,Object.assign({$label:this.$element,invisibleLabel:!0},t)),this.$element.addClass("oo-ui-indicatorWidget"),this.$element.removeClass("oo-ui-labelElement-label")},m.inheritClass(m.ui.IndicatorWidget,m.ui.Widget),m.mixinClass(m.ui.IndicatorWidget,m.ui.mixin.IndicatorElement),m.mixinClass(m.ui.IndicatorWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.IndicatorWidget,m.ui.mixin.LabelElement),m.ui.IndicatorWidget.static.tagName="span",m.ui.LabelWidget=function(t){m.ui.LabelWidget.super.call(this,t=t||{}),m.ui.mixin.LabelElement.call(this,Object.assign({$label:this.$element},t)),m.ui.mixin.TitledElement.call(this,t),this.input=t.input,this.input&&(this.input.getInputId()?this.$element.attr("for",this.input.getInputId()):this.$label.on("click",()=>{this.input.simulateLabelClick()})),this.$element.addClass("oo-ui-labelWidget")},m.inheritClass(m.ui.LabelWidget,m.ui.Widget),m.mixinClass(m.ui.LabelWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.LabelWidget,m.ui.mixin.TitledElement),m.ui.LabelWidget.static.tagName="label",m.ui.MessageWidget=function(t){m.ui.MessageWidget.super.call(this,t=t||{}),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.TitledElement.call(this,t),m.ui.mixin.FlaggedElement.call(this,t),this.setType(t.type),this.setInline(t.inline),t.icon&&this.setIcon(t.icon),!this.inline&&t.showClose&&(this.closeButton=new m.ui.ButtonWidget({classes:["oo-ui-messageWidget-close"],framed:!1,icon:"close",label:m.ui.msg("ooui-popup-widget-close-button-aria-label"),invisibleLabel:!0}),this.closeButton.connect(this,{click:"onCloseButtonClick"}),this.$element.addClass("oo-ui-messageWidget-showClose")),this.$element.append(this.$icon,this.$label,this.closeButton&&this.closeButton.$element).addClass("oo-ui-messageWidget")},m.inheritClass(m.ui.MessageWidget,m.ui.Widget),m.mixinClass(m.ui.MessageWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.MessageWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.MessageWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.MessageWidget,m.ui.mixin.FlaggedElement),m.ui.MessageWidget.static.iconMap={notice:"infoFilled",error:"error",warning:"alert",success:"success"},m.ui.MessageWidget.prototype.setInline=function(t){this.inline!==(t=!!t)&&(this.inline=t,this.$element.toggleClass("oo-ui-messageWidget-block",!this.inline))},m.ui.MessageWidget.prototype.setType=function(t){this.constructor.static.iconMap[t]||(t="notice"),this.type!==t&&(this.clearFlags(),this.setFlags(t),this.setIcon(this.constructor.static.iconMap[t]),this.$icon.removeClass("oo-ui-image-"+this.type),this.$icon.addClass("oo-ui-image-"+t),"error"===t?(this.$element.attr("role","alert"),this.$element.removeAttr("aria-live")):(this.$element.removeAttr("role"),this.$element.attr("aria-live","polite")),this.type=t)},m.ui.MessageWidget.prototype.onCloseButtonClick=function(){this.toggle(!1),this.emit("close")},m.ui.ToggleWidget=function(t){m.ui.ToggleWidget.super.call(this,t=t||{}),m.ui.mixin.TitledElement.call(this,t),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!t.value)},m.inheritClass(m.ui.ToggleWidget,m.ui.Widget),m.mixinClass(m.ui.ToggleWidget,m.ui.mixin.TitledElement),m.ui.ToggleWidget.prototype.getValue=function(){return this.value},m.ui.ToggleWidget.prototype.setValue=function(t){return this.value!==(t=!!t)&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t)),this},m.ui.ToggleSwitchWidget=function(t){m.ui.ToggleSwitchWidget.super.call(this,t),m.ui.mixin.TabIndexedElement.call(this,t),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","switch").append(this.$glow,this.$grip)},m.inheritClass(m.ui.ToggleSwitchWidget,m.ui.ToggleWidget),m.mixinClass(m.ui.ToggleSwitchWidget,m.ui.mixin.TabIndexedElement),m.ui.ToggleSwitchWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==m.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},m.ui.ToggleSwitchWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===m.ui.Keys.SPACE||t.which===m.ui.Keys.ENTER))return this.setValue(!this.value),!1},m.ui.ToggleSwitchWidget.prototype.setValue=function(t){return m.ui.ToggleSwitchWidget.super.prototype.setValue.call(this,t),this.$element.attr("aria-checked",this.value.toString()),this},m.ui.ToggleSwitchWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.setValue(!this.value),this.focus()},m.ui.mixin.PendingElement=function(t){t=t||{},this.pending=0,this.$pending=null,this.setPendingElement(t.$pending||this.$element)},m.initClass(m.ui.mixin.PendingElement),m.ui.mixin.PendingElement.prototype.setPendingElement=function(t){this.$pending&&this.$pending.removeClass("oo-ui-pendingElement-pending"),this.$pending=t,0<this.pending&&this.$pending.addClass("oo-ui-pendingElement-pending")},m.ui.mixin.PendingElement.prototype.isPending=function(){return!!this.pending},m.ui.mixin.PendingElement.prototype.pushPending=function(){return 0===this.pending&&(this.$pending.addClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending++,this},m.ui.mixin.PendingElement.prototype.popPending=function(){return 1===this.pending&&(this.$pending.removeClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending=Math.max(0,this.pending-1),this},m.ui.mixin.FloatableElement=function(t){t=t||{},this.$floatable=null,this.$floatableContainer=null,this.$floatableWindow=null,this.$floatableClosestScrollable=null,this.floatableOutOfView=!1,this.onFloatableScrollHandler=this.position.bind(this),this.onFloatableWindowResizeHandler=this.position.bind(this),this.setFloatableContainer(t.$floatableContainer),this.setFloatableElement(t.$floatable||this.$element),this.setVerticalPosition(t.verticalPosition||"below"),this.setHorizontalPosition(t.horizontalPosition||"start"),this.spacing=t.spacing||0,this.hideWhenOutOfView=void 0===t.hideWhenOutOfView||!!t.hideWhenOutOfView},m.ui.mixin.FloatableElement.prototype.setFloatableElement=function(t){this.$floatable&&(this.$floatable.removeClass("oo-ui-floatableElement-floatable"),this.$floatable.css({top:"",left:"",bottom:"",right:""})),this.$floatable=t.addClass("oo-ui-floatableElement-floatable"),this.position()},m.ui.mixin.FloatableElement.prototype.setFloatableContainer=function(t){this.$floatableContainer=t,this.$floatable&&this.position()},m.ui.mixin.FloatableElement.prototype.setVerticalPosition=function(t){if(-1===["below","above","top","bottom","center"].indexOf(t))throw new Error("Invalid value for vertical position: "+t);this.verticalPosition!==t&&(this.verticalPosition=t,this.$floatable)&&this.position()},m.ui.mixin.FloatableElement.prototype.setHorizontalPosition=function(t){if(-1===["before","after","start","end","center"].indexOf(t))throw new Error("Invalid value for horizontal position: "+t);this.horizontalPosition!==t&&(this.horizontalPosition=t,this.$floatable)&&this.position()},m.ui.mixin.FloatableElement.prototype.togglePositioning=function(e){if(this.$floatable&&this.$floatableContainer&&(!(e=void 0===e?!this.positioning:!!e)||this.warnedUnattached||this.isElementAttached()||(m.ui.warnDeprecation("FloatableElement#togglePositioning: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.positioning!==e)){this.positioning=e;let t=m.ui.Element.static.getClosestScrollableContainer(this.$floatableContainer[0]);$(t).is("html, body")&&(t=m.ui.Element.static.getWindow(t)),e?(this.$floatableWindow=$(this.getElementWindow()),this.$floatableWindow.on("resize",this.onFloatableWindowResizeHandler),this.$floatableClosestScrollable=$(t),this.$floatableClosestScrollable.on("scroll",this.onFloatableScrollHandler),this.position()):(this.$floatableWindow&&(this.$floatableWindow.off("resize",this.onFloatableWindowResizeHandler),this.$floatableWindow=null),this.$floatableClosestScrollable&&(this.$floatableClosestScrollable.off("scroll",this.onFloatableScrollHandler),this.$floatableClosestScrollable=null),this.$floatable.css({top:"",left:"",bottom:"",right:""}))}return this},m.ui.mixin.FloatableElement.prototype.isElementInViewport=function(t,e){var i=t.css("direction"),t=t[0].getBoundingClientRect();let o;e[0]===window?(n=m.ui.getViewportSpacing(),(o={top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight}).top+=n.top,o.left+=n.left,o.right-=n.right,o.bottom-=n.bottom):o=e[0].getBoundingClientRect();var n=t.top>=o.top&&t.top<=o.bottom,e=t.bottom>=o.top&&t.bottom<=o.bottom,s=t.left>=o.left&&t.left<=o.right,l=t.right>=o.left&&t.right<=o.right;let u,a;return a="rtl"===i?(u=l,s):(u=s,l),!("below"===this.verticalPosition&&!e)&&("above"!==this.verticalPosition||n)&&!("before"===this.horizontalPosition&&!u)&&!("after"===this.horizontalPosition&&!a)&&t.top<=o.bottom&&t.bottom>=o.top&&t.left<=o.right&&t.right>=o.left},m.ui.mixin.FloatableElement.prototype.isFloatableOutOfView=function(){return this.floatableOutOfView},m.ui.mixin.FloatableElement.prototype.position=function(){return this.positioning&&this.isElementAttached()&&(this.$floatableClosestScrollable[0]===this.getElementWindow()||$.contains(this.getElementDocument(),this.$floatableClosestScrollable[0]))&&(this.floatableOutOfView=this.hideWhenOutOfView&&!this.isElementInViewport(this.$floatableContainer,this.$floatableClosestScrollable),this.$floatable.toggleClass("oo-ui-element-hidden",this.floatableOutOfView),!this.floatableOutOfView)&&(this.$floatable.css(this.computePosition()),this.clip)&&this.clip(),this},m.ui.mixin.FloatableElement.prototype.computePosition=function(){var t={top:"",left:"",bottom:"",right:""},e=this.$floatableContainer.css("direction");let i=this.$floatable.offsetParent();var o=(i=i.is("html")?$(i[0].ownerDocument.body):i).is("body"),n="scroll"===i.css("overflow-x")||"auto"===i.css("overflow-x"),s="scroll"===i.css("overflow-y")||"auto"===i.css("overflow-y"),l=i.innerWidth()-i.prop("clientWidth"),u=i.innerHeight()-i.prop("clientHeight"),s=s&&!o?i.scrollTop():0,n=n&&!o?m.ui.Element.static.getScrollLeft(i[0]):0,a=o?this.$floatableContainer.offset():m.ui.Element.static.getRelativePosition(this.$floatableContainer,i);return a.bottom=a.top+this.$floatableContainer.outerHeight(),a.right=a.left+this.$floatableContainer.outerWidth(),a.start="rtl"===e?a.right:a.left,a.end="rtl"===e?a.left:a.right,"below"===this.verticalPosition?t.top=a.bottom+this.spacing:"above"===this.verticalPosition?t.bottom=i.outerHeight()-a.top+this.spacing:"top"===this.verticalPosition?t.top=a.top:"bottom"===this.verticalPosition?t.bottom=i.outerHeight()-a.bottom:"center"===this.verticalPosition&&(t.top=a.top+(this.$floatableContainer.height()-this.$floatable.height())/2),"before"===this.horizontalPosition?t.end=a.start-this.spacing:"after"===this.horizontalPosition?t.start=a.end+this.spacing:"start"===this.horizontalPosition?t.start=a.start:"end"===this.horizontalPosition?t.end=a.end:"center"===this.horizontalPosition&&(t.left=a.left+(this.$floatableContainer.width()-this.$floatable.width())/2),void 0!==t.start&&("rtl"===e?t.right=(o?$(i[0].ownerDocument.documentElement):i).outerWidth()-t.start:t.left=t.start,delete t.start),void 0!==t.end&&("rtl"===e?t.left=t.end:t.right=(o?$(i[0].ownerDocument.documentElement):i).outerWidth()-t.end,delete t.end),""!==t.top&&(t.top+=s),""!==t.bottom&&(t.bottom-=s),""!==t.left&&(t.left+=n),""!==t.right&&(t.right-=n),""!==t.bottom&&(t.bottom-=u),"rtl"===e?""!==t.left&&(t.left-=l):""!==t.right&&(t.right-=l),t},m.ui.mixin.ClippableElement=function(t){t=t||{},this.$clippable=null,this.$clippableContainer=null,this.clipping=!1,this.clippedHorizontally=!1,this.clippedVertically=!1,this.$clippableScrollableContainer=null,this.$clippableScroller=null,this.$clippableWindow=null,this.idealWidth=null,this.idealHeight=null,this.onClippableScrollHandler=this.clip.bind(this),this.onClippableWindowResizeHandler=this.clip.bind(this),t.$clippableContainer&&this.setClippableContainer(t.$clippableContainer),this.setClippableElement(t.$clippable||this.$element)},m.ui.mixin.ClippableElement.prototype.setClippableElement=function(t){this.$clippable&&(this.$clippable.removeClass("oo-ui-clippableElement-clippable"),this.$clippable.css({width:"",height:"",overflowX:"",overflowY:""}),m.ui.Element.static.reconsiderScrollbars(this.$clippable[0])),this.$clippable=t.addClass("oo-ui-clippableElement-clippable"),this.clip()},m.ui.mixin.ClippableElement.prototype.setClippableContainer=function(t){this.$clippableContainer=t,this.$clippable&&this.clip()},m.ui.mixin.ClippableElement.prototype.toggleClipping=function(t){return!(t=void 0===t?!this.clipping:!!t)||this.warnedUnattached||this.isElementAttached()||(m.ui.warnDeprecation("ClippableElement#toggleClipping: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.clipping!==t&&((this.clipping=t)?(this.$clippableScrollableContainer=$(this.getClosestScrollableElementContainer()),this.$clippableScroller=this.$clippableScrollableContainer.is("html, body")?$(m.ui.Element.static.getWindow(this.$clippableScrollableContainer)):this.$clippableScrollableContainer,this.$clippableScroller.on("scroll",this.onClippableScrollHandler),this.$clippableWindow=$(this.getElementWindow()).on("resize",this.onClippableWindowResizeHandler),this.clip()):(this.$clippable.css({width:"",height:"",maxWidth:"",maxHeight:"",overflowX:"",overflowY:""}),m.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.$clippableScrollableContainer=null,this.$clippableScroller.off("scroll",this.onClippableScrollHandler),this.$clippableScroller=null,this.$clippableWindow.off("resize",this.onClippableWindowResizeHandler),this.$clippableWindow=null)),this},m.ui.mixin.ClippableElement.prototype.isClipping=function(){return this.clipping},m.ui.mixin.ClippableElement.prototype.isClipped=function(){return this.clippedHorizontally||this.clippedVertically},m.ui.mixin.ClippableElement.prototype.isClippedHorizontally=function(){return this.clippedHorizontally},m.ui.mixin.ClippableElement.prototype.isClippedVertically=function(){return this.clippedVertically},m.ui.mixin.ClippableElement.prototype.setIdealSize=function(t,e){this.idealWidth=t,this.idealHeight=e,this.clipping||this.$clippable.css({width:t,height:e})},m.ui.mixin.ClippableElement.prototype.getHorizontalAnchorEdge=function(){return this.computePosition&&this.positioning&&""!==this.computePosition().right?"right":"left"},m.ui.mixin.ClippableElement.prototype.getVerticalAnchorEdge=function(){return this.computePosition&&this.positioning&&""!==this.computePosition().bottom?"bottom":"top"},m.ui.mixin.ClippableElement.prototype.clip=function(){if(this.clipping){var i=m.ui.getViewportSpacing();let t,e;this.$clippableScrollableContainer.is("html, body")?(t=$(this.$clippableScrollableContainer[0].ownerDocument.body),(e={top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight}).top+=i.top,e.left+=i.left,e.right-=i.right,e.bottom-=i.bottom):(t=this.$clippableScrollableContainer,e=a(e=t[0].getBoundingClientRect()));var o=t.css("direction"),n=t.innerWidth()-t.prop("clientWidth"),s=t.innerHeight()-t.prop("clientHeight"),s=(e.bottom-=s,"rtl"===o?e.left+=n:e.right-=n,e.top+=7,e.left+=7,e.right-=7,e.bottom-=7,this.$clippableContainer||this.$clippable),o=s.outerHeight()-this.$clippable.outerHeight(),n=s.outerWidth()-this.$clippable.outerWidth(),s=a(s=s[0].getBoundingClientRect()),l=("right"===this.getHorizontalAnchorEdge()?s.left=e.left:s.right=e.right,"bottom"===this.getVerticalAnchorEdge()?s.top=e.top:s.bottom=e.bottom,l=e,s=s,(u={}).top=Math.max(l.top,s.top),u.left=Math.max(l.left,s.left),u.bottom=Math.min(l.bottom,s.bottom),u.right=Math.min(l.right,s.right),u),s=Math.max(0,l.right-l.left),u=Math.max(0,l.bottom-l.top),s=Math.min(s,document.documentElement.clientWidth-i.left-i.right),u=Math.min(u,document.documentElement.clientHeight-i.top-i.right),l=Math.ceil(s-n),i=Math.ceil(u-o),s=l<this.$clippable.prop("scrollWidth"),n=i<this.$clippable.prop("scrollHeight");function a(t){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom,x:t.x,y:t.y,width:t.width,height:t.height}}s?(this.$clippable.css("overflowX","scroll"),this.$clippable[0].offsetHeight,this.$clippable.css("overflowX","auto"),this.$clippable[0].offsetHeight,this.$clippable.css({width:Math.max(0,l),maxWidth:""})):this.$clippable.css({overflowX:"",width:this.idealWidth||"",maxWidth:Math.max(0,l)}),n?(this.$clippable.css("overflowY","scroll"),this.$clippable[0].offsetHeight,this.$clippable.css("overflowY","auto"),this.$clippable[0].offsetHeight,this.$clippable.css({height:Math.max(0,i),maxHeight:""})):this.$clippable.css({overflowY:"",height:this.idealHeight||"",maxHeight:Math.max(0,i)}),(this.clippedHorizontally&&!s||this.clippedVertically&&!n)&&m.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.clippedHorizontally=s,this.clippedVertically=n}return this},m.ui.PopupWidget=function(t){m.ui.PopupWidget.super.call(this,t=t||{}),this.$body=$("<div>"),this.$popup=$("<div>"),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.ClippableElement.call(this,Object.assign({$clippable:this.$body,$clippableContainer:this.$popup},t)),m.ui.mixin.FloatableElement.call(this,t),this.$anchor=$("<div>"),this.$container=t.$container,this.containerPadding=void 0!==t.containerPadding?t.containerPadding:10,this.autoClose=!!t.autoClose,this.transitionTimeout=null,this.anchored=!1,this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.onTabKeyDownHandler=this.onTabKeyDown.bind(this),this.onShiftTabKeyDownHandler=this.onShiftTabKeyDown.bind(this),this.setSize(t.width,t.height),this.toggleAnchor(void 0===t.anchor||t.anchor),this.setAlignment(t.align||"center"),this.setPosition(t.position||"below"),this.setAutoFlip(void 0===t.autoFlip||t.autoFlip),this.setAutoCloseIgnore(t.$autoCloseIgnore),this.$body.addClass("oo-ui-popupWidget-body"),this.$anchor.addClass("oo-ui-popupWidget-anchor"),this.$popup.addClass("oo-ui-popupWidget-popup").append(this.$body),this.$element.addClass("oo-ui-popupWidget").append(this.$popup,this.$anchor),t.$content instanceof $&&this.$body.append(t.$content),this.padded=!!t.padded,t.padded&&this.$body.addClass("oo-ui-popupWidget-body-padded"),t.head&&(t.hideCloseButton||(this.closeButton=new m.ui.ButtonWidget({framed:!1,icon:"close",label:m.ui.msg("ooui-popup-widget-close-button-aria-label"),invisibleLabel:!0}),this.closeButton.connect(this,{click:"onCloseButtonClick"})),this.$head=$("<div>").addClass("oo-ui-popupWidget-head").append(this.$icon,this.$label,this.closeButton&&this.closeButton.$element),this.$popup.prepend(this.$head)),t.$footer&&(this.$footer=$("<div>").addClass("oo-ui-popupWidget-footer").append(t.$footer),this.$popup.append(this.$footer)),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},m.inheritClass(m.ui.PopupWidget,m.ui.Widget),m.mixinClass(m.ui.PopupWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.PopupWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.PopupWidget,m.ui.mixin.ClippableElement),m.mixinClass(m.ui.PopupWidget,m.ui.mixin.FloatableElement),m.ui.PopupWidget.prototype.onDocumentMouseDown=function(t){this.isVisible()&&!m.ui.contains(this.$element.add(this.$autoCloseIgnore).get(),t.target,!0)&&this.toggle(!1)},m.ui.PopupWidget.prototype.bindDocumentMouseDownListener=function(){this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.getElementDocument().addEventListener("click",this.onDocumentMouseDownHandler,!0)},m.ui.PopupWidget.prototype.onCloseButtonClick=function(){this.isVisible()&&this.toggle(!1)},m.ui.PopupWidget.prototype.unbindDocumentMouseDownListener=function(){this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.getElementDocument().removeEventListener("click",this.onDocumentMouseDownHandler,!0)},m.ui.PopupWidget.prototype.onDocumentKeyDown=function(t){t.which===m.ui.Keys.ESCAPE&&this.isVisible()&&(this.toggle(!1),t.preventDefault(),t.stopPropagation())},m.ui.PopupWidget.prototype.bindDocumentKeyDownListener=function(){this.getElementDocument().addEventListener("keydown",this.onDocumentKeyDownHandler,!0)},m.ui.PopupWidget.prototype.unbindDocumentKeyDownListener=function(){this.getElementDocument().removeEventListener("keydown",this.onDocumentKeyDownHandler,!0)},m.ui.PopupWidget.prototype.onTabKeyDown=function(t){t.shiftKey||t.which!==m.ui.Keys.TAB||(t.preventDefault(),this.toggle(!1))},m.ui.PopupWidget.prototype.onShiftTabKeyDown=function(t){t.shiftKey&&t.which===m.ui.Keys.TAB&&(t.preventDefault(),this.toggle(!1))},m.ui.PopupWidget.prototype.toggleAnchor=function(t){t=void 0===t?!this.anchored:!!t,this.anchored!==t&&(this.$element.toggleClass("oo-ui-popupWidget-anchored oo-ui-popupWidget-anchored-"+this.anchorEdge,t),this.anchored=t)},m.ui.PopupWidget.prototype.setAnchorEdge=function(t){if(-1===["top","bottom","start","end"].indexOf(t))throw new Error("Invalid value for edge: "+t);null!==this.anchorEdge&&this.$element.removeClass("oo-ui-popupWidget-anchored-"+this.anchorEdge),this.anchorEdge=t,this.anchored&&this.$element.addClass("oo-ui-popupWidget-anchored-"+t)},m.ui.PopupWidget.prototype.hasAnchor=function(){return this.anchored},m.ui.PopupWidget.prototype.toggle=function(t){var e,i=(t=void 0===t?!this.isVisible():!!t)!==this.isVisible();return!t||this.warnedUnattached||this.isElementAttached()||(m.ui.warnDeprecation("PopupWidget#toggle: Before calling this method, the popup must be attached to the DOM."),this.warnedUnattached=!0),t&&!this.$floatableContainer&&this.isElementAttached()&&this.setFloatableContainer(this.$element.parent()),i&&t&&this.autoFlip&&(this.isAutoFlipped=!1),m.ui.PopupWidget.super.prototype.toggle.call(this,t),i&&(this.togglePositioning(t&&!!this.$floatableContainer),i=m.ui.findFocusable(this.$element,!0),e=m.ui.findFocusable(this.$element,!1),t?(this.autoClose&&(this.bindDocumentMouseDownListener(),this.bindDocumentKeyDownListener(),i.on("keydown",this.onTabKeyDownHandler),e.on("keydown",this.onShiftTabKeyDownHandler)),this.updateDimensions(),this.toggleClipping(!0),this.autoFlip&&("above"!==this.popupPosition&&"below"!==this.popupPosition||(this.isClippedVertically()||this.isFloatableOutOfView())&&(t=this.$element.height(),this.isAutoFlipped=!this.isAutoFlipped,this.position(),this.isClippedVertically()||this.isFloatableOutOfView())&&this.$element.height()<=t&&(this.isAutoFlipped=!this.isAutoFlipped,this.position()),"before"!==this.popupPosition&&"after"!==this.popupPosition||(this.isClippedHorizontally()||this.isFloatableOutOfView())&&(t=this.$element.width(),this.isAutoFlipped=!this.isAutoFlipped,this.toggleClipping(!1),this.position(),this.toggleClipping(!0),this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.$element.width()<=t&&(this.isAutoFlipped=!this.isAutoFlipped,this.toggleClipping(!1),this.position(),this.toggleClipping(!0))),this.emit("ready")):(this.toggleClipping(!1),this.autoClose&&(i.off("keydown",this.onTabKeyDownHandler),e.off("keydown",this.onShiftTabKeyDownHandler),this.unbindDocumentMouseDownListener(),this.unbindDocumentKeyDownListener()),this.emit("closing"))),this},m.ui.PopupWidget.prototype.setSize=function(t,e,i){this.width=void 0!==t?t:320,this.height=void 0!==e?e:null,this.isVisible()&&this.updateDimensions(i)},m.ui.PopupWidget.prototype.updateDimensions=function(t){clearTimeout(this.transitionTimeout),t&&this.$element.addClass("oo-ui-popupWidget-transitioning"),this.position(),t?this.transitionTimeout=setTimeout(()=>{this.$element.removeClass("oo-ui-popupWidget-transitioning")},200):this.$element.removeClass("oo-ui-popupWidget-transitioning")},m.ui.PopupWidget.prototype.computePosition=function(){var t={},e={left:"",right:"",top:"",bottom:""},i={forwards:"start",center:"center",backwards:this.anchored?"before":"end"},o=(this.$container||(this.$container=$(this.getClosestScrollableElementContainer())),this.$container.css("direction")),n=(this.setIdealSize(null!==this.width?this.width-(this.padded?24:0):"auto",null!==this.height?this.height-(this.padded?10:0):"auto"),{ltr:{"force-left":"backwards","force-right":"forwards"},rtl:{"force-left":"forwards","force-right":"backwards"}}[o][this.align]||this.align);let s=this.popupPosition;var l="before"===(s=this.isAutoFlipped?{above:"below",below:"above",before:"after",after:"before"}[s]:s)||"after"===s,u=l?"top":"rtl"===o?"right":"left",o=l?"bottom":"rtl"===o?"left":"right",a=l?"top":"left",r=l?"bottom":"right",h=l?"Height":"Width",d=l?this.$popup.height():this.$popup.width(),i=(this.setAnchorEdge({above:"bottom",below:"top",before:"end",after:"start"}[s]),this.horizontalPosition=l?s:i[n],this.verticalPosition=l?{forwards:"top",center:"center",backwards:"bottom"}[n]:s,m.ui.mixin.FloatableElement.prototype.computePosition.call(this)),n=l?""!==i.top?"top":"bottom":""!==i.left?"left":"right",l=this.$floatableContainer.offset(),c=(l[r]=l[a]+this.$floatableContainer["outer"+h](),this.$element.offsetParent()[0]===document.documentElement?{top:0,left:0}:this.$element.offsetParent().offset());n==a?(t[a]=c[a]+i[a],t[r]=t[a]+d):(t[r]=c[a]+this.$element.offsetParent()["inner"+h]()-i[r],t[a]=t[r]-d);let p,g;g=this.anchored?(c=(l[u]+l[o])/2,p=(u==r?-1:1)*(c-t[u]),l=this.$anchor[0]["scroll"+h],c=parseFloat(this.$anchor.css("margin-"+u)),p+c<2*l?(n==u?-1:1)*(2*l-(p+c)):p+c>d-2*l?(n==o?-1:1)*(p+c-(d-2*l)):0):0;o=this.$container[0]===document.documentElement?{top:0,left:0}:this.$container.offset();return o[r]=o[a]+this.$container["inner"+h](),this.$container[0]===document.documentElement&&(c=m.ui.getViewportSpacing(),o[a]+=c[a],o[r]-=c[r]),t[a]+=(n==a?1:-1)*g,t[r]+=(n==a?1:-1)*g,o[a]+this.containerPadding>t[a]?g+=(n==a?1:-1)*(o[a]+this.containerPadding-t[a]):o[r]-this.containerPadding<t[r]&&(g+=(n==r?1:-1)*(t[r]-(o[r]-this.containerPadding))),this.anchored&&(p+=(n==u?-1:1)*g,e[u]=p,this.$anchor.css(e)),i[n]+=g,i},m.ui.PopupWidget.prototype.setAlignment=function(t){-1<["force-left","force-right","backwards","forwards","center"].indexOf(t)?this.align=t:this.align="center",this.position()},m.ui.PopupWidget.prototype.getAlignment=function(){return this.align},m.ui.PopupWidget.prototype.setPosition=function(t){-1===["above","below","before","after"].indexOf(t)&&(t="below"),this.popupPosition=t,this.position()},m.ui.PopupWidget.prototype.getPosition=function(){return this.popupPosition},m.ui.PopupWidget.prototype.setAutoFlip=function(t){this.autoFlip!==(t=!!t)&&(this.autoFlip=t)},m.ui.PopupWidget.prototype.setAutoCloseIgnore=function(t){this.$autoCloseIgnore=t},m.ui.PopupWidget.prototype.getBodyId=function(){let t=this.$body.attr("id");return void 0===t&&(t=m.ui.generateElementId(),this.$body.attr("id",t)),t},m.ui.mixin.PopupElement=function(t){t=t||{},this.popup=new m.ui.PopupWidget(Object.assign({autoClose:!0,$floatableContainer:this.$element},t.popup,{$autoCloseIgnore:this.$element.add(t.popup&&t.popup.$autoCloseIgnore)}))},m.ui.mixin.PopupElement.prototype.getPopup=function(){return this.popup},m.ui.PopupButtonWidget=function(t){m.ui.PopupButtonWidget.super.call(this,t=t||{}),m.ui.mixin.PopupElement.call(this,t),this.$overlay=(!0===t.$overlay?m.ui.getDefaultOverlay():t.$overlay)||this.$element,this.connect(this,{click:"onAction"}),this.$element.addClass("oo-ui-popupButtonWidget"),this.$button.attr({"aria-haspopup":"dialog","aria-owns":this.popup.getElementId()}),this.popup.$element.addClass("oo-ui-popupButtonWidget-popup").attr({role:"dialog","aria-describedby":this.getElementId()}).toggleClass("oo-ui-popupButtonWidget-framed-popup",this.isFramed()).toggleClass("oo-ui-popupButtonWidget-frameless-popup",!this.isFramed()),this.$overlay.append(this.popup.$element)},m.inheritClass(m.ui.PopupButtonWidget,m.ui.ButtonWidget),m.mixinClass(m.ui.PopupButtonWidget,m.ui.mixin.PopupElement),m.ui.PopupButtonWidget.prototype.onAction=function(){this.popup.toggle()},m.ui.mixin.GroupWidget=function(t){m.ui.mixin.GroupElement.call(this,t)},m.mixinClass(m.ui.mixin.GroupWidget,m.ui.mixin.GroupElement),m.ui.mixin.GroupWidget.prototype.setDisabled=function(t){if(m.ui.Widget.prototype.setDisabled.call(this,t),this.items)for(let t=0,e=this.items.length;t<e;t++)this.items[t].updateDisabled();return this},m.ui.mixin.ItemWidget=function(){},m.ui.mixin.ItemWidget.prototype.isDisabled=function(){return this.disabled||this.elementGroup instanceof m.ui.Widget&&this.elementGroup.isDisabled()},m.ui.mixin.ItemWidget.prototype.setElementGroup=function(t){return m.ui.Element.prototype.setElementGroup.call(this,t),this.updateDisabled(),this},m.ui.OptionWidget=function(t){m.ui.OptionWidget.super.call(this,t=t||{}),m.ui.mixin.ItemWidget.call(this),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.FlaggedElement.call(this,t),m.ui.mixin.AccessKeyedElement.call(this,t),m.ui.mixin.TitledElement.call(this,t),this.highlighted=!1,this.pressed=!1,this.setSelected(!!t.selected),this.$element.data("oo-ui-optionWidget",this).attr({tabindex:"-1",role:"option"}).addClass("oo-ui-optionWidget").append(this.$label)},m.inheritClass(m.ui.OptionWidget,m.ui.Widget),m.mixinClass(m.ui.OptionWidget,m.ui.mixin.ItemWidget),m.mixinClass(m.ui.OptionWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.OptionWidget,m.ui.mixin.FlaggedElement),m.mixinClass(m.ui.OptionWidget,m.ui.mixin.AccessKeyedElement),m.mixinClass(m.ui.OptionWidget,m.ui.mixin.TitledElement),m.ui.OptionWidget.static.selectable=!0,m.ui.OptionWidget.static.highlightable=!0,m.ui.OptionWidget.static.pressable=!0,m.ui.OptionWidget.static.scrollIntoViewOnSelect=!1,m.ui.OptionWidget.prototype.isSelectable=function(){return this.constructor.static.selectable&&!this.disabled&&this.isVisible()},m.ui.OptionWidget.prototype.isHighlightable=function(){return this.constructor.static.highlightable&&!this.disabled&&this.isVisible()},m.ui.OptionWidget.prototype.isPressable=function(){return this.constructor.static.pressable&&!this.disabled&&this.isVisible()},m.ui.OptionWidget.prototype.isSelected=function(){return this.selected},m.ui.OptionWidget.prototype.isHighlighted=function(){return this.highlighted},m.ui.OptionWidget.prototype.isPressed=function(){return this.pressed},m.ui.OptionWidget.prototype.setSelected=function(t){return this.constructor.static.selectable&&(this.selected=!!t,this.$element.toggleClass("oo-ui-optionWidget-selected",t).attr("aria-selected",this.selected.toString()),t&&this.constructor.static.scrollIntoViewOnSelect&&this.scrollElementIntoView(),this.updateThemeClasses()),this},m.ui.OptionWidget.prototype.setHighlighted=function(t){return this.constructor.static.highlightable&&(this.highlighted=!!t,this.$element.toggleClass("oo-ui-optionWidget-highlighted",t),this.updateThemeClasses()),this},m.ui.OptionWidget.prototype.setPressed=function(t){return this.constructor.static.pressable&&(this.pressed=!!t,this.$element.toggleClass("oo-ui-optionWidget-pressed",t),this.updateThemeClasses()),this},m.ui.OptionWidget.prototype.getMatchText=function(){var t=this.getLabel();return"string"==typeof t?t:this.$label.text()},m.ui.SelectWidget=function(t){m.ui.SelectWidget.super.call(this,t=t||{}),m.ui.mixin.GroupWidget.call(this,Object.assign({$group:this.$element},t)),this.pressed=!1,this.selecting=null,this.multiselect=!!t.multiselect,this.onDocumentMouseUpHandler=this.onDocumentMouseUp.bind(this),this.onDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.onDocumentKeyPressHandler=this.onDocumentKeyPress.bind(this),this.keyPressBuffer="",this.keyPressBufferTimer=null,this.blockMouseOverEvents=0,this.connect(this,{toggle:"onToggle"}),this.$element.on({focusin:this.onFocus.bind(this),mousedown:this.onMouseDown.bind(this),mouseover:this.onMouseOver.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.$element.addClass("oo-ui-selectWidget oo-ui-selectWidget-unpressed").attr({role:"listbox","aria-multiselectable":this.multiselect.toString()}),this.setFocusOwner(this.$element),this.addItems(t.items||[])},m.inheritClass(m.ui.SelectWidget,m.ui.Widget),m.mixinClass(m.ui.SelectWidget,m.ui.mixin.GroupWidget),m.ui.SelectWidget.static.handleNavigationKeys=!1,m.ui.SelectWidget.static.listWrapsAround=!0,m.ui.SelectWidget.static.normalizeForMatching=function(t){let e=t.trim().replace(/\s+/," ").toLowerCase();return e=e.normalize()},m.ui.SelectWidget.prototype.onFocus=function(t){let e;if(t.target===this.$element[0])this.findFirstSelectedItem()||(e=this.findFirstSelectableItem());else{if(-1!==t.target.tabIndex)return;if((e=this.findTargetItem(t))&&!e.isHighlightable()&&!e.isSelectable())return}e&&(e.constructor.static.highlightable?this.highlightItem(e):this.selectItem(e)),t.target!==this.$element[0]&&this.$focusOwner.trigger("focus")},m.ui.SelectWidget.prototype.onMouseDown=function(t){return this.isDisabled()||t.which!==m.ui.MouseButtons.LEFT||(this.togglePressed(!0),(t=this.findTargetItem(t))&&t.isSelectable()&&(this.pressItem(t),this.selecting=t,this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseUpHandler,!0),this.getElementDocument().addEventListener("mousemove",this.onDocumentMouseMoveHandler,!0))),!1},m.ui.SelectWidget.prototype.onDocumentMouseUp=function(t){var e;return this.togglePressed(!1),this.selecting||(e=this.findTargetItem(t))&&e.isSelectable()&&(this.selecting=e),!this.isDisabled()&&t.which===m.ui.MouseButtons.LEFT&&this.selecting&&(this.pressItem(null),this.chooseItem(this.selecting),this.selecting=null),this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseUpHandler,!0),this.getElementDocument().removeEventListener("mousemove",this.onDocumentMouseMoveHandler,!0),!1},m.ui.SelectWidget.prototype.onDocumentMouseMove=function(t){!this.isDisabled()&&this.pressed&&(t=this.findTargetItem(t))&&t!==this.selecting&&t.isSelectable()&&(this.pressItem(t),this.selecting=t)},m.ui.SelectWidget.prototype.onMouseOver=function(t){if(!this.blockMouseOverEvents)return this.isDisabled()||(t=this.findTargetItem(t),this.highlightItem(t&&t.isHighlightable()?t:null)),!1},m.ui.SelectWidget.prototype.onMouseLeave=function(){return this.isDisabled()||this.highlightItem(null),!1},m.ui.SelectWidget.prototype.onDocumentKeyDown=function(t){let e=!1;var i=this.isVisible()&&this.findHighlightedItem()||!this.multiselect&&this.findSelectedItem();let o;if(!this.isDisabled()){switch(t.keyCode){case m.ui.Keys.ENTER:i&&(this.chooseItem(i),e=!0);break;case m.ui.Keys.UP:case m.ui.Keys.LEFT:case m.ui.Keys.DOWN:case m.ui.Keys.RIGHT:this.clearKeyPressBuffer(),o=this.findRelativeSelectableItem(i,t.keyCode===m.ui.Keys.UP||t.keyCode===m.ui.Keys.LEFT?-1:1,null,this.constructor.static.listWrapsAround),e=!0;break;case m.ui.Keys.HOME:case m.ui.Keys.END:this.constructor.static.handleNavigationKeys&&(this.clearKeyPressBuffer(),o=this.findRelativeSelectableItem(null,t.keyCode===m.ui.Keys.HOME?1:-1,null,this.constructor.static.listWrapsAround),e=!0);break;case m.ui.Keys.PAGEUP:case m.ui.Keys.PAGEDOWN:this.constructor.static.handleNavigationKeys&&(this.clearKeyPressBuffer(),o=this.findRelativeSelectableItem(i,t.keyCode===m.ui.Keys.PAGEUP?-10:10,null,this.constructor.static.listWrapsAround),e=!0);break;case m.ui.Keys.ESCAPE:case m.ui.Keys.TAB:i&&i.setHighlighted(!1),this.unbindDocumentKeyDownListener(),this.unbindDocumentKeyPressListener(),e=!1}o&&(this.isVisible()&&o.constructor.static.highlightable?this.highlightItem(o):(this.screenReaderMode&&this.highlightItem(o),this.chooseItem(o)),this.scrollItemIntoView(o)),e&&(t.preventDefault(),t.stopPropagation())}},m.ui.SelectWidget.prototype.bindDocumentKeyDownListener=function(){this.getElementDocument().addEventListener("keydown",this.onDocumentKeyDownHandler,!0)},m.ui.SelectWidget.prototype.unbindDocumentKeyDownListener=function(){this.getElementDocument().removeEventListener("keydown",this.onDocumentKeyDownHandler,!0)},m.ui.SelectWidget.prototype.scrollItemIntoView=function(t){this.blockMouseOverEvents++,t.scrollElementIntoView().done(()=>{setTimeout(()=>{this.blockMouseOverEvents--},200)})},m.ui.SelectWidget.prototype.clearKeyPressBuffer=function(){this.keyPressBufferTimer&&(clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=null),this.keyPressBuffer=""},m.ui.SelectWidget.prototype.onDocumentKeyPress=function(t){if(!t.charCode)return t.keyCode===m.ui.Keys.BACKSPACE&&""!==this.keyPressBuffer?(this.keyPressBuffer=this.keyPressBuffer.slice(0,this.keyPressBuffer.length-1),!1):void 0;var e=String.fromCodePoint(t.charCode);this.keyPressBufferTimer&&clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=setTimeout(this.clearKeyPressBuffer.bind(this),1500);let i=this.isVisible()&&this.findHighlightedItem()||!this.multiselect&&this.findSelectedItem();this.keyPressBuffer===e?i=i&&this.findRelativeSelectableItem(i,1):this.keyPressBuffer+=e;e=this.getItemMatcher(this.keyPressBuffer,!1);(i=i&&e(i)?i:this.findRelativeSelectableItem(i,1,e))&&(this.isVisible()&&i.constructor.static.highlightable?this.highlightItem(i):(this.screenReaderMode&&this.highlightItem(i),this.chooseItem(i)),this.scrollItemIntoView(i)),t.preventDefault(),t.stopPropagation()},m.ui.SelectWidget.prototype.getItemMatcher=function(t,i){const o=this.constructor.static.normalizeForMatching,n=o(t);return n?function(t){var e=o(t.getMatchText());switch(i){case"exact":return e===n;case"substring":return-1!==e.indexOf(n);default:return 0===e.indexOf(n)}}:function(){return"exact"!==i}},m.ui.SelectWidget.prototype.bindDocumentKeyPressListener=function(){this.getElementDocument().addEventListener("keypress",this.onDocumentKeyPressHandler,!0)},m.ui.SelectWidget.prototype.unbindDocumentKeyPressListener=function(){this.getElementDocument().removeEventListener("keypress",this.onDocumentKeyPressHandler,!0),this.clearKeyPressBuffer()},m.ui.SelectWidget.prototype.onToggle=function(t){t||this.clearKeyPressBuffer()},m.ui.SelectWidget.prototype.findTargetItem=function(t){t=$(t.target).closest(".oo-ui-optionWidget");return t.closest(".oo-ui-selectWidget").is(this.$element)&&t.data("oo-ui-optionWidget")||null},m.ui.SelectWidget.prototype.findFirstSelectedItem=function(){for(let t=0;t<this.items.length;t++)if(this.items[t].isSelected())return this.items[t];return null},m.ui.SelectWidget.prototype.findSelectedItems=function(){return this.multiselect?this.items.filter(t=>t.isSelected()):this.findFirstSelectedItem()},m.ui.SelectWidget.prototype.findSelectedItem=function(){return this.findSelectedItems()},m.ui.SelectWidget.prototype.findHighlightedItem=function(){for(let t=0;t<this.items.length;t++)if(this.items[t].isHighlighted())return this.items[t];return null},m.ui.SelectWidget.prototype.togglePressed=function(t){(t=void 0===t?!this.pressed:t)!==this.pressed&&(this.$element.toggleClass("oo-ui-selectWidget-pressed",t).toggleClass("oo-ui-selectWidget-unpressed",!t),this.pressed=t)},m.ui.SelectWidget.prototype.highlightItem=function(i){if(!i||!i.isHighlighted()){let e=!1;for(let t=0;t<this.items.length;t++){var o=this.items[t]===i;if(this.items[t].isHighlighted()!==o){if(this.items[t].setHighlighted(o),e)break;e=!o||this.items[t].isHighlighted()}}e&&(i?this.$focusOwner.attr("aria-activedescendant",i.getElementId()):this.$focusOwner.removeAttr("aria-activedescendant"),this.emit("highlight",i))}return this},m.ui.SelectWidget.prototype.getItemFromLabel=function(e,t){var i=this.items.length;let o=this.getItemMatcher(e,"exact"),n,s;for(n=0;n<i;n++)if((s=this.items[n])instanceof m.ui.OptionWidget&&s.isSelectable()&&o(s))return s;if(t){let t=null;for(o=this.getItemMatcher(e,"prefix"),n=0;n<i;n++)if((s=this.items[n])instanceof m.ui.OptionWidget&&s.isSelectable()&&o(s)){if(t)return null;t=s}if(t)return t}return null},m.ui.SelectWidget.prototype.selectItemByLabel=function(t,e){e=this.getItemFromLabel(t,!!e);return void 0!==t&&e?this.selectItem(e):this.selectItem()},m.ui.SelectWidget.prototype.selectItemByData=function(t){var e=this.findItemFromData(t);return void 0!==t&&e?this.selectItem(e):this.selectItem()},m.ui.SelectWidget.prototype.unselectItem=function(t){return t?t.isSelected()&&(t.setSelected(!1),this.emit("select",this.findSelectedItems())):this.selectItem(),this},m.ui.SelectWidget.prototype.selectItem=function(e){if(e){if(e.isSelected())return this;if(this.multiselect)return e.setSelected(!0),this.emit("select",this.findSelectedItems()),this}let i=!1;for(let t=0;t<this.items.length;t++){var o=this.items[t]===e;if(this.items[t].isSelected()!==o){if(this.items[t].setSelected(o),i&&!this.multiselect)break;i=!o||this.items[t].isSelected()}}return i&&(this.multiselect||!e||e.constructor.static.highlightable||this.$focusOwner.attr("aria-activedescendant",e.getElementId()),this.emit("select",this.findSelectedItems())),this},m.ui.SelectWidget.prototype.pressItem=function(i){if(!i||!i.isPressed()){let e=!1;for(let t=0;t<this.items.length;t++){var o=this.items[t]===i;if(this.items[t].isPressed()!==o){if(this.items[t].setPressed(o),e)break;e=!o||this.items[t].isPressed()}}e&&this.emit("press",i)}return this},m.ui.SelectWidget.prototype.chooseItem=function(t){return t&&(this.multiselect&&t.isSelected()?this.unselectItem(t):this.selectItem(t),this.emit("choose",t,t.isSelected())),this},m.ui.SelectWidget.prototype.findRelativeSelectableItem=function(e,i,o,n){var s=0<i?1:-1,l=this.items.length;void 0===n&&(n=!0);let u;e instanceof m.ui.OptionWidget?u=this.items.indexOf(e):(u=0<i?0:l-1,i-=s);var a=e;let r=null;for(let t=0;t<l&&((e=this.items[u])instanceof m.ui.OptionWidget&&e.isSelectable()&&(!o||o(e))&&(r=e),0!==i||!r||r===a);t++){if((u+=s)<0||u>=l){if(!n)break;u=(u+l)%l}0!==i&&(i-=s)}return r},m.ui.SelectWidget.prototype.findFirstSelectableItem=function(){return this.findRelativeSelectableItem(null,1)},m.ui.SelectWidget.prototype.addItems=function(t,e){return t&&0!==t.length&&(m.ui.mixin.GroupWidget.prototype.addItems.call(this,t,e),this.emit("add",t,void 0===e?this.items.length-t.length-1:e)),this},m.ui.SelectWidget.prototype.removeItems=function(e){for(let t=0;t<e.length;t++)e[t].isSelected()&&this.selectItem(null);return m.ui.mixin.GroupWidget.prototype.removeItems.call(this,e),this.emit("remove",e),this},m.ui.SelectWidget.prototype.clearItems=function(){var t=this.items.slice();return m.ui.mixin.GroupWidget.prototype.clearItems.call(this),this.selectItem(null),this.emit("remove",t),this},m.ui.SelectWidget.prototype.setFocusOwner=function(t){this.$focusOwner=t},m.ui.DecoratedOptionWidget=function(t){m.ui.DecoratedOptionWidget.super.call(this,t),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.IndicatorElement.call(this,t),this.$element.addClass("oo-ui-decoratedOptionWidget").prepend(this.$icon).append(this.$indicator)},m.inheritClass(m.ui.DecoratedOptionWidget,m.ui.OptionWidget),m.mixinClass(m.ui.DecoratedOptionWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.DecoratedOptionWidget,m.ui.mixin.IndicatorElement),m.ui.MenuOptionWidget=function(t){m.ui.MenuOptionWidget.super.call(this,t),this.checkIcon=new m.ui.IconWidget({icon:"check",classes:["oo-ui-menuOptionWidget-checkIcon"]}),this.$element.prepend(this.checkIcon.$element).addClass("oo-ui-menuOptionWidget")},m.inheritClass(m.ui.MenuOptionWidget,m.ui.DecoratedOptionWidget),m.ui.MenuOptionWidget.static.scrollIntoViewOnSelect=!0,m.ui.MenuSectionOptionWidget=function(t){m.ui.MenuSectionOptionWidget.super.call(this,t),this.$element.addClass("oo-ui-menuSectionOptionWidget").removeAttr("role aria-selected"),this.selected=!1},m.inheritClass(m.ui.MenuSectionOptionWidget,m.ui.DecoratedOptionWidget),m.ui.MenuSectionOptionWidget.static.selectable=!1,m.ui.MenuSectionOptionWidget.static.highlightable=!1,m.ui.MenuSelectWidget=function(t){m.ui.MenuSelectWidget.super.call(this,t=t||{}),m.ui.mixin.ClippableElement.call(this,Object.assign({$clippable:this.$group},t)),m.ui.mixin.FloatableElement.call(this,t),this.originalVerticalPosition=this.verticalPosition,this.autoHide=void 0===t.autoHide||!!t.autoHide,this.hideOnChoose=void 0===t.hideOnChoose||!!t.hideOnChoose,this.filterFromInput=!!t.filterFromInput,this.previouslySelectedValue=null,this.$input=t.$input||(t.input?t.input.$input:null),this.$widget=t.widget?t.widget.$element:null,this.$autoCloseIgnore=t.$autoCloseIgnore||$([]),this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.onInputEditHandler=m.ui.debounce(this.updateItemVisibility.bind(this),100),this.highlightOnFilter=!!t.highlightOnFilter,this.lastHighlightedItem=null,this.width=t.width,this.filterMode=t.filterMode,this.screenReaderMode=!1,this.$element.addClass("oo-ui-menuSelectWidget"),t.widget&&this.setFocusOwner(t.widget.$tabIndexed),this.visible=!1,this.$element.addClass("oo-ui-element-hidden"),this.$focusOwner.attr("aria-expanded","false")},m.inheritClass(m.ui.MenuSelectWidget,m.ui.SelectWidget),m.mixinClass(m.ui.MenuSelectWidget,m.ui.mixin.ClippableElement),m.mixinClass(m.ui.MenuSelectWidget,m.ui.mixin.FloatableElement),m.ui.MenuSelectWidget.static.handleNavigationKeys=!0,m.ui.MenuSelectWidget.static.listWrapsAround=!1,m.ui.MenuSelectWidget.static.flippedPositions={below:"above",above:"below",top:"bottom",bottom:"top"},m.ui.MenuSelectWidget.prototype.onDocumentMouseDown=function(t){this.isVisible()&&!m.ui.contains(this.$element.add(this.$widget).add(this.$autoCloseIgnore).get(),t.target,!0)&&this.toggle(!1)},m.ui.MenuSelectWidget.prototype.onDocumentKeyDown=function(t){let e=!1;var i=this.findHighlightedItem()||this.findFirstSelectedItem();if(!this.isDisabled()&&this.getVisibleItems().length){switch(t.keyCode){case m.ui.Keys.ENTER:this.isVisible()&&m.ui.MenuSelectWidget.super.prototype.onDocumentKeyDown.call(this,t);break;case m.ui.Keys.TAB:this.isVisible()&&(i&&!i.isSelected()&&(this.chooseItem(i),e=!0),this.toggle(!1));break;case m.ui.Keys.LEFT:case m.ui.Keys.RIGHT:case m.ui.Keys.HOME:case m.ui.Keys.END:this.$input||m.ui.MenuSelectWidget.super.prototype.onDocumentKeyDown.call(this,t);break;case m.ui.Keys.ESCAPE:this.isVisible()&&(i&&!this.multiselect&&i.setHighlighted(!1),this.toggle(!1),e=!0);break;default:return m.ui.MenuSelectWidget.super.prototype.onDocumentKeyDown.call(this,t)}e&&(t.preventDefault(),t.stopPropagation())}},m.ui.MenuSelectWidget.prototype.getVisibleItems=function(){return this.getItems().filter(t=>t.isVisible())},m.ui.MenuSelectWidget.prototype.updateItemVisibility=function(){if(this.filterFromInput&&this.$input){let e=!1;var s,l=!this.isVisible()||this.previouslySelectedValue===this.$input.val(),u=l?null:this.getItemMatcher(this.$input.val(),this.filterMode);let i,o,n;for(let t=0;t<this.items.length;t++)(i=this.items[t])instanceof m.ui.MenuSectionOptionWidget?(o&&o.toggle(l||!n),o=i,n=!0):i instanceof m.ui.OptionWidget&&(s=!u||u(i),e=e||s,n=n&&!s,i.toggle(s));o&&o.toggle(l||!n),e||this.highlightItem(null),this.$element.toggleClass("oo-ui-menuSelectWidget-invisible",!e),!this.highlightOnFilter||this.lastHighlightedItem&&this.lastHighlightedItem.isSelectable()||!this.isVisible()||(i=this.findFirstSelectableItem(),this.highlightItem(i),this.lastHighlightedItem=i)}this.clip()},m.ui.MenuSelectWidget.prototype.bindDocumentKeyDownListener=function(){this.$input?this.$input.on("keydown",this.onDocumentKeyDownHandler):m.ui.MenuSelectWidget.super.prototype.bindDocumentKeyDownListener.call(this)},m.ui.MenuSelectWidget.prototype.unbindDocumentKeyDownListener=function(){this.$input?this.$input.off("keydown",this.onDocumentKeyDownHandler):m.ui.MenuSelectWidget.super.prototype.unbindDocumentKeyDownListener.call(this)},m.ui.MenuSelectWidget.prototype.bindDocumentKeyPressListener=function(){this.$input?this.filterFromInput&&(this.$input.on("keydown mouseup cut paste change input select",this.onInputEditHandler),this.$input.one("keypress",()=>{this.previouslySelectedValue=null}),this.previouslySelectedValue=this.$input.val(),this.updateItemVisibility()):m.ui.MenuSelectWidget.super.prototype.bindDocumentKeyPressListener.call(this)},m.ui.MenuSelectWidget.prototype.unbindDocumentKeyPressListener=function(){this.$input?this.filterFromInput&&(this.$input.off("keydown mouseup cut paste change input select",this.onInputEditHandler),this.updateItemVisibility()):m.ui.MenuSelectWidget.super.prototype.unbindDocumentKeyPressListener.call(this)},m.ui.MenuSelectWidget.prototype.chooseItem=function(t){return m.ui.MenuSelectWidget.super.prototype.chooseItem.call(this,t),this.hideOnChoose&&this.toggle(!1),this},m.ui.MenuSelectWidget.prototype.addItems=function(t,e){return t&&0!==t.length&&(m.ui.MenuSelectWidget.super.prototype.addItems.call(this,t,e),this.updateItemVisibility()),this},m.ui.MenuSelectWidget.prototype.removeItems=function(t){return m.ui.MenuSelectWidget.super.prototype.removeItems.call(this,t),this.updateItemVisibility(),this},m.ui.MenuSelectWidget.prototype.clearItems=function(){return m.ui.MenuSelectWidget.super.prototype.clearItems.call(this),this.updateItemVisibility(),this},m.ui.MenuSelectWidget.prototype.toggleScreenReaderMode=function(t){this.screenReaderMode=t=!!t,this.$element.toggleClass("oo-ui-menuSelectWidget-screenReaderMode",this.screenReaderMode),t?(this.bindDocumentKeyDownListener(),this.bindDocumentKeyPressListener()):(this.$focusOwner.removeAttr("aria-activedescendant"),this.unbindDocumentKeyDownListener(),this.unbindDocumentKeyPressListener())},m.ui.MenuSelectWidget.prototype.toggle=function(t){var e=(t=(void 0===t?!this.visible:!!t)&&!!this.items.length)!==this.isVisible();return!t||this.warnedUnattached||this.isElementAttached()||(m.ui.warnDeprecation("MenuSelectWidget#toggle: Before calling this method, the menu must be attached to the DOM."),this.warnedUnattached=!0),e&&t&&this.setVerticalPosition(this.originalVerticalPosition),m.ui.MenuSelectWidget.super.prototype.toggle.call(this,t),e&&(t?(this.width?this.setIdealSize(this.width):this.$floatableContainer&&(this.$clippable.css("width","auto"),this.setIdealSize(this.$floatableContainer[0].offsetWidth>this.$clippable[0].offsetWidth?this.$floatableContainer[0].offsetWidth:"auto"),this.$clippable.css("width","")),this.togglePositioning(!!this.$floatableContainer),this.toggleClipping(!0),this.screenReaderMode||(this.bindDocumentKeyDownListener(),this.bindDocumentKeyPressListener()),(this.isClippedVertically()||this.isFloatableOutOfView())&&"center"!==this.originalVerticalPosition&&(e=this.$element.height(),this.setVerticalPosition(this.constructor.static.flippedPositions[this.originalVerticalPosition]),this.isClippedVertically()||this.isFloatableOutOfView())&&this.$element.height()<=e&&this.setVerticalPosition(this.originalVerticalPosition),this.$focusOwner.attr("aria-expanded","true"),this.$focusOwner.attr("aria-owns",this.getElementId()),(t=!this.multiselect&&this.findSelectedItem())&&(this.$focusOwner.attr("aria-activedescendant",t.getElementId()),t.scrollElementIntoView({duration:0})),this.autoHide&&this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.emit("ready")):(this.$focusOwner.removeAttr("aria-activedescendant"),this.screenReaderMode||(this.unbindDocumentKeyDownListener(),this.unbindDocumentKeyPressListener()),this.$focusOwner.attr("aria-expanded","false"),this.$focusOwner.removeAttr("aria-owns"),this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.togglePositioning(!1),this.toggleClipping(!1),this.lastHighlightedItem=null)),this},m.ui.MenuSelectWidget.prototype.scrollToTop=function(){this.$element.scrollTop(0)},m.ui.DropdownWidget=function(t){t=Object.assign({indicator:"down"},t),m.ui.DropdownWidget.super.call(this,t),this.$handle=$("<span>"),this.$overlay=(!0===t.$overlay?m.ui.getDefaultOverlay():t.$overlay)||this.$element,m.ui.mixin.IconElement.call(this,t),m.ui.mixin.IndicatorElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$label},t)),m.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$handle},t)),this.menu=new m.ui.MenuSelectWidget(Object.assign({widget:this,$floatableContainer:this.$element},t.menu)),this.$handle.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this),focus:this.onFocus.bind(this),blur:this.onBlur.bind(this)}),this.menu.connect(this,{select:"onMenuSelect",toggle:"onMenuToggle"});t=m.ui.generateElementId();this.setLabelId(t),this.$label.attr({role:"textbox","aria-readonly":"true"}),this.$handle.addClass("oo-ui-dropdownWidget-handle").append(this.$icon,this.$label,this.$indicator).attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-haspopup":"true","aria-labelledby":t}),this.$element.addClass("oo-ui-dropdownWidget").append(this.$handle),this.$overlay.append(this.menu.$element)},m.inheritClass(m.ui.DropdownWidget,m.ui.Widget),m.mixinClass(m.ui.DropdownWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.DropdownWidget,m.ui.mixin.IndicatorElement),m.mixinClass(m.ui.DropdownWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.DropdownWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.DropdownWidget,m.ui.mixin.TabIndexedElement),m.ui.DropdownWidget.prototype.getMenu=function(){return this.menu},m.ui.DropdownWidget.prototype.onMenuSelect=function(t){let e;t?((e=t.getLabel())instanceof $&&(e=e.clone()),this.setLabel(e)):this.setLabel(null)},m.ui.DropdownWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-dropdownWidget-open",t)},m.ui.DropdownWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==m.ui.MouseButtons.LEFT||this.menu.toggle(),!1},m.ui.DropdownWidget.prototype.onKeyDown=function(t){if(!this.isDisabled())switch(t.keyCode){case m.ui.Keys.ENTER:return this.menu.toggle(),!1;case m.ui.Keys.SPACE:if(""===this.menu.keyPressBuffer)return this.menu.toggle(),!1}},m.ui.DropdownWidget.prototype.onFocus=function(){this.menu.toggleScreenReaderMode(!0)},m.ui.DropdownWidget.prototype.onBlur=function(){this.menu.toggleScreenReaderMode(!1)},m.ui.DropdownWidget.prototype.setLabelledBy=function(t){var e=this.$label.attr("id");t?this.$handle.attr("aria-labelledby",t+" "+e):this.$handle.attr("aria-labelledby",e)},m.ui.RadioOptionWidget=function(t){this.radio=new m.ui.RadioInputWidget({value:(t=t||{}).data,tabIndex:-1}),m.ui.RadioOptionWidget.super.call(this,t),this.radio.$input.attr("role","presentation"),this.$element.addClass("oo-ui-radioOptionWidget").attr({role:"radio","aria-checked":"false"}).removeAttr("aria-selected").prepend(this.radio.$element)},m.inheritClass(m.ui.RadioOptionWidget,m.ui.OptionWidget),m.ui.RadioOptionWidget.static.highlightable=!1,m.ui.RadioOptionWidget.static.pressable=!1,m.ui.RadioOptionWidget.static.tagName="label",m.ui.RadioOptionWidget.prototype.setSelected=function(t){return m.ui.RadioOptionWidget.super.prototype.setSelected.call(this,t),this.radio.setSelected(t),this.$element.attr("aria-checked",this.selected.toString()).removeAttr("aria-selected"),this},m.ui.RadioOptionWidget.prototype.setDisabled=function(t){return m.ui.RadioOptionWidget.super.prototype.setDisabled.call(this,t),this.radio.setDisabled(this.isDisabled()),this},m.ui.RadioSelectWidget=function(t){m.ui.RadioSelectWidget.super.call(this,t),m.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-radioSelectWidget").attr("role","radiogroup").removeAttr("aria-multiselectable")},m.inheritClass(m.ui.RadioSelectWidget,m.ui.SelectWidget),m.mixinClass(m.ui.RadioSelectWidget,m.ui.mixin.TabIndexedElement),m.ui.MultioptionWidget=function(t){m.ui.MultioptionWidget.super.call(this,t=t||{}),m.ui.mixin.ItemWidget.call(this),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.TitledElement.call(this,t),this.selected=null,this.$element.addClass("oo-ui-multioptionWidget").append(this.$label),this.setSelected(t.selected)},m.inheritClass(m.ui.MultioptionWidget,m.ui.Widget),m.mixinClass(m.ui.MultioptionWidget,m.ui.mixin.ItemWidget),m.mixinClass(m.ui.MultioptionWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.MultioptionWidget,m.ui.mixin.TitledElement),m.ui.MultioptionWidget.prototype.isSelected=function(){return this.selected},m.ui.MultioptionWidget.prototype.setSelected=function(t){return this.selected!==(t=!!t)&&(this.selected=t,this.emit("change",t),this.$element.toggleClass("oo-ui-multioptionWidget-selected",t)),this},m.ui.MultiselectWidget=function(t){m.ui.MultiselectWidget.super.call(this,t),m.ui.mixin.GroupWidget.call(this,t=t||{}),m.ui.mixin.TitledElement.call(this,t),this.aggregate({change:"select"}),this.connect(this,{select:["emit","change"]}),this.addItems(t.items||[]),this.$group.addClass("oo-ui-multiselectWidget-group"),this.$element.addClass("oo-ui-multiselectWidget").append(this.$group)},m.inheritClass(m.ui.MultiselectWidget,m.ui.Widget),m.mixinClass(m.ui.MultiselectWidget,m.ui.mixin.GroupWidget),m.mixinClass(m.ui.MultiselectWidget,m.ui.mixin.TitledElement),m.ui.MultiselectWidget.prototype.findSelectedItems=function(){return this.items.filter(t=>t.isSelected())},m.ui.MultiselectWidget.prototype.findSelectedItemsData=function(){return this.findSelectedItems().map(t=>t.data)},m.ui.MultiselectWidget.prototype.selectItems=function(t){const i=new Set(t);return this.items.forEach(t=>{var e=i.has(t);t.setSelected(e)}),this},m.ui.MultiselectWidget.prototype.selectItemsByData=function(t){const i=new Set(t.map(t=>m.getHash(t)));return this.items.forEach(t=>{var e=i.has(m.getHash(t.getData()));t.setSelected(e)}),this},m.ui.CheckboxMultioptionWidget=function(t){t=t||{},this.checkbox=new m.ui.CheckboxInputWidget,m.ui.CheckboxMultioptionWidget.super.call(this,t),this.checkbox.on("change",this.onCheckboxChange.bind(this)),this.$element.on("keydown",this.onKeyDown.bind(this)),this.$element.addClass("oo-ui-checkboxMultioptionWidget").prepend(this.checkbox.$element)},m.inheritClass(m.ui.CheckboxMultioptionWidget,m.ui.MultioptionWidget),m.ui.CheckboxMultioptionWidget.static.tagName="label",m.ui.CheckboxMultioptionWidget.prototype.onCheckboxChange=function(){this.setSelected(this.checkbox.isSelected())},m.ui.CheckboxMultioptionWidget.prototype.setSelected=function(t){return m.ui.CheckboxMultioptionWidget.super.prototype.setSelected.call(this,t),this.checkbox.setSelected(t),this},m.ui.CheckboxMultioptionWidget.prototype.setDisabled=function(t){return m.ui.CheckboxMultioptionWidget.super.prototype.setDisabled.call(this,t),this.checkbox.setDisabled(this.isDisabled()),this},m.ui.CheckboxMultioptionWidget.prototype.focus=function(){this.checkbox.focus()},m.ui.CheckboxMultioptionWidget.prototype.onKeyDown=function(t){var e=this.getElementGroup();let i;t.keyCode===m.ui.Keys.LEFT||t.keyCode===m.ui.Keys.UP?i=e.getRelativeFocusableItem(this,-1):t.keyCode!==m.ui.Keys.RIGHT&&t.keyCode!==m.ui.Keys.DOWN||(i=e.getRelativeFocusableItem(this,1)),i&&(t.preventDefault(),i.focus())},m.ui.CheckboxMultiselectWidget=function(t){m.ui.CheckboxMultiselectWidget.super.call(this,t),this.$lastClicked=null,this.$group.on("click",this.onClick.bind(this)),this.$element.addClass("oo-ui-checkboxMultiselectWidget")},m.inheritClass(m.ui.CheckboxMultiselectWidget,m.ui.MultiselectWidget),m.ui.CheckboxMultiselectWidget.prototype.getRelativeFocusableItem=function(e,t){var i=0<t?1:-1,o=this.items.length;let n;n=e?(this.items.indexOf(e)+i+o)%o:0<t?0:o-1;for(let t=0;t<o;t++){if((e=this.items[n])&&!e.isDisabled())return e;n=(n+i+o)%o}return null},m.ui.CheckboxMultiselectWidget.prototype.onClick=function(t){var e=this.$lastClicked,i=$(t.target).closest(".oo-ui-checkboxMultioptionWidget").not(".oo-ui-widget-disabled");if(e&&i.length&&t.shiftKey){var o=this.$group.find(".oo-ui-checkboxMultioptionWidget"),e=o.index(e);const s=o.index(i);if(s!==e){const l=this.items,u=l[s].isSelected();var n=s>e?1:-1;for(let t=e;t!==s;t+=n)l[t].isDisabled()||l[t].setSelected(!u);t.preventDefault(),setTimeout(()=>{l[s].isDisabled()||l[s].setSelected(!u)})}}i.length&&(this.$lastClicked=i)},m.ui.CheckboxMultiselectWidget.prototype.focus=function(){var t;return this.isDisabled()||(t=this.getRelativeFocusableItem(null,1))&&t.focus(),this},m.ui.CheckboxMultiselectWidget.prototype.simulateLabelClick=function(){this.focus()},m.ui.ProgressBarWidget=function(t){m.ui.ProgressBarWidget.super.call(this,t=t||{}),m.ui.mixin.PendingElement.call(this,t),this.$bar=$("<div>"),this.progress=null,this.setProgress(void 0!==t.progress&&t.progress),this.$bar.addClass("oo-ui-progressBarWidget-bar"),this.$element.attr({role:"progressbar","aria-valuemin":0,"aria-valuemax":100}).addClass("oo-ui-progressBarWidget").append(this.$bar),t.inline&&this.$element.addClass("oo-ui-progressBarWidget-inline")},m.inheritClass(m.ui.ProgressBarWidget,m.ui.Widget),m.mixinClass(m.ui.ProgressBarWidget,m.ui.mixin.PendingElement),m.ui.ProgressBarWidget.static.tagName="div",m.ui.ProgressBarWidget.prototype.getProgress=function(){return this.progress},m.ui.ProgressBarWidget.prototype.setProgress=function(t){!1!==(this.progress=t)?(this.$bar.css("width",this.progress+"%"),this.$element.attr("aria-valuenow",this.progress)):(this.$bar.css("width",""),this.$element.removeAttr("aria-valuenow")),this.$element.toggleClass("oo-ui-progressBarWidget-indeterminate",!1===t)},m.ui.InputWidget=function(t){m.ui.InputWidget.super.call(this,t=t||{}),this.$input=t.$input||this.getInputElement(t),this.value="",this.inputFilter=t.inputFilter,m.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$input},t)),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$input},t)),m.ui.mixin.AccessKeyedElement.call(this,Object.assign({$accessKeyed:this.$input},t)),this.$input.on("keydown mouseup cut paste change input select",this.onEdit.bind(this)),this.$input.addClass("oo-ui-inputWidget-input").attr("name",t.name).prop("disabled",this.isDisabled()),this.$element.addClass("oo-ui-inputWidget").append(this.$input),this.setValue(t.value),t.dir&&this.setDir(t.dir),void 0!==t.inputId&&this.setInputId(t.inputId)},m.inheritClass(m.ui.InputWidget,m.ui.Widget),m.mixinClass(m.ui.InputWidget,m.ui.mixin.TabIndexedElement),m.mixinClass(m.ui.InputWidget,m.ui.mixin.TitledElement),m.mixinClass(m.ui.InputWidget,m.ui.mixin.AccessKeyedElement),m.ui.InputWidget.static.reusePreInfuseDOM=function(t,e){var i=$(t).find(".oo-ui-inputWidget-input");return e=m.ui.InputWidget.super.static.reusePreInfuseDOM(t,e),i.length&&(e.$input=i),e},m.ui.InputWidget.static.gatherPreInfuseState=function(t,e){t=m.ui.InputWidget.super.static.gatherPreInfuseState(t,e);return e.$input&&(t.value=e.$input.val(),t.focus=e.$input.is(":focus")),t},m.ui.InputWidget.prototype.getInputElement=function(){return $("<input>")},m.ui.InputWidget.prototype.onEdit=function(){this.isDisabled()||(this.setValue(this.$input.val()),setTimeout(()=>{this.setValue(this.$input.val())}))},m.ui.InputWidget.prototype.getValue=function(){var t=this.$input.val();return this.value!==t&&this.setValue(t),this.value},m.ui.InputWidget.prototype.setDir=function(t){return this.$input.prop("dir",t),this},m.ui.InputWidget.prototype.setValue=function(t){return t=this.cleanUpValue(t),this.$input.val()!==t&&this.$input.val(t),this.value!==t&&(this.value=t,this.emit("change",this.value)),void 0===this.defaultValue&&(this.defaultValue=this.value,this.$input[0].defaultValue=this.defaultValue),this},m.ui.InputWidget.prototype.cleanUpValue=function(t){return null==t?"":this.inputFilter?this.inputFilter(String(t)):String(t)},m.ui.InputWidget.prototype.setDisabled=function(t){return m.ui.InputWidget.super.prototype.setDisabled.call(this,t),this.$input&&this.$input.prop("disabled",this.isDisabled()),this},m.ui.InputWidget.prototype.setInputId=function(t){return this.$input.attr("id",t),this},m.ui.InputWidget.prototype.restorePreInfuseState=function(t){m.ui.InputWidget.super.prototype.restorePreInfuseState.call(this,t),void 0!==t.value&&t.value!==this.getValue()&&this.setValue(t.value),t.focus&&this.focus()},m.ui.HiddenInputWidget=function(t){t=Object.assign({value:"",name:""},t),m.ui.HiddenInputWidget.super.call(this,t),this.$element.attr({type:"hidden",value:t.value,name:t.name}),this.$element.removeAttr("aria-disabled")},m.inheritClass(m.ui.HiddenInputWidget,m.ui.Widget),m.ui.HiddenInputWidget.static.tagName="input",m.ui.ButtonInputWidget=function(t){(t=Object.assign({type:"button",useInputTag:!1,formNoValidate:!1},t)).$input&&t.$input.empty(),this.useInputTag=t.useInputTag,m.ui.ButtonInputWidget.super.call(this,t),m.ui.mixin.ButtonElement.call(this,Object.assign({$button:this.$input},t)),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.IndicatorElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.FlaggedElement.call(this,t),t.useInputTag||this.$input.append(this.$icon,this.$label,this.$indicator),t.formNoValidate&&this.$input.attr("formnovalidate","formnovalidate"),this.$element.addClass("oo-ui-buttonInputWidget")},m.inheritClass(m.ui.ButtonInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.ButtonInputWidget,m.ui.mixin.ButtonElement),m.mixinClass(m.ui.ButtonInputWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.ButtonInputWidget,m.ui.mixin.IndicatorElement),m.mixinClass(m.ui.ButtonInputWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.ButtonInputWidget,m.ui.mixin.FlaggedElement),m.ui.ButtonInputWidget.static.tagName="span",m.ui.ButtonInputWidget.prototype.getInputElement=function(t){var e="submit"===t.type||"reset"===t.type?t.type:"button";return $("<"+(t.useInputTag?"input":"button")+' type="'+e+'">')},m.ui.ButtonInputWidget.prototype.setLabel=function(t){return t=m.ui.resolveMsg(t),this.useInputTag&&this.$input.val(t="string"!=typeof t?"":t),m.ui.mixin.LabelElement.prototype.setLabel.call(this,t)},m.ui.ButtonInputWidget.prototype.setValue=function(t){return this.useInputTag||m.ui.ButtonInputWidget.super.prototype.setValue.call(this,t),this},m.ui.ButtonInputWidget.prototype.getInputId=function(){return null},m.ui.CheckboxInputWidget=function(t){m.ui.CheckboxInputWidget.super.call(this,t=t||{}),m.ui.mixin.RequiredElement.call(this,Object.assign({},{indicatorElement:null},t)),this.checkIcon=new m.ui.IconWidget({icon:"check",classes:["oo-ui-checkboxInputWidget-checkIcon"]}),this.$element.addClass("oo-ui-checkboxInputWidget").append(this.checkIcon.$element),this.setSelected(void 0!==t.selected&&t.selected),this.setIndeterminate(void 0!==t.indeterminate&&t.indeterminate)},m.inheritClass(m.ui.CheckboxInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.CheckboxInputWidget,m.ui.mixin.RequiredElement),m.ui.CheckboxInputWidget.static.tagName="span",m.ui.CheckboxInputWidget.static.gatherPreInfuseState=function(t,e){t=m.ui.CheckboxInputWidget.super.static.gatherPreInfuseState(t,e);return e.$input&&(t.checked=e.$input.prop("checked")),t},m.ui.CheckboxInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","checkbox")},m.ui.CheckboxInputWidget.prototype.onEdit=function(){this.isDisabled()||setTimeout(()=>{this.setSelected(this.$input.prop("checked")),this.setIndeterminate(this.$input.prop("indeterminate"))})},m.ui.CheckboxInputWidget.prototype.setSelected=function(t,e){return this.selected!==(t=!!t)&&(this.selected=t,this.$input.prop("checked",this.selected),e||(this.setIndeterminate(!1,!0),this.emit("change",this.selected,this.indeterminate))),void 0===this.defaultSelected&&(this.defaultSelected=this.selected,this.$input[0].defaultChecked=this.defaultSelected),this},m.ui.CheckboxInputWidget.prototype.isSelected=function(){var t=this.$input.prop("checked");return this.selected!==t&&this.setSelected(t),this.selected},m.ui.CheckboxInputWidget.prototype.setIndeterminate=function(t,e){return this.indeterminate!==(t=!!t)&&(this.indeterminate=t,this.$input.prop("indeterminate",this.indeterminate),e||(this.setSelected(!1,!0),this.emit("change",this.selected,this.indeterminate))),this},m.ui.CheckboxInputWidget.prototype.isIndeterminate=function(){var t=this.$input.prop("indeterminate");return this.indeterminate!==t&&this.setIndeterminate(t),this.indeterminate},m.ui.CheckboxInputWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.$handle.trigger("click"),this.focus()},m.ui.CheckboxInputWidget.prototype.restorePreInfuseState=function(t){m.ui.CheckboxInputWidget.super.prototype.restorePreInfuseState.call(this,t),void 0!==t.checked&&t.checked!==this.isSelected()&&this.setSelected(t.checked)},m.ui.DropdownInputWidget=function(t){t=t||{},this.dropdownWidget=new m.ui.DropdownWidget(Object.assign({$overlay:t.$overlay},t.dropdown)),this.setOptionsData(t.options||[]),m.ui.DropdownInputWidget.super.call(this,t),m.ui.mixin.RequiredElement.call(this,Object.assign({},{indicatorElement:null},t)),this.dropdownWidget.getMenu().connect(this,{select:"onMenuSelect"}),this.$element.addClass("oo-ui-dropdownInputWidget").append(this.dropdownWidget.$element),m.ui.isMobile()&&this.$element.addClass("oo-ui-isMobile"),this.setTabIndexedElement(this.dropdownWidget.$tabIndexed),this.setTitledElement(this.dropdownWidget.$handle)},m.inheritClass(m.ui.DropdownInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.DropdownInputWidget,m.ui.mixin.RequiredElement),m.ui.DropdownInputWidget.prototype.getInputElement=function(){return $("<select>").addClass("oo-ui-indicator-down")},m.ui.DropdownInputWidget.prototype.onMenuSelect=function(t){this.setValue(t?t.getData():"")},m.ui.DropdownInputWidget.prototype.setValue=function(t){t=this.cleanUpValue(t);var e=this.dropdownWidget.getMenu().findItemFromData(t)||this.dropdownWidget.getMenu().findFirstSelectableItem();return this.dropdownWidget.getMenu().selectItem(e),t=e?e.getData():"",m.ui.DropdownInputWidget.super.prototype.setValue.call(this,t),this.optionsDirty&&this.updateOptionsInterface(),this},m.ui.DropdownInputWidget.prototype.setDisabled=function(t){return this.dropdownWidget.setDisabled(t),m.ui.DropdownInputWidget.super.prototype.setDisabled.call(this,t),this},m.ui.DropdownInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},m.ui.DropdownInputWidget.prototype.setOptionsData=function(i){this.optionsDirty=!0;var o=[];let n;for(let e=0;e<i.length;e++){var s,l=i[e];let t;void 0!==l.optgroup?(t=this.createMenuSectionOptionWidget(l.optgroup),n=t):(s=this.cleanUpValue(l.data),t=this.createMenuOptionWidget(s,void 0!==l.label?l.label:s)),(void 0!==l.disabled||n instanceof m.ui.MenuSectionOptionWidget&&n.isDisabled())&&t.setDisabled(!0),o.push(t)}this.dropdownWidget.getMenu().clearItems().addItems(o)},m.ui.DropdownInputWidget.prototype.createMenuOptionWidget=function(t,e){return new m.ui.MenuOptionWidget({data:t,label:e})},m.ui.DropdownInputWidget.prototype.createMenuSectionOptionWidget=function(t){return new m.ui.MenuSectionOptionWidget({label:t})},m.ui.DropdownInputWidget.prototype.updateOptionsInterface=function(){let i=this.$input;const o=this.defaultValue;this.$input.empty(),this.dropdownWidget.getMenu().getItems().forEach(t=>{let e;t instanceof m.ui.MenuSectionOptionWidget?(e=$("<optgroup>").attr("label",t.getLabel()),this.$input.append(e),i=e):((e=$("<option>").attr("value",t.getData()).text(t.getLabel()))[0].defaultSelected=t.getData()===o,i.append(e)),t.isDisabled()&&e.prop("disabled",!0)}),this.optionsDirty=!1},m.ui.DropdownInputWidget.prototype.focus=function(){return this.dropdownWidget.focus(),this},m.ui.DropdownInputWidget.prototype.blur=function(){return this.dropdownWidget.blur(),this},m.ui.DropdownInputWidget.prototype.setLabelledBy=function(t){this.dropdownWidget.setLabelledBy(t)},m.ui.RadioInputWidget=function(t){m.ui.RadioInputWidget.super.call(this,t=t||{}),m.ui.mixin.RequiredElement.call(this,Object.assign({},{indicatorElement:null},t)),this.$element.addClass("oo-ui-radioInputWidget").append($("<span>")),this.setSelected(void 0!==t.selected&&t.selected)},m.inheritClass(m.ui.RadioInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.RadioInputWidget,m.ui.mixin.RequiredElement),m.ui.RadioInputWidget.static.tagName="span",m.ui.RadioInputWidget.static.gatherPreInfuseState=function(t,e){t=m.ui.RadioInputWidget.super.static.gatherPreInfuseState(t,e);return e.$input&&(t.checked=e.$input.prop("checked")),t},m.ui.RadioInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","radio")},m.ui.RadioInputWidget.prototype.onEdit=function(){},m.ui.RadioInputWidget.prototype.setSelected=function(t){return this.$input.prop("checked",t),void 0===this.defaultSelected&&(this.defaultSelected=t,this.$input[0].defaultChecked=this.defaultSelected),this},m.ui.RadioInputWidget.prototype.isSelected=function(){return this.$input.prop("checked")},m.ui.RadioInputWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.$input.trigger("click"),this.focus()},m.ui.RadioInputWidget.prototype.restorePreInfuseState=function(t){m.ui.RadioInputWidget.super.prototype.restorePreInfuseState.call(this,t),void 0!==t.checked&&t.checked!==this.isSelected()&&this.setSelected(t.checked)},m.ui.RadioSelectInputWidget=function(t){t=t||{},this.radioSelectWidget=new m.ui.RadioSelectWidget,this.setOptionsData(t.options||[]),m.ui.RadioSelectInputWidget.super.call(this,t),this.radioSelectWidget.connect(this,{select:"onMenuSelect"}),this.$element.addClass("oo-ui-radioSelectInputWidget").append(this.radioSelectWidget.$element),this.setTabIndexedElement(this.radioSelectWidget.$tabIndexed)},m.inheritClass(m.ui.RadioSelectInputWidget,m.ui.InputWidget),m.ui.RadioSelectInputWidget.static.gatherPreInfuseState=function(t,e){e=m.ui.RadioSelectInputWidget.super.static.gatherPreInfuseState(t,e);return e.value=$(t).find(".oo-ui-radioInputWidget .oo-ui-inputWidget-input:checked").val(),e},m.ui.RadioSelectInputWidget.static.reusePreInfuseDOM=function(t,e){return delete(e=m.ui.RadioSelectInputWidget.super.static.reusePreInfuseDOM(t,e)).$input,e},m.ui.RadioSelectInputWidget.prototype.getInputElement=function(){return $("<input>").addClass("oo-ui-element-hidden")},m.ui.RadioSelectInputWidget.prototype.onMenuSelect=function(t){this.setValue(t.getData())},m.ui.RadioSelectInputWidget.prototype.setValue=function(t){t=this.cleanUpValue(t);var e=this.radioSelectWidget.findItemFromData(t)||this.radioSelectWidget.findFirstSelectableItem();return this.radioSelectWidget.selectItem(e),t=e?e.getData():"",m.ui.RadioSelectInputWidget.super.prototype.setValue.call(this,t),this},m.ui.RadioSelectInputWidget.prototype.setDisabled=function(t){return this.radioSelectWidget.setDisabled(t),m.ui.RadioSelectInputWidget.super.prototype.setDisabled.call(this,t),this},m.ui.RadioSelectInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},m.ui.RadioSelectInputWidget.prototype.setOptionsData=function(t){this.radioSelectWidget.clearItems().addItems(t.map(t=>{var e=this.cleanUpValue(t.data);return new m.ui.RadioOptionWidget({data:e,label:void 0!==t.label?t.label:e})}))},m.ui.RadioSelectInputWidget.prototype.focus=function(){return this.radioSelectWidget.focus(),this},m.ui.RadioSelectInputWidget.prototype.blur=function(){return this.radioSelectWidget.blur(),this},m.ui.CheckboxMultiselectInputWidget=function(t){t=t||{},this.checkboxMultiselectWidget=new m.ui.CheckboxMultiselectWidget,this.inputName=t.name,this.setOptionsData(t.options||[]),m.ui.CheckboxMultiselectInputWidget.super.call(this,t),this.onCheckboxesSelectHandler=m.ui.debounce(this.onCheckboxesSelect),this.checkboxMultiselectWidget.connect(this,{select:"onCheckboxesSelectHandler"}),this.$element.addClass("oo-ui-checkboxMultiselectInputWidget").append(this.checkboxMultiselectWidget.$element),this.$input.detach()},m.inheritClass(m.ui.CheckboxMultiselectInputWidget,m.ui.InputWidget),m.ui.CheckboxMultiselectInputWidget.static.gatherPreInfuseState=function(t,e){e=m.ui.CheckboxMultiselectInputWidget.super.static.gatherPreInfuseState(t,e);return e.value=$(t).find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(t=>t.value),e},m.ui.CheckboxMultiselectInputWidget.static.reusePreInfuseDOM=function(t,e){return delete(e=m.ui.CheckboxMultiselectInputWidget.super.static.reusePreInfuseDOM(t,e)).$input,e},m.ui.CheckboxMultiselectInputWidget.prototype.getInputElement=function(){return $("<unused>")},m.ui.CheckboxMultiselectInputWidget.prototype.onCheckboxesSelect=function(){this.setValue(this.checkboxMultiselectWidget.findSelectedItemsData())},m.ui.CheckboxMultiselectInputWidget.prototype.getValue=function(){var t=this.$element.find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(t=>t.value);return m.compare(this.value,t)||this.setValue(t),this.value},m.ui.CheckboxMultiselectInputWidget.prototype.setValue=function(t){return t=this.cleanUpValue(t),this.checkboxMultiselectWidget.selectItemsByData(t),m.ui.CheckboxMultiselectInputWidget.super.prototype.setValue.call(this,t),this.optionsDirty&&this.updateOptionsInterface(),this},m.ui.CheckboxMultiselectInputWidget.prototype.cleanUpValue=function(e){var i=[];if(Array.isArray(e)){var o=new Set(this.checkboxMultiselectWidget.getItems().map(t=>m.getHash(t.getData())));for(let t=0;t<e.length;t++){var n=m.ui.CheckboxMultiselectInputWidget.super.prototype.cleanUpValue.call(this,e[t]);o.has(m.getHash(n))&&i.push(n)}}return i},m.ui.CheckboxMultiselectInputWidget.prototype.setDisabled=function(t){return this.checkboxMultiselectWidget.setDisabled(t),m.ui.CheckboxMultiselectInputWidget.super.prototype.setDisabled.call(this,t),this},m.ui.CheckboxMultiselectInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},m.ui.CheckboxMultiselectInputWidget.prototype.setOptionsData=function(t){this.optionsDirty=!0,this.checkboxMultiselectWidget.clearItems().addItems(t.map(t=>{var e=m.ui.CheckboxMultiselectInputWidget.super.prototype.cleanUpValue.call(this,t.data),i=void 0!==t.disabled&&t.disabled,t=new m.ui.CheckboxMultioptionWidget({data:e,label:void 0!==t.label?t.label:e,disabled:i});return t.checkbox.$input.attr("name",this.inputName),t.checkbox.setValue(e),t}))},m.ui.CheckboxMultiselectInputWidget.prototype.updateOptionsInterface=function(){const i=new Set(this.defaultValue);this.checkboxMultiselectWidget.getItems().forEach(t=>{var e=i.has(t.getData());t.checkbox.defaultSelected=e,t.checkbox.$input[0].defaultChecked=e}),this.optionsDirty=!1},m.ui.CheckboxMultiselectInputWidget.prototype.focus=function(){return this.checkboxMultiselectWidget.focus(),this},m.ui.TextInputWidget=function(t){(t=Object.assign({labelPosition:"after"},t)).type=this.getValidType(t),!1===t.autocomplete?t.autocomplete="off":!0===t.autocomplete&&(t.autocomplete="on"),m.ui.TextInputWidget.super.call(this,t),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.IndicatorElement.call(this,t),m.ui.mixin.PendingElement.call(this,Object.assign({$pending:this.$input},t)),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.FlaggedElement.call(this,t),m.ui.mixin.RequiredElement.call(this,t),this.type=t.type,this.readOnly=!1,this.validate=null,this.scrollWidth=null,this.setValidation(t.validate),this.setLabelPosition(t.labelPosition),this.$input.on({keypress:this.onKeyPress.bind(this),blur:this.onBlur.bind(this),focus:this.onFocus.bind(this)}),this.$icon.on("mousedown",this.onIconMouseDown.bind(this)),this.$indicator.on("mousedown",this.onIndicatorMouseDown.bind(this)),this.on("labelChange",this.updatePosition.bind(this)),this.on("change",m.ui.debounce(this.onDebouncedChange.bind(this),250)),this.$element.addClass("oo-ui-textInputWidget oo-ui-textInputWidget-type-"+t.type).append(this.$icon,this.$indicator),this.setReadOnly(!!t.readOnly),void 0!==t.placeholder&&this.$input.attr("placeholder",t.placeholder),void 0!==t.maxLength&&this.$input.attr("maxlength",t.maxLength),void 0!==t.minLength&&this.$input.attr("minlength",t.minLength),t.autofocus&&this.$input.attr("autofocus","autofocus"),null!==t.autocomplete&&void 0!==t.autocomplete&&(this.$input.attr("autocomplete",t.autocomplete),"off"===t.autocomplete)&&$(window).on({beforeunload:function(){this.$input.removeAttr("autocomplete")}.bind(this),pageshow:function(){this.$input.attr("autocomplete","off")}.bind(this)}),void 0!==t.spellcheck&&this.$input.attr("spellcheck",t.spellcheck?"true":"false"),this.label&&(this.isWaitingToBeAttached=!0,this.installParentChangeDetector())},m.inheritClass(m.ui.TextInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.IconElement),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.IndicatorElement),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.PendingElement),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.LabelElement),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.FlaggedElement),m.mixinClass(m.ui.TextInputWidget,m.ui.mixin.RequiredElement),m.ui.TextInputWidget.static.validationPatterns={"non-empty":/^./,integer:/^\d+$/},m.ui.TextInputWidget.prototype.onIconMouseDown=function(t){if(t.which===m.ui.MouseButtons.LEFT)return this.focus(),!1},m.ui.TextInputWidget.prototype.onIndicatorMouseDown=function(t){if(t.which===m.ui.MouseButtons.LEFT)return this.focus(),!1},m.ui.TextInputWidget.prototype.onKeyPress=function(t){t.which===m.ui.Keys.ENTER&&this.emit("enter",t)},m.ui.TextInputWidget.prototype.onBlur=function(){this.setValidityFlag()},m.ui.TextInputWidget.prototype.onFocus=function(){this.isWaitingToBeAttached&&this.onElementAttach(),this.setValidityFlag(!0)},m.ui.TextInputWidget.prototype.onElementAttach=function(){this.isWaitingToBeAttached=!1,this.valCache=null,this.positionLabel()},m.ui.TextInputWidget.prototype.onDebouncedChange=function(){this.setValidityFlag()},m.ui.TextInputWidget.prototype.isReadOnly=function(){return this.readOnly},m.ui.TextInputWidget.prototype.setReadOnly=function(t){return this.readOnly=!!t,this.$input.prop("readOnly",this.readOnly),this},m.ui.TextInputWidget.prototype.installParentChangeDetector=function(){this.connectDetectorNode=document.createElement("ooui-connect-detector"),this.connectDetectorNode.onConnectOOUI=()=>{this.isElementAttached()&&this.onElementAttach()},this.$element.append(this.connectDetectorNode)},m.ui.TextInputWidget.prototype.getInputElement=function(t){var e=$("<input>").attr("type",t.type);return"number"===t.type&&e.attr("step","any"),e},m.ui.TextInputWidget.prototype.getValidType=function(t){return-1!==["text","password","email","url","number"].indexOf(t.type)?t.type:"text"},m.ui.TextInputWidget.prototype.selectRange=function(t,e){var i=this.$input[0],o=(e=e||t)<t,n=o?e:t,t=o?t:e;this.focus();try{i.setSelectionRange(n,t,o?"backward":"forward")}catch(t){if(this.getElementDocument().body.contains(i))throw t}return this},m.ui.TextInputWidget.prototype.getRange=function(){var t=this.$input[0],e=t.selectionStart,i=t.selectionEnd,t="backward"===t.selectionDirection;return{from:t?i:e,to:t?e:i}},m.ui.TextInputWidget.prototype.getInputLength=function(){return this.$input[0].value.length},m.ui.TextInputWidget.prototype.select=function(){return this.selectRange(0,this.getInputLength())},m.ui.TextInputWidget.prototype.moveCursorToStart=function(){return this.selectRange(0)},m.ui.TextInputWidget.prototype.moveCursorToEnd=function(){return this.selectRange(this.getInputLength())},m.ui.TextInputWidget.prototype.insertContent=function(t){var e=this.getValue(),i=this.getRange(),o=Math.min(i.from,i.to),i=Math.max(i.from,i.to);return this.setValue(e.slice(0,o)+t+e.slice(i)),this.selectRange(o+t.length),this},m.ui.TextInputWidget.prototype.encapsulateContent=function(t,e){var i=t.length,o=this.getRange(),n=Math.min(o.from,o.to),o=Math.max(o.from,o.to);return this.selectRange(n).insertContent(t),this.selectRange(i+o).insertContent(e),this.selectRange(i+n,i+o),this},m.ui.TextInputWidget.prototype.setValidation=function(t){this.validate=t instanceof RegExp||t instanceof Function?t:this.constructor.static.validationPatterns[t]},m.ui.TextInputWidget.prototype.setValidityFlag=function(t){const e=t=>{t?this.$input.removeAttr("aria-invalid"):this.$input.attr("aria-invalid","true"),this.setFlags({invalid:!t})};void 0!==t?e(t):this.getValidity().then(()=>{e(!0)},()=>{e(!1)})},m.ui.TextInputWidget.prototype.getValidity=function(){function e(t){var e=$.Deferred();return(t?e.resolve():e.reject()).promise()}if(this.$input[0].checkValidity&&!1===this.$input[0].checkValidity())return e(!1);if(!this.validate)return e(!0);let t;if(this.validate instanceof Function){if((t=this.validate(this.getValue()))&&"function"==typeof t.promise)return t.promise().then(t=>e(t))}else t=this.validate.test(this.getValue());return e(t)},m.ui.TextInputWidget.prototype.setLabelPosition=function(t){return this.labelPosition=t,this.label&&this.updatePosition(),this},m.ui.TextInputWidget.prototype.updatePosition=function(){var t="after"===this.labelPosition;return this.$element.toggleClass("oo-ui-textInputWidget-labelPosition-after",!!this.label&&t).toggleClass("oo-ui-textInputWidget-labelPosition-before",!!this.label&&!t),this.valCache=null,this.scrollWidth=null,this.positionLabel(),this},m.ui.TextInputWidget.prototype.positionLabel=function(){var t,e;return this.isWaitingToBeAttached?this:(t={"padding-right":"","padding-left":""},this.label?(this.$element.append(this.$label),t[(e="after"===this.labelPosition)==("rtl"===this.$element.css("direction"))?"padding-left":"padding-right"]=this.$label.outerWidth(!0)+(e?this.scrollWidth:0),this.$input.css(t),this):(this.$label.detach(),void this.$input.css(t)))},m.ui.SearchInputWidget=function(t){t=Object.assign({icon:"search"},t),m.ui.SearchInputWidget.super.call(this,t),this.connect(this,{change:"onChange"}),this.$indicator.on("click",this.onIndicatorClick.bind(this)),this.$indicator.on("keydown",this.onIndicatorKeyDown.bind(this)),this.updateSearchIndicator(),this.connect(this,{disable:"onDisable"}),this.$indicator.attr({tabindex:-1,role:"button"})},m.inheritClass(m.ui.SearchInputWidget,m.ui.TextInputWidget),m.ui.SearchInputWidget.prototype.getValidType=function(){return"search"},m.ui.SearchInputWidget.prototype.onIndicatorKeyDown=function(t){if(t.keyCode===m.ui.Keys.ENTER)return this.setValue(""),this.focus(),!1},m.ui.SearchInputWidget.prototype.onIndicatorClick=function(t){if(t.which===m.ui.MouseButtons.LEFT)return this.setValue(""),this.focus(),!1},m.ui.SearchInputWidget.prototype.updateSearchIndicator=function(){""===this.getValue()||this.isDisabled()||this.isReadOnly()?this.setIndicator(null):(this.setIndicator("clear"),this.$indicator.attr("aria-label",m.ui.msg("ooui-item-remove")))},m.ui.SearchInputWidget.prototype.onChange=function(){this.updateSearchIndicator()},m.ui.SearchInputWidget.prototype.onDisable=function(){this.updateSearchIndicator()},m.ui.SearchInputWidget.prototype.setReadOnly=function(t){return m.ui.SearchInputWidget.super.prototype.setReadOnly.call(this,t),this.updateSearchIndicator(),this},m.ui.MultilineTextInputWidget=function(t){t=Object.assign({type:"text"},t),this.allowLinebreaks=void 0===t.allowLinebreaks||t.allowLinebreaks,m.ui.MultilineTextInputWidget.super.call(this,t),this.autosize=!!t.autosize,this.styleHeight=null,this.minRows=void 0!==t.rows?t.rows:"",this.maxRows=t.maxRows||Math.max(2*(this.minRows||0),10),this.autosize&&(this.$clone=this.$input.clone().removeAttr("id").removeAttr("name").insertAfter(this.$input).attr("aria-hidden","true").css("overflow","hidden").addClass("oo-ui-element-hidden")),this.connect(this,{change:"onChange"}),t.rows&&this.$input.attr("rows",t.rows),this.autosize&&(this.$input.addClass("oo-ui-textInputWidget-autosized"),this.isWaitingToBeAttached=!0,this.installParentChangeDetector())},m.inheritClass(m.ui.MultilineTextInputWidget,m.ui.TextInputWidget),m.ui.MultilineTextInputWidget.static.gatherPreInfuseState=function(t,e){t=m.ui.MultilineTextInputWidget.super.static.gatherPreInfuseState(t,e);return e.$input&&(t.scrollTop=e.$input.scrollTop()),t},m.ui.MultilineTextInputWidget.prototype.onElementAttach=function(){m.ui.MultilineTextInputWidget.super.prototype.onElementAttach.call(this),this.adjustSize()},m.ui.MultilineTextInputWidget.prototype.onChange=function(){this.adjustSize()},m.ui.MultilineTextInputWidget.prototype.updatePosition=function(){m.ui.MultilineTextInputWidget.super.prototype.updatePosition.call(this),this.adjustSize()},m.ui.MultilineTextInputWidget.prototype.onKeyPress=function(t){if(!this.allowLinebreaks)return t.which===m.ui.Keys.ENTER&&t.preventDefault(),m.ui.TextInputWidget.prototype.onKeyPress.call(this,t);(t.which===m.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)||10===t.which)&&this.emit("enter",t)},m.ui.MultilineTextInputWidget.prototype.cleanUpValue=function(t){return t=m.ui.MultilineTextInputWidget.super.prototype.cleanUpValue(t),t=this.allowLinebreaks?t:t.replace(/\r?\n/g," ")},m.ui.MultilineTextInputWidget.prototype.adjustSize=function(t){var e,i,o,n;return!t&&this.$input.val()===this.valCache||(this.autosize&&(this.$clone.val(this.$input.val()).attr("rows",this.minRows).css("height",0).removeClass("oo-ui-element-hidden"),this.valCache=this.$input.val(),this.$clone[0].scrollHeight,t=this.$clone[0].scrollHeight,this.$clone.css("height",""),e=this.$clone.innerHeight(),i=this.$clone.outerHeight(),this.$clone.attr("rows",this.maxRows).css("height","auto").val(""),o=(n=this.$clone.innerHeight())-this.$clone[0].scrollHeight,n=Math.min(n,t+o),this.$clone.addClass("oo-ui-element-hidden"),(t=e<n?n+(i-e):"")!==this.styleHeight)&&(this.$input.css("height",t),this.styleHeight=t,this.emit("resize")),(o=this.$input[0].offsetWidth-this.$input[0].clientWidth)===this.scrollWidth)||(n="rtl"===this.$element.css("direction")?"left":"right",this.$label.css({right:"",left:""}),this.$indicator.css({right:"",left:""}),o&&(this.$indicator.css(n,o),"after"===this.labelPosition)&&this.$label.css(n,o),this.scrollWidth=o,this.positionLabel()),this},m.ui.MultilineTextInputWidget.prototype.getInputElement=function(){return $("<textarea>")},m.ui.MultilineTextInputWidget.prototype.isAutosizing=function(){return!!this.autosize},m.ui.MultilineTextInputWidget.prototype.restorePreInfuseState=function(t){m.ui.MultilineTextInputWidget.super.prototype.restorePreInfuseState.call(this,t),void 0!==t.scrollTop&&this.$input.scrollTop(t.scrollTop)},m.ui.ComboBoxInputWidget=function(t){(t=Object.assign({autocomplete:!1},t)).$input&&t.$input.removeAttr("list"),m.ui.ComboBoxInputWidget.super.call(this,t),this.$overlay=(!0===t.$overlay?m.ui.getDefaultOverlay():t.$overlay)||this.$element,this.dropdownButton=new m.ui.ButtonWidget({classes:["oo-ui-comboBoxInputWidget-dropdownButton"],label:m.ui.msg("ooui-combobox-button-label"),indicator:"down",invisibleLabel:!0,disabled:this.disabled}),this.menu=new m.ui.MenuSelectWidget(Object.assign({widget:this,input:this,$floatableContainer:this.$element,disabled:this.isDisabled()},t.menu)),this.connect(this,{change:"onInputChange",enter:"onInputEnter"}),this.dropdownButton.connect(this,{click:"onDropdownButtonClick"}),this.menu.connect(this,{choose:"onMenuChoose",add:"onMenuItemsChange",remove:"onMenuItemsChange",toggle:"onMenuToggle"}),this.$input.attr({role:"combobox","aria-owns":this.menu.getElementId(),"aria-autocomplete":"list"}),this.dropdownButton.$button.attr({"aria-controls":this.menu.getElementId()}),void 0!==t.options&&this.setOptions(t.options),this.$field=$("<div>").addClass("oo-ui-comboBoxInputWidget-field").append(this.$input,this.dropdownButton.$element),this.$element.addClass("oo-ui-comboBoxInputWidget").append(this.$field),this.$overlay.append(this.menu.$element),this.onMenuItemsChange()},m.inheritClass(m.ui.ComboBoxInputWidget,m.ui.TextInputWidget),m.ui.ComboBoxInputWidget.prototype.getMenu=function(){return this.menu},m.ui.ComboBoxInputWidget.prototype.getInput=function(){return this},m.ui.ComboBoxInputWidget.prototype.onEdit=function(t){m.ui.ComboBoxInputWidget.super.prototype.onEdit.apply(this,arguments),this.menu.isVisible()||this.isDisabled()||!this.isVisible()||"input"!==t.type&&"mouseup"!==t.type&&("keydown"!==t.type||t.keyCode!==m.ui.Keys.ENTER&&t.keyCode!==m.ui.Keys.UP&&t.keyCode!==m.ui.Keys.DOWN)||this.menu.toggle(!0)},m.ui.ComboBoxInputWidget.prototype.onInputChange=function(t){t=this.menu.findItemFromData(t);this.menu.selectItem(t),this.menu.findHighlightedItem()&&this.menu.highlightItem(t)},m.ui.ComboBoxInputWidget.prototype.onInputEnter=function(){this.isDisabled()||this.menu.toggle(!1)},m.ui.ComboBoxInputWidget.prototype.onDropdownButtonClick=function(){this.menu.toggle(),this.focus()},m.ui.ComboBoxInputWidget.prototype.onMenuChoose=function(t){this.setValue(t.getData())},m.ui.ComboBoxInputWidget.prototype.onMenuItemsChange=function(){var t=this.menu.findItemFromData(this.getValue());this.menu.selectItem(t),this.menu.findHighlightedItem()&&this.menu.highlightItem(t),this.$element.toggleClass("oo-ui-comboBoxInputWidget-empty",this.menu.isEmpty())},m.ui.ComboBoxInputWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-comboBoxInputWidget-open",t)},m.ui.ComboBoxInputWidget.prototype.updateControlsDisabled=function(){var t=this.isDisabled()||this.isReadOnly();return this.dropdownButton&&this.dropdownButton.setDisabled(t),this.menu&&this.menu.setDisabled(t),this},m.ui.ComboBoxInputWidget.prototype.setDisabled=function(){return m.ui.ComboBoxInputWidget.super.prototype.setDisabled.apply(this,arguments),this.updateControlsDisabled(),this},m.ui.ComboBoxInputWidget.prototype.setReadOnly=function(){return m.ui.ComboBoxInputWidget.super.prototype.setReadOnly.apply(this,arguments),this.updateControlsDisabled(),this},m.ui.ComboBoxInputWidget.prototype.setOptions=function(t){return this.getMenu().clearItems().addItems(t.map(t=>new m.ui.MenuOptionWidget({data:t.data,label:void 0!==t.label?t.label:t.data}))),this},m.ui.FieldLayout=function(t,e){if(void 0===(t=m.isPlainObject(t)&&void 0===e?(e=t).fieldWidget:t))throw new Error("Widget not found");(e=Object.assign({align:"left",helpInline:!1},e)).help&&!e.label&&(e.label=" "),m.ui.FieldLayout.super.call(this,e),m.ui.mixin.LabelElement.call(this,Object.assign({$label:$("<label>")},e)),m.ui.mixin.TitledElement.call(this,Object.assign({$titled:this.$label},e)),this.fieldWidget=t,this.errors=[],this.warnings=[],this.successMessages=[],this.notices=[],this.$field=this.isFieldInline()?$("<span>"):$("<div>"),this.$messages=$("<div>"),this.$header=$("<span>"),this.$body=$("<div>"),this.align=null,this.helpInline=e.helpInline,this.fieldWidget.connect(this,{disable:"onFieldDisable"}),this.$help=e.help?this.createHelpElement(e.help,e.$overlay):$([]),this.fieldWidget.getInputId()?(this.$label.attr("for",this.fieldWidget.getInputId()),this.helpInline&&this.$help.attr("for",this.fieldWidget.getInputId())):(t=m.ui.generateElementId(),this.$label.attr("id",t),this.fieldWidget.setLabelledBy(t),this.$label.on("click",this.onLabelClick.bind(this)),this.helpInline&&this.$help.on("click",this.onLabelClick.bind(this))),this.$element.addClass("oo-ui-fieldLayout").toggleClass("oo-ui-fieldLayout-disabled",this.fieldWidget.isDisabled()).append(this.$body),this.$body.addClass("oo-ui-fieldLayout-body"),this.$header.addClass("oo-ui-fieldLayout-header"),this.$messages.addClass("oo-ui-fieldLayout-messages"),this.$field.addClass("oo-ui-fieldLayout-field").append(this.fieldWidget.$element),this.setErrors(e.errors||[]),this.setWarnings(e.warnings||[]),this.setSuccess(e.successMessages||[]),this.setNotices(e.notices||[]),this.setAlignment(e.align),this.updateTitle()},m.inheritClass(m.ui.FieldLayout,m.ui.Layout),m.mixinClass(m.ui.FieldLayout,m.ui.mixin.LabelElement),m.mixinClass(m.ui.FieldLayout,m.ui.mixin.TitledElement),m.ui.FieldLayout.prototype.onFieldDisable=function(t){this.$element.toggleClass("oo-ui-fieldLayout-disabled",t)},m.ui.FieldLayout.prototype.onLabelClick=function(){this.fieldWidget.simulateLabelClick()},m.ui.FieldLayout.prototype.getField=function(){return this.fieldWidget},m.ui.FieldLayout.prototype.isFieldInline=function(){return"span"===this.getField().$element.prop("tagName").toLowerCase()},m.ui.FieldLayout.prototype.makeMessage=function(t,e){return new m.ui.MessageWidget({type:t,inline:!0,label:e}).$element},m.ui.FieldLayout.prototype.setAlignment=function(t){return t!==this.align&&("inline"!==(t=-1===["left","right","top","inline"].indexOf(t)?"left":t)||this.isFieldInline()||(t="top"),this.helpInline?"top"===t?(this.$header.append(this.$label),this.$body.append(this.$header,this.$field,this.$help)):"inline"===t?(this.$header.append(this.$label,this.$help),this.$body.append(this.$field,this.$header)):(this.$header.append(this.$label,this.$help),this.$body.append(this.$header,this.$field)):"top"===t?(this.$header.append(this.$help,this.$label),this.$body.append(this.$header,this.$field)):"inline"===t?(this.$header.append(this.$help,this.$label),this.$body.append(this.$field,this.$header)):(this.$header.append(this.$label),this.$body.append(this.$header,this.$help,this.$field)),this.align&&this.$element.removeClass("oo-ui-fieldLayout-align-"+this.align),this.$element.addClass("oo-ui-fieldLayout-align-"+t),this.align=t),this},m.ui.FieldLayout.prototype.setErrors=function(t){return this.errors=t.slice(),this.updateMessages(),this},m.ui.FieldLayout.prototype.setWarnings=function(t){return this.warnings=t.slice(),this.updateMessages(),this},m.ui.FieldLayout.prototype.setSuccess=function(t){return this.successMessages=t.slice(),this.updateMessages(),this},m.ui.FieldLayout.prototype.setNotices=function(t){return this.notices=t.slice(),this.updateMessages(),this},m.ui.FieldLayout.prototype.updateMessages=function(){if(this.$messages.empty(),this.errors.length||this.warnings.length||this.successMessages.length||this.notices.length){this.$body.after(this.$messages);let t;for(t=0;t<this.errors.length;t++)this.$messages.append(this.makeMessage("error",this.errors[t]));for(t=0;t<this.warnings.length;t++)this.$messages.append(this.makeMessage("warning",this.warnings[t]));for(t=0;t<this.successMessages.length;t++)this.$messages.append(this.makeMessage("success",this.successMessages[t]));for(t=0;t<this.notices.length;t++)this.$messages.append(this.makeMessage("notice",this.notices[t]))}else this.$messages.remove()},m.ui.FieldLayout.prototype.formatTitleWithAccessKey=function(t){return this.fieldWidget&&this.fieldWidget.formatTitleWithAccessKey?this.fieldWidget.formatTitleWithAccessKey(t):t},m.ui.FieldLayout.prototype.createHelpElement=function(t,e){let i,o;return i=this.helpInline?(o=new m.ui.LabelWidget({label:t,classes:["oo-ui-inline-help"]})).getElementId():((o=new m.ui.PopupButtonWidget({$overlay:e,popup:{padded:!0},classes:["oo-ui-fieldLayout-help"],framed:!1,icon:"info",label:m.ui.msg("ooui-field-help"),invisibleLabel:!0})).popup.on("ready",()=>{var t=o.popup.$element;t.attr("tabindex",0),t.trigger("focus")}),o.popup.on("closing",()=>{o.$button.trigger("focus")}),t instanceof m.ui.HtmlSnippet?o.getPopup().$body.html(t.toString()):o.getPopup().$body.text(t),o.getPopup().getBodyId()),(this.fieldWidget.$input||this.fieldWidget.input&&this.fieldWidget.input.$input||this.fieldWidget.$button||this.fieldWidget.$element).attr("aria-describedby",i),o.$element},m.ui.ActionFieldLayout=function(t,e,i){m.isPlainObject(t)&&void 0===i&&(t=(i=t).fieldWidget,e=i.buttonWidget),m.ui.ActionFieldLayout.super.call(this,t,i),this.buttonWidget=e,this.$button=$("<span>"),this.$input=this.isFieldInline()?$("<span>"):$("<div>"),this.$element.addClass("oo-ui-actionFieldLayout"),this.$button.addClass("oo-ui-actionFieldLayout-button").append(this.buttonWidget.$element),this.$input.addClass("oo-ui-actionFieldLayout-input").append(this.fieldWidget.$element),this.$field.append(this.$input,this.$button)},m.inheritClass(m.ui.ActionFieldLayout,m.ui.FieldLayout),m.ui.FieldsetLayout=function(t){var e;m.ui.FieldsetLayout.super.call(this,t=t||{}),m.ui.mixin.IconElement.call(this,t),m.ui.mixin.LabelElement.call(this,t),m.ui.mixin.GroupElement.call(this,t),this.$header=$("<legend>"),this.$header.addClass("oo-ui-fieldsetLayout-header").append(this.$icon,this.$label),this.$group.addClass("oo-ui-fieldsetLayout-group"),this.$element.addClass("oo-ui-fieldsetLayout").prepend(this.$header,this.$group),t.help&&(t.helpInline?(e=new m.ui.LabelWidget({label:t.help,classes:["oo-ui-inline-help"]}),this.$element.prepend(this.$header,e.$element,this.$group)):(e=new m.ui.PopupButtonWidget({$overlay:t.$overlay,popup:{padded:!0},classes:["oo-ui-fieldsetLayout-help"],framed:!1,icon:"info",label:m.ui.msg("ooui-field-help"),invisibleLabel:!0}),t.help instanceof m.ui.HtmlSnippet?e.getPopup().$body.html(t.help.toString()):e.getPopup().$body.text(t.help),this.$header.append(e.$element))),this.addItems(t.items||[])},m.inheritClass(m.ui.FieldsetLayout,m.ui.Layout),m.mixinClass(m.ui.FieldsetLayout,m.ui.mixin.IconElement),m.mixinClass(m.ui.FieldsetLayout,m.ui.mixin.LabelElement),m.mixinClass(m.ui.FieldsetLayout,m.ui.mixin.GroupElement),m.ui.FieldsetLayout.static.tagName="fieldset",m.ui.FormLayout=function(t){m.ui.FormLayout.super.call(this,t=t||{}),m.ui.mixin.GroupElement.call(this,Object.assign({$group:this.$element},t)),this.$element.on("submit",this.onFormSubmit.bind(this));let e=t.action;void 0===e||m.ui.isSafeUrl(e)||(e="./"+e),this.$element.addClass("oo-ui-formLayout").attr({method:t.method,action:e,enctype:t.enctype}),this.addItems(t.items||[])},m.inheritClass(m.ui.FormLayout,m.ui.Layout),m.mixinClass(m.ui.FormLayout,m.ui.mixin.GroupElement),m.ui.FormLayout.static.tagName="form",m.ui.FormLayout.prototype.onFormSubmit=function(){if(this.emit("submit"))return!1},m.ui.PanelLayout=function(t){t=Object.assign({scrollable:!1,padded:!1,expanded:!0,framed:!1},t),m.ui.PanelLayout.super.call(this,t),this.$element.addClass("oo-ui-panelLayout"),t.scrollable&&this.$element.addClass("oo-ui-panelLayout-scrollable"),t.padded&&this.$element.addClass("oo-ui-panelLayout-padded"),t.expanded&&this.$element.addClass("oo-ui-panelLayout-expanded"),t.framed&&this.$element.addClass("oo-ui-panelLayout-framed")},m.inheritClass(m.ui.PanelLayout,m.ui.Layout),m.ui.PanelLayout.static.reusePreInfuseDOM=function(t,e){return!1!==(e=m.ui.PanelLayout.super.static.reusePreInfuseDOM(t,e)).preserveContent&&(e.$content=$(t).contents()),e},m.ui.PanelLayout.prototype.focus=function(){m.ui.findFocusable(this.$element).focus()},m.ui.HorizontalLayout=function(t){m.ui.HorizontalLayout.super.call(this,t=t||{}),m.ui.mixin.GroupElement.call(this,Object.assign({$group:this.$element},t)),this.$element.addClass("oo-ui-horizontalLayout"),this.addItems(t.items||[])},m.inheritClass(m.ui.HorizontalLayout,m.ui.Layout),m.mixinClass(m.ui.HorizontalLayout,m.ui.mixin.GroupElement),m.ui.NumberInputWidget=function(t){var e=$("<div>").addClass("oo-ui-numberInputWidget-field");t=Object.assign({min:-1/0,max:1/0,showButtons:!0},t),Object.assign(t,t.input),this.input=this,m.ui.NumberInputWidget.super.call(this,Object.assign(t,{type:"number"})),t.showButtons&&(this.minusButton=new m.ui.ButtonWidget(Object.assign({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],icon:"subtract"},t.minusButton)),this.minusButton.$element.attr("aria-hidden","true"),this.plusButton=new m.ui.ButtonWidget(Object.assign({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],icon:"add"},t.plusButton)),this.plusButton.$element.attr("aria-hidden","true")),this.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),t.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),e.append(this.$input),t.showButtons&&e.prepend(this.minusButton.$element).append(this.plusButton.$element),(t.allowInteger||t.isInteger)&&(t.step=1),this.setRange(t.min,t.max),this.setStep(t.buttonStep,t.pageStep,t.step),this.setValidation(this.validateNumber.bind(this)),this.$element.addClass("oo-ui-numberInputWidget").toggleClass("oo-ui-numberInputWidget-buttoned",t.showButtons).append(e)},m.inheritClass(m.ui.NumberInputWidget,m.ui.TextInputWidget),m.ui.NumberInputWidget.prototype.setAllowInteger=function(t){this.setStep(t?1:null)},m.ui.NumberInputWidget.prototype.setIsInteger=m.ui.NumberInputWidget.prototype.setAllowInteger,m.ui.NumberInputWidget.prototype.getAllowInteger=function(){return 1===this.step},m.ui.NumberInputWidget.prototype.getIsInteger=m.ui.NumberInputWidget.prototype.getAllowInteger,m.ui.NumberInputWidget.prototype.setRange=function(t,e){if(e<t)throw new Error("Minimum ("+t+") must not be greater than maximum ("+e+")");this.min=t,this.max=e,this.$input.attr({min:this.min,max:this.max}),this.setValidityFlag()},m.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},m.ui.NumberInputWidget.prototype.setStep=function(t,e,i){if(void 0===t&&(t=i||1),void 0===e&&(e=10*t),null!==i&&i<=0)throw new Error("Step value, if given, must be positive");if(t<=0)throw new Error("Button step value must be positive");if(e<=0)throw new Error("Page step value must be positive");this.step=i,this.buttonStep=t,this.pageStep=e,this.$input.attr("step",this.step||"any"),this.setValidityFlag()},m.ui.NumberInputWidget.prototype.setValue=function(t){return""===t&&this.$input.val(""),m.ui.NumberInputWidget.super.prototype.setValue.call(this,t)},m.ui.NumberInputWidget.prototype.getStep=function(){return[this.buttonStep,this.pageStep,this.step]},m.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.getValue()},m.ui.NumberInputWidget.prototype.adjustValue=function(t){var e=this.getNumericValue();if(t=+t,isNaN(t)||!isFinite(t))throw new Error("Delta must be a finite number");let i;isNaN(e)?i=0:(i=e+t,i=Math.max(Math.min(i,this.max),this.min),this.step&&(i=Math.round(i/this.step)*this.step)),i!==e&&this.setValue(i)},m.ui.NumberInputWidget.prototype.validateNumber=function(t){var e=+t;return""===t?!this.isRequired():!(isNaN(e)||!isFinite(e)||this.step&&Math.floor(e/this.step)!==e/this.step||e<this.min||e>this.max)},m.ui.NumberInputWidget.prototype.onButtonClick=function(t){this.adjustValue(t*this.buttonStep)},m.ui.NumberInputWidget.prototype.onWheel=function(t){let e=0;return!this.isDisabled()&&!this.isReadOnly()&&this.$input.is(":focus")?(void 0!==t.originalEvent.deltaMode&&(this.sawWheelEvent=!0),t.originalEvent.deltaY?e=-t.originalEvent.deltaY:t.originalEvent.deltaX&&(e=t.originalEvent.deltaX),this.sawWheelEvent||(t.originalEvent.wheelDeltaX?e=-t.originalEvent.wheelDeltaX:t.originalEvent.wheelDeltaY?e=t.originalEvent.wheelDeltaY:t.originalEvent.wheelDelta?e=t.originalEvent.wheelDelta:t.originalEvent.detail&&(e=-t.originalEvent.detail)),e&&(e=e<0?-1:1,this.adjustValue(e*this.buttonStep)),!1):void 0},m.ui.NumberInputWidget.prototype.onKeyDown=function(t){if(!this.isDisabled()&&!this.isReadOnly())switch(t.which){case m.ui.Keys.UP:return this.adjustValue(this.buttonStep),!1;case m.ui.Keys.DOWN:return this.adjustValue(-this.buttonStep),!1;case m.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case m.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},m.ui.NumberInputWidget.prototype.updateControlsDisabled=function(){var t=this.isDisabled()||this.isReadOnly();return this.minusButton&&this.minusButton.setDisabled(t),this.plusButton&&this.plusButton.setDisabled(t),this},m.ui.NumberInputWidget.prototype.setDisabled=function(t){return m.ui.NumberInputWidget.super.prototype.setDisabled.call(this,t),this.updateControlsDisabled(),this},m.ui.NumberInputWidget.prototype.setReadOnly=function(){return m.ui.NumberInputWidget.super.prototype.setReadOnly.apply(this,arguments),this.updateControlsDisabled(),this},m.ui.SelectFileInputWidget=function(e){e=e||{},this.selectButton=new m.ui.ButtonWidget(Object.assign({$element:$("<label>"),classes:["oo-ui-selectFileInputWidget-selectButton"],label:m.ui.msg(e.multiple?"ooui-selectfile-button-select-multiple":"ooui-selectfile-button-select")},e.button)),e=Object.assign({accept:null,placeholder:m.ui.msg("ooui-selectfile-placeholder"),$tabIndexed:this.selectButton.$tabIndexed,droppable:!0,buttonOnly:!1,showDropTarget:!1,thumbnailSizeLimit:20},e),this.canSetFiles=!0;try{new DataTransfer}catch(t){this.canSetFiles=!1,e.droppable=!1}this.info=new m.ui.SearchInputWidget({classes:["oo-ui-selectFileInputWidget-info"],placeholder:e.placeholder,$tabIndexed:$([])}).setIcon(e.icon),this.info.$input.attr("tabindex",-1),this.info.$indicator.attr("tabindex",0),m.ui.SelectFileInputWidget.super.call(this,e),m.ui.mixin.RequiredElement.call(this,Object.assign({},{indicatorElement:null},e)),m.ui.mixin.PendingElement.call(this),this.currentFiles=this.filterFiles(this.$input[0].files||[]),Array.isArray(e.accept)?this.accept=e.accept:this.accept=null,this.multiple=!!e.multiple,this.showDropTarget=e.droppable&&e.showDropTarget,this.thumbnailSizeLimit=e.thumbnailSizeLimit,this.fieldLayout=new m.ui.ActionFieldLayout(this.info,this.selectButton,{align:"top"}),this.$input.attr({type:"file",tabindex:-1,"aria-disabled":null}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),this.multiple&&this.$input.attr("multiple",""),this.selectButton.$button.append(this.$input),this.$element.addClass("oo-ui-selectFileInputWidget oo-ui-selectFileWidget").append(this.fieldLayout.$element),this.showDropTarget?(this.selectButton.setIcon("upload"),this.$element.addClass("oo-ui-selectFileInputWidget-dropTarget oo-ui-selectFileWidget-dropTarget").on({click:this.onDropTargetClick.bind(this)}).append(this.info.$element,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileInputWidget-dropLabel oo-ui-selectFileWidget-dropLabel").text(m.ui.msg(this.multiple?"ooui-selectfile-dragdrop-placeholder-multiple":"ooui-selectfile-dragdrop-placeholder"))),this.multiple||(this.$thumbnail=$("<div>").addClass("oo-ui-selectFileInputWidget-thumbnail oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileInputWidget-withThumbnail oo-ui-selectFileWidget-withThumbnail").prepend(this.$thumbnail)),this.fieldLayout.$element.remove()):e.buttonOnly&&(this.selectButton.$element.addClass(this.$element.attr("class")).addClass("oo-ui-selectFileInputWidget-buttonOnly oo-ui-selectFileWidget-buttonOnly"),this.$element=this.selectButton.$element),this.info.connect(this,{change:"onInfoChange"}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.$input.on({change:this.onFileSelected.bind(this),click:function(t){t.stopPropagation()}}),this.connect(this,{change:"updateUI"}),e.droppable&&(e=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:e,dragover:e,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.updateUI()},m.inheritClass(m.ui.SelectFileInputWidget,m.ui.InputWidget),m.mixinClass(m.ui.SelectFileInputWidget,m.ui.mixin.RequiredElement),m.mixinClass(m.ui.SelectFileInputWidget,m.ui.mixin.PendingElement),m.ui.SelectFileInputWidget.static.title="",m.ui.SelectFileInputWidget.prototype.getValue=function(){return this.multiple?this.currentFiles:this.currentFiles[0]},m.ui.SelectFileInputWidget.prototype.setValue=function(t){if(void 0!==t&&"string"!=typeof t)if(t&&!this.multiple&&(t=t.slice(0,1)),m.compare(t&&t.map(e),this.currentFiles&&this.currentFiles.map(e))||(this.currentFiles=t||[],this.emit("change",this.currentFiles)),this.canSetFiles){const i=new DataTransfer;Array.prototype.forEach.call(this.currentFiles||[],t=>{i.items.add(t)}),this.$input[0].files=i.files}else t&&t.length||m.ui.SelectFileInputWidget.super.prototype.setValue.call(this,"");return this;function e(t){return Object.assign({},t)}},m.ui.SelectFileInputWidget.prototype.getFilename=function(){return this.currentFiles.map(t=>t.name).join(", ")},m.ui.SelectFileInputWidget.prototype.onFileSelected=function(t){t=this.filterFiles(t.target.files||[]);this.setValue(t)},m.ui.SelectFileInputWidget.prototype.onEdit=function(){},m.ui.SelectFileInputWidget.prototype.updateUI=function(){this.selectButton&&(this.info.setValue(this.getFilename()),this.currentFiles.length?(this.$element.removeClass("oo-ui-selectFileInputWidget-empty"),this.showDropTarget&&(this.multiple||(this.pushPending(),this.loadAndGetImageUrl(this.currentFiles[0]).done(t=>{this.$thumbnail.css("background-image","url( "+t+" )")}).fail(()=>{this.$thumbnail.append(new m.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileInputWidget-noThumbnail-icon oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}).always(()=>{this.popPending()})),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.multiple||this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileInputWidget-empty")))},m.ui.SelectFileInputWidget.prototype.loadAndGetImageUrl=function(t){const i=$.Deferred(),e=new FileReader;return 0===(m.getProp(t,"type")||"").indexOf("image/")&&t.size<1024*this.thumbnailSizeLimit*1024?(e.onload=function(t){const e=document.createElement("img");e.addEventListener("load",()=>{0===e.naturalWidth||0===e.naturalHeight||!1===e.complete?i.reject():i.resolve(t.target.result)}),e.src=t.target.result},e.readAsDataURL(t)):i.reject(),i.promise()},m.ui.SelectFileInputWidget.prototype.filterFiles=function(t){const i=this.accept;return Array.prototype.filter.call(t,function(t){const e=t.type;return!i||!e||i.some(t=>t===e||!("/*"!==t.slice(-2)||!e.startsWith(t.slice(0,-1))))})},m.ui.SelectFileInputWidget.prototype.onInfoChange=function(t){""===t&&this.setValue(null)},m.ui.SelectFileInputWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&this.$input&&(t.which===m.ui.Keys.SPACE||t.which===m.ui.Keys.ENTER))return this.$input.trigger("click"),this.selectButton.onDocumentKeyUp(t),!1},m.ui.SelectFileInputWidget.prototype.setDisabled=function(t){return m.ui.SelectFileInputWidget.super.prototype.setDisabled.call(this,t),this.selectButton.setDisabled(t),this.info.setDisabled(t),this.info.$input.attr("disabled",!0),this},m.ui.SelectFileInputWidget.prototype.onDropTargetClick=function(){if(!this.isDisabled()&&this.$input)return this.$input.trigger("click"),!1},m.ui.SelectFileInputWidget.prototype.onDragEnterOrOver=function(t){let e=!1;var i,o=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.isDisabled()?(this.$element.removeClass(["oo-ui-selectFileInputWidget-canDrop","oo-ui-selectFileWidget-canDrop","oo-ui-selectFileInputWidget-cantDrop"]),!(o.dropEffect="none")):((i=!(!(t=o.items||o.files)||!t.length))?this.filterFiles(t).length&&(e=!0):-1!==Array.prototype.indexOf.call(m.getProp(o,"types")||[],"Files")&&(e=!0),this.$element.toggleClass("oo-ui-selectFileInputWidget-canDrop oo-ui-selectFileWidget-canDrop",e),this.$element.toggleClass("oo-ui-selectFileInputWidget-cantDrop",!e&&i),e||(o.dropEffect="none"),!1)},m.ui.SelectFileInputWidget.prototype.onDragLeave=function(){this.$element.removeClass(["oo-ui-selectFileInputWidget-canDrop","oo-ui-selectFileWidget-canDrop","oo-ui-selectFileInputWidget-cantDrop"])},m.ui.SelectFileInputWidget.prototype.onDrop=function(t){var e=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.$element.removeClass(["oo-ui-selectFileInputWidget-canDrop","oo-ui-selectFileWidget-canDrop","oo-ui-selectFileInputWidget-cantDrop"]),this.isDisabled()||(t=this.filterFiles(e.files||[]),this.setValue(t)),!1},m.ui.SelectFileWidget=function(){m.ui.warnDeprecation("SelectFileWidget: Deprecated alias, use SelectFileInputWidget instead."),m.ui.SelectFileWidget.super.apply(this,arguments)},m.inheritClass(m.ui.SelectFileWidget,m.ui.SelectFileInputWidget)}(OO),function(d){"use strict";d.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle"),this.toggleDraggable(void 0===t.draggable||!!t.draggable)},d.initClass(d.ui.mixin.DraggableElement),d.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,d.ui.mixin.DraggableElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.$handle.toggleClass("oo-ui-draggableElement-undraggable",!this.draggable),this.$element.prop("draggable",this.draggable))},d.ui.mixin.DraggableElement.prototype.isDraggable=function(){return this.draggable},d.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(t){this.isDraggable()&&(this.wasHandleUsed=this.$handle[0]===this.$element[0]||d.ui.contains(this.$handle[0],t.target,!0))},d.ui.mixin.DraggableElement.prototype.onDragStart=function(t){if(!this.wasHandleUsed||!this.isDraggable())return!1;t=t.originalEvent.dataTransfer;t.dropEffect="none",t.effectAllowed="move";try{t.setData("application-x/OOUI-draggable",this.getIndex())}catch(t){}if(!t.getData("text"))try{t.setData("text"," ")}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(()=>{this.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},d.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},d.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},d.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},d.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},d.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},d.ui.mixin.DraggableGroupElement=function(t){d.ui.mixin.GroupElement.call(this,t=t||{}),this.orientation=t.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.draggable=void 0===t.draggable||!!t.draggable,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),this.addItems(t.items||[]),this.$element.addClass("oo-ui-draggableGroupElement").toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},d.mixinClass(d.ui.mixin.DraggableGroupElement,d.ui.mixin.GroupElement),d.ui.mixin.DraggableGroupElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.getItems().forEach(t=>{t.toggleDraggable(this.draggable)}),this.emit("draggable",this.draggable))},d.ui.mixin.DraggableGroupElement.prototype.isDraggable=function(){return this.draggable},d.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.isDraggable()&&(this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t))},d.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){for(let t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},d.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e=this.getDragItem();return e&&(t=this.items.indexOf(e),(e=e.getIndex()+(e.getIndex()>t?1:0))!==t&&(this.reorder(this.getDragItem(),e),this.emit("reorder",this.getDragItem(),e)),this.updateIndexes()),this.unsetDragItem(),!1},d.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i=this.getDragItem(),o=i.getIndex(),n=$(t.target).closest(".oo-ui-draggableElement").data("index");void 0!==n&&n!==o&&(0<(e=n+(o<n?1:0))?this.$group.children().eq(e-1).after(i.$element):this.$group.prepend(i.$element),this.itemsOrder.splice(n,0,this.itemsOrder.splice(o,1)[0]),this.updateIndexes(),this.emit("drag",i,e)),t.preventDefault()},d.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},d.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},d.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},d.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},d.ui.mixin.RequestManager=function(t){this.requestCache={},this.requestQuery=null,this.requestRequest=null,this.showPendingRequest=!!this.pushPending&&!1!==t.showPendingRequest},d.initClass(d.ui.mixin.RequestManager),d.ui.mixin.RequestManager.prototype.getRequestData=function(){const e=this.getRequestQuery(),i=$.Deferred();if(this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,e))i.resolve(this.requestCache[e]);else{this.showPendingRequest&&this.pushPending(),this.requestQuery=e;const o=this.requestRequest=this.getRequest();o.always(()=>{this.showPendingRequest&&this.popPending()}).done(t=>{o===this.requestRequest&&(this.requestQuery=null,this.requestRequest=null,this.requestCache[e]=this.getRequestCacheDataFromResponse(t),i.resolve(this.requestCache[e]))}).fail(()=>{o===this.requestRequest&&(this.requestQuery=null,this.requestRequest=null,i.reject())})}return i.promise()},d.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},d.ui.mixin.RequestManager.prototype.getRequestQuery=null,d.ui.mixin.RequestManager.prototype.getRequest=null,d.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,d.ui.mixin.LookupElement=function(t){t=Object.assign({highlightFirst:!0},t),d.ui.mixin.RequestManager.call(this,t),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,this.lookupMenu=new d.ui.MenuSelectWidget(Object.assign({widget:this,input:this,$floatableContainer:t.$container||this.$element},t.menu)),this.allowSuggestionsWhenEmpty=t.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=t.highlightFirst,this.showSuggestionsOnFocus=!1!==t.showSuggestionsOnFocus,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuChoose"}),this.$input.attr({role:"combobox","aria-owns":this.lookupMenu.getElementId(),"aria-autocomplete":"list"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},d.mixinClass(d.ui.mixin.LookupElement,d.ui.mixin.RequestManager),d.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.showSuggestionsOnFocus&&this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},d.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupMenu.isVisible()||!this.lookupInputFocused&&this.showSuggestionsOnFocus||this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},d.ui.mixin.LookupElement.prototype.onLookupMenuChoose=function(t){this.setValue(t.getData())},d.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},d.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},d.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},d.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},d.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var t=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==t?t!==this.lookupQuery&&this.getLookupMenuItems().done(t=>{this.lookupMenu.clearItems(),t.length?(this.lookupMenu.addItems(t).toggle(!0),this.initializeLookupMenuSelection()):this.lookupMenu.toggle(!1)}).fail(()=>{this.lookupMenu.clearItems(),this.lookupMenu.toggle(!1)}):this.closeLookupMenu(),this},d.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.findSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.findFirstSelectableItem())},d.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(t=>this.getLookupMenuOptionsFromData(t))},d.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},d.ui.mixin.LookupElement.prototype.getLookupRequest=null,d.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,d.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,d.ui.mixin.LookupElement.prototype.setReadOnly=function(t){return d.ui.TextInputWidget.prototype.setReadOnly.call(this,t),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},d.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},d.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},d.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},d.ui.TabPanelLayout=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=Object.assign({scrollable:!0},e),d.ui.TabPanelLayout.super.call(this,e),this.name=t,this.label=e.label,this.tabItemConfig=e.tabItemConfig||{},this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-tabPanelLayout").attr("role","tabpanel")},d.inheritClass(d.ui.TabPanelLayout,d.ui.PanelLayout),d.ui.TabPanelLayout.prototype.getName=function(){return this.name},d.ui.TabPanelLayout.prototype.isActive=function(){return this.active},d.ui.TabPanelLayout.prototype.getTabItem=function(){return this.tabItem},d.ui.TabPanelLayout.prototype.getTabItemConfig=function(){return this.tabItemConfig},d.ui.TabPanelLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},d.ui.TabPanelLayout.prototype.setupTabItem=function(){return this.$element.attr("aria-labelledby",this.tabItem.getElementId()),this.tabItem.$element.attr("aria-controls",this.getElementId()),this.label&&this.tabItem.setLabel(this.label),this},d.ui.TabPanelLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-tabPanelLayout-active",this.active),this.emit("active",this.active))},d.ui.PageLayout=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=Object.assign({scrollable:!0},e),d.ui.PageLayout.super.call(this,e),this.name=t,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},d.inheritClass(d.ui.PageLayout,d.ui.PanelLayout),d.ui.PageLayout.prototype.getName=function(){return this.name},d.ui.PageLayout.prototype.isActive=function(){return this.active},d.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},d.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},d.ui.PageLayout.prototype.setupOutlineItem=function(){},d.ui.PageLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},d.ui.StackLayout=function(t){t=Object.assign({scrollable:!(!t||!t.continuous)},t),d.ui.StackLayout.super.call(this,t),d.ui.mixin.GroupElement.call(this,Object.assign({$group:this.$element},t)),this.currentItem=null,this.setContinuous(!!t.continuous),this.hideUntilFound=!!t.hideUntilFound,this.$element.addClass("oo-ui-stackLayout"),this.addItems(t.items||[])},d.inheritClass(d.ui.StackLayout,d.ui.PanelLayout),d.mixinClass(d.ui.StackLayout,d.ui.mixin.GroupElement),d.ui.StackLayout.prototype.setContinuous=function(t){this.continuous=t,this.$element.toggleClass("oo-ui-stackLayout-continuous",!!t),this.updateHiddenState(this.items,this.currentItem)},d.ui.StackLayout.prototype.isContinuous=function(){return this.continuous},d.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},d.ui.StackLayout.prototype.unsetCurrentItem=function(){null!==this.currentItem&&(this.currentItem=null,this.emit("set",null))},d.ui.StackLayout.prototype.setHideUntilFound=function(t){this.hideUntilFound=t,this.updateHiddenState(this.items,this.currentItem)},d.ui.StackLayout.prototype.addItems=function(t,e){return t&&0!==t.length&&(this.updateHiddenState(t,this.currentItem),d.ui.mixin.GroupElement.prototype.addItems.call(this,t,e),this.currentItem||this.setItem(t[0])),this},d.ui.StackLayout.prototype.removeItems=function(e){var t=-1!==e.indexOf(this.currentItem);let i;if(t){let t=this.items.indexOf(this.currentItem);for(;(i=this.items[++t])&&-1!==e.indexOf(i););}return d.ui.mixin.GroupElement.prototype.removeItems.call(this,e),t&&(this.items.length?this.setItem(i||this.items[this.items.length-1]):this.unsetCurrentItem()),this},d.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),d.ui.mixin.GroupElement.prototype.clearItems.call(this),this},d.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),-1!==this.items.indexOf(t)?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},d.ui.StackLayout.prototype.resetScroll=function(){return this.isContinuous()?d.ui.StackLayout.super.prototype.resetScroll.call(this):(this.getItems().forEach(t=>{var e=t.$element.hasClass("oo-ui-element-hidden");t.$element.removeClass("oo-ui-element-hidden"),t.resetScroll(),e&&t.$element.addClass("oo-ui-element-hidden")}),this)},d.ui.StackLayout.prototype.updateHiddenState=function(t,i){this.isContinuous()?t.forEach(t=>{t.$element[0].removeAttribute("hidden"),t.$element.removeAttr("aria-hidden")}):(t.forEach(t=>{var e;i&&i===t||(e=!(t instanceof d.ui.TabPanelLayout&&t.getTabItem()&&t.getTabItem().isDisabled())&&this.hideUntilFound,t.$element[0].setAttribute("hidden",e?"until-found":"hidden"),t.$element.attr("aria-hidden","true"))}),i&&(i.$element[0].removeAttribute("hidden"),i.$element.removeAttr("aria-hidden")))},d.ui.MenuLayout=function(t){t=Object.assign({expanded:!0,showMenu:!0,menuPosition:"before"},t),d.ui.MenuLayout.super.call(this,t),this.menuPanel=null,this.contentPanel=null,this.expanded=!!t.expanded,this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout"),t.expanded?this.$element.addClass("oo-ui-menuLayout-expanded"):this.$element.addClass("oo-ui-menuLayout-static"),t.menuPanel&&this.setMenuPanel(t.menuPanel),t.contentPanel&&this.setContentPanel(t.contentPanel),this.setMenuPosition(t.menuPosition),this.toggleMenu(t.showMenu)},d.inheritClass(d.ui.MenuLayout,d.ui.Layout),d.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},d.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},d.ui.MenuLayout.prototype.setMenuPosition=function(t){return-1===["top","bottom","before","after"].indexOf(t)&&(t="before"),this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,"top"===this.menuPosition||"before"===this.menuPosition?this.$element.append(this.$menu,this.$content):this.$element.append(this.$content,this.$menu),this.$element.addClass("oo-ui-menuLayout-"+t),this},d.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},d.ui.MenuLayout.prototype.setMenuPanel=function(t){this.menuPanel=t,this.$menu.append(this.menuPanel.$element)},d.ui.MenuLayout.prototype.setContentPanel=function(t){this.contentPanel=t,this.$content.append(this.contentPanel.$element)},d.ui.MenuLayout.prototype.clearMenuPanel=function(){this.menuPanel=null,this.$menu.empty()},d.ui.MenuLayout.prototype.clearContentPanel=function(){this.contentPanel=null,this.$content.empty()},d.ui.MenuLayout.prototype.resetScroll=function(){return this.menuPanel&&this.menuPanel.resetScroll(),this.contentPanel&&this.contentPanel.resetScroll(),this},d.ui.BookletLayout=function(t){d.ui.BookletLayout.super.call(this,t=t||{}),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new d.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.outlineVisible=!1,this.outlined=!!t.outlined,this.outlined&&(this.editable=!!t.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new d.ui.OutlineSelectWidget,this.outlinePanel=new d.ui.PanelLayout({expanded:this.expanded,scrollable:!0}),this.setMenuPanel(this.outlinePanel),this.outlineVisible=!0,this.editable)&&(this.outlineControlsWidget=new d.ui.OutlineControlsWidget(this.outlineSelectWidget)),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable)&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element)},d.inheritClass(d.ui.BookletLayout,d.ui.MenuLayout),d.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e=$(t.target).closest(".oo-ui-pageLayout");for(const i in this.pages)if(this.pages[i].$element[0]===e[0]&&i!==this.currentPageName){this.setPage(i);break}},d.ui.BookletLayout.prototype.onStackLayoutSet=function(e){if(e){let t;t=this.stackLayout.isContinuous()&&!this.scrolling?e.scrollElementIntoView():$.Deferred().resolve(),!this.autoFocus||d.ui.isMobile()||this.scrolling||t.done(()=>{this.focus()})}},d.ui.BookletLayout.prototype.focus=function(t){var e=this.stackLayout.getItems();let i;!(i=void 0!==t&&e[t]?e[t]:this.stackLayout.getCurrentItem())&&this.outlined&&(this.selectFirstSelectablePage(),i=this.stackLayout.getCurrentItem()),i&&!d.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)&&i.focus()},d.ui.BookletLayout.prototype.focusFirstFocusable=function(){d.ui.findFocusable(this.stackLayout.$element).focus()},d.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},d.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},d.ui.BookletLayout.prototype.isEditable=function(){return this.editable},d.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},d.ui.BookletLayout.prototype.toggleOutline=function(t){return this.outlined&&(t=void 0===t?!this.outlineVisible:!!t,this.outlineVisible=t,this.toggleMenu(t),t)&&this.editable&&setTimeout(()=>{d.ui.Element.static.reconsiderScrollbars(this.outlinePanel.$element[0])},d.ui.theme.getDialogTransitionDuration()),this},d.ui.BookletLayout.prototype.findClosestPage=function(t){var e=this.stackLayout.getItems(),i=e.indexOf(t);if(-1===i)return null;var o=e[i+1],e=e[i-1];if(this.outlined){i=this.outlineSelectWidget.findItemFromData(t.getName()).getLevel();if(e&&i===this.outlineSelectWidget.findItemFromData(e.getName()).getLevel())return e;if(o&&i===this.outlineSelectWidget.findItemFromData(o.getName()).getLevel())return o}return e||o||null},d.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},d.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},d.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},d.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},d.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},d.ui.BookletLayout.prototype.addPages=function(t,e){var i,o,n=this.stackLayout.getItems(),s=[],l=[];let u,a,r,h;for(u=0,a=t.length;u<a;u++)r=t[u],h=r.getName(),Object.prototype.hasOwnProperty.call(this.pages,h)&&(-1!==(i=n.indexOf(this.pages[h]))&&i+1<e&&e--,s.push(this.pages[h]));for(s.length&&this.removePages(s),u=0,a=t.length;u<a;u++)r=t[u],h=r.getName(),this.pages[r.getName()]=r,this.outlined&&(o=new d.ui.OutlineOptionWidget({data:h}),r.setOutlineItem(o),l.push(o));return this.outlined&&this.outlineSelectWidget.addItems(l,e),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},d.ui.BookletLayout.prototype.removePages=function(i){var o=[];for(let t=0,e=i.length;t<e;t++){var n=i[t],s=n.getName();delete this.pages[s],this.outlined&&(o.push(this.outlineSelectWidget.findItemFromData(s)),n.setOutlineItem(null)),this.currentPageName===s&&(this.currentPageName=null)}return o.length&&this.outlineSelectWidget.removeItems(o),this.stackLayout.removeItems(i),this.emit("remove",i),this},d.ui.BookletLayout.prototype.clearPages=function(){var i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined){this.outlineSelectWidget.clearItems();for(let t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null)}return this.stackLayout.clearItems(),this.emit("remove",i),this},d.ui.BookletLayout.prototype.setPage=function(e){var i=this.pages[e];if(i&&e!==this.currentPageName){var o,n=this.currentPageName?this.pages[this.currentPageName]:null;this.currentPageName=e,!this.outlined||(o=this.outlineSelectWidget.findSelectedItem())&&o.getData()===e||this.outlineSelectWidget.selectItemByData(e);let t;n&&(n.setActive(!1),this.autoFocus)&&!d.ui.isMobile()&&this.stackLayout.isContinuous()&&0!==d.ui.findFocusable(i.$element).length&&(t=n.$element.find(":focus")).length&&t[0].blur(),i.setActive(!0),this.stackLayout.setItem(i),!this.stackLayout.isContinuous()&&n&&(t=n.$element.find(":focus")).length&&t[0].blur(),this.emit("set",i)}},d.ui.BookletLayout.prototype.resetScroll=function(){return d.ui.BookletLayout.super.prototype.resetScroll.call(this),this.outlined&&this.stackLayout.isContinuous()&&this.outlineSelectWidget.findFirstSelectableItem()&&(this.scrolling=!0,this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this.scrolling=!1),this},d.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.findSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this},d.ui.IndexLayout=function(i){i=Object.assign({},i,{menuPosition:"top"}),d.ui.IndexLayout.super.call(this,i),this.currentTabPanelName=null,this.tabPanels=i.tabPanels||{},this.openMatchedPanels=void 0===i.openMatchedPanels||!!i.openMatchedPanels,this.ignoreFocus=!1,this.contentPanel&&this.contentPanel.setHideUntilFound(this.openMatchedPanels),this.stackLayout=this.contentPanel||new d.ui.StackLayout({continuous:!!i.continuous,expanded:this.expanded,hideUntilFound:this.openMatchedPanels}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===i.autoFocus||!!i.autoFocus,i.tabSelectWidget&&this.stackLayout.getItems().forEach((t,e)=>{t.getTabItem()||t.setTabItem(i.tabSelectWidget.items[e]||null)}),this.tabSelectWidget=i.tabSelectWidget||new d.ui.TabSelectWidget({framed:void 0===i.framed||i.framed}),this.tabPanel=this.menuPanel||new d.ui.PanelLayout({expanded:this.expanded}),this.setMenuPanel(this.tabPanel),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.openMatchedPanels&&this.stackLayout.$element.on("beforematch",this.onStackLayoutBeforeMatch.bind(this)),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element),this.selectFirstSelectableTabPanel()},d.inheritClass(d.ui.IndexLayout,d.ui.MenuLayout),d.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e=$(t.target).closest(".oo-ui-tabPanelLayout");for(const i in this.tabPanels)if(this.tabPanels[i].$element[0]===e[0]&&i!==this.currentTabPanelName){this.setTabPanel(i);break}},d.ui.IndexLayout.prototype.onStackLayoutSet=function(t){t&&this.autoFocus&&!d.ui.isMobile()&&this.focus()},d.ui.IndexLayout.prototype.onStackLayoutBeforeMatch=function(e){let i;var t;this.stackLayout.getItems().some(t=>t.$element[0]===e.target&&(i=t,!0)),i&&(t=i.getTabItem())&&this.tabSelectWidget.selectItem(t)},d.ui.IndexLayout.prototype.focus=function(t){var e=this.stackLayout.getItems();let i;(i=void 0!==t&&e[t]?e[t]:this.stackLayout.getCurrentItem())||(this.selectFirstSelectableTabPanel(),i=this.stackLayout.getCurrentItem()),i&&!d.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)&&i.focus()},d.ui.IndexLayout.prototype.focusFirstFocusable=function(){d.ui.findFocusable(this.stackLayout.$element).focus()},d.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setTabPanel(t.getData())},d.ui.IndexLayout.prototype.getClosestTabPanel=function(t){var e,i=this.stackLayout.getItems(),o=i.indexOf(t);return-1===o?null:(e=i[o+1],i=i[o-1],o=this.tabSelectWidget.findItemFromData(t.getName()).getLevel(),i&&o===this.tabSelectWidget.findItemFromData(i.getName()).getLevel()?i:e&&o===this.tabSelectWidget.findItemFromData(e.getName()).getLevel()?e:i||e||null)},d.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},d.ui.IndexLayout.prototype.getTabPanel=function(t){return this.tabPanels[t]},d.ui.IndexLayout.prototype.getCurrentTabPanel=function(){var t=this.getCurrentTabPanelName();return t?this.getTabPanel(t):void 0},d.ui.IndexLayout.prototype.getCurrentTabPanelName=function(){return this.currentTabPanelName},d.ui.IndexLayout.prototype.addTabPanels=function(t,e){let i,o,n,s,l,u;var a=this.stackLayout.getItems(),r=[],h=[];for(i=0,o=t.length;i<o;i++)s=t[i],n=s.getName(),Object.prototype.hasOwnProperty.call(this.tabPanels,n)&&(-1!==(u=a.indexOf(this.tabPanels[n]))&&u+1<e&&e--,r.push(this.tabPanels[n]));for(r.length&&this.removeTabPanels(r),i=0,o=t.length;i<o;i++)s=t[i],n=s.getName(),this.tabPanels[n]=s,l=new d.ui.TabOptionWidget(Object.assign({data:n},s.getTabItemConfig())),s.setTabItem(l),h.push(l);return h.length&&(this.tabSelectWidget.addItems(h,e),this.selectFirstSelectableTabPanel()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},d.ui.IndexLayout.prototype.removeTabPanels=function(t){let e,i,o,n;var s=[];for(e=0,i=t.length;e<i;e++)o=(n=t[e]).getName(),delete this.tabPanels[o],s.push(this.tabSelectWidget.findItemFromData(o)),n.setTabItem(null);return s.length&&(this.tabSelectWidget.removeItems(s),this.selectFirstSelectableTabPanel()),this.stackLayout.removeItems(t),this.emit("remove",t),this},d.ui.IndexLayout.prototype.clearTabPanels=function(){let t,e;var i=this.stackLayout.getItems();for(this.tabPanels={},this.currentTabPanelName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},d.ui.IndexLayout.prototype.setTabPanel=function(t){let e,i,o,n;t!==this.currentTabPanelName&&(n=this.getTabPanel(t),o=this.getCurrentTabPanel(),(e=this.tabSelectWidget.findSelectedItem())&&e.getData()===t||this.tabSelectWidget.selectItemByData(t),n)&&(o&&(o.setActive(!1),this.autoFocus)&&!d.ui.isMobile()&&this.stackLayout.isContinuous()&&0!==d.ui.findFocusable(n.$element).length&&(i=o.$element.find(":focus")).length&&i[0].blur(),this.currentTabPanelName=t,n.setActive(!0),this.stackLayout.setItem(n),!this.stackLayout.isContinuous()&&o&&(i=o.$element.find(":focus")).length&&i[0].blur(),this.emit("set",n))},d.ui.IndexLayout.prototype.selectFirstSelectableTabPanel=function(){return this.tabSelectWidget.findSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.findFirstSelectableItem()),this},d.ui.CopyTextLayout=function(t){var e=(t=t||{}).multiline?d.ui.MultilineTextInputWidget:d.ui.TextInputWidget;this.textInput=new e(Object.assign({value:t.copyText,readOnly:!0},t.textInput)),this.button=new d.ui.ButtonWidget(Object.assign({label:d.ui.msg("ooui-copytextlayout-copy"),icon:"copy"},t.button)),d.ui.CopyTextLayout.super.call(this,this.textInput,this.button,t),t.multiline&&(this.$input.removeClass("oo-ui-actionFieldLayout-input"),this.$button.removeClass("oo-ui-actionFieldLayout-button").addClass("oo-ui-copyTextLayout-multiline-button")),this.button.connect(this,{click:"onButtonClick"}),this.textInput.$input.on("focus",this.onInputFocus.bind(this)),this.$element.addClass("oo-ui-copyTextLayout")},d.inheritClass(d.ui.CopyTextLayout,d.ui.ActionFieldLayout),d.ui.CopyTextLayout.prototype.onButtonClick=function(){let e;this.selectText();try{e=document.execCommand("copy")}catch(t){e=!1}this.emit("copy",e)},d.ui.CopyTextLayout.prototype.onInputFocus=function(){this.selecting||this.selectText()},d.ui.CopyTextLayout.prototype.selectText=function(){var t=this.textInput.$input[0],e=t.scrollTop,i=t.scrollLeft;this.selecting=!0,this.textInput.select(),this.selecting=!1,t.scrollTop=e,t.scrollLeft=i},d.ui.ToggleButtonWidget=function(t){d.ui.ToggleButtonWidget.super.call(this,t=t||{}),d.ui.mixin.ButtonElement.call(this,Object.assign({active:this.active},t)),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.LabelElement.call(this,t),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$button},t)),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button),this.setTitledElement(this.$button)},d.inheritClass(d.ui.ToggleButtonWidget,d.ui.ToggleWidget),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.ButtonElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.LabelElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.FlaggedElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.TabIndexedElement),d.ui.ToggleButtonWidget.static.tagName="span",d.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},d.ui.ToggleButtonWidget.prototype.setValue=function(t){return(t=!!t)!==this.value&&(this.$button&&this.$button.attr("aria-pressed",t.toString()),this.setActive(t)),d.ui.ToggleButtonWidget.super.prototype.setValue.call(this,t),this},d.ui.ToggleButtonWidget.prototype.setButtonElement=function(t){this.$button&&this.$button.removeAttr("aria-pressed"),d.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,t),this.$button.attr("aria-pressed",this.value.toString())},d.ui.OutlineControlsWidget=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).outline),d.ui.OutlineControlsWidget.super.call(this,e=e||{}),d.ui.mixin.GroupElement.call(this,e),this.outline=t,this.$movers=$("<div>"),this.upButton=new d.ui.ButtonWidget({framed:!1,icon:"upTriangle",title:d.ui.msg("ooui-outline-control-move-up")}),this.downButton=new d.ui.ButtonWidget({framed:!1,icon:"downTriangle",title:d.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new d.ui.ButtonWidget({framed:!1,icon:"trash",title:d.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},t.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.upButton.$element,this.downButton.$element,this.removeButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(e.abilities||{})},d.inheritClass(d.ui.OutlineControlsWidget,d.ui.Widget),d.mixinClass(d.ui.OutlineControlsWidget,d.ui.mixin.GroupElement),d.ui.OutlineControlsWidget.prototype.setAbilities=function(t){for(const e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},d.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var e=this.outline.getItems(),t=this.outline.findSelectedItem(),i=this.abilities.move&&t&&t.isMovable(),o=this.abilities.remove&&t&&t.isRemovable();let n,s;if(i){let t=-1;for(var l=e.length;++t<l;)if(e[t].isMovable()){n=e[t];break}for(t=l;t--;)if(e[t].isMovable()){s=e[t];break}}this.upButton.setDisabled(!i||t===n),this.downButton.setDisabled(!i||t===s),this.removeButton.setDisabled(!o)},d.ui.OutlineOptionWidget=function(t){d.ui.OutlineOptionWidget.super.call(this,t=t||{}),this.movable=!!t.movable,this.removable=!!t.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(t.level)},d.inheritClass(d.ui.OutlineOptionWidget,d.ui.DecoratedOptionWidget),d.ui.OutlineOptionWidget.static.highlightable=!0,d.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,d.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",d.ui.OutlineOptionWidget.static.levels=3,d.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},d.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},d.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},d.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},d.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},d.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e,i;return this.level!==(t=t||0)&&(e=this.constructor.static.levels,i=this.constructor.static.levelClass,void 0!==this.level&&this.$element.removeClass(i+this.level),this.level=0<t?Math.min(t,e-1):0,this.$element.addClass(i+this.level),this.updateThemeClasses()),this},d.ui.OutlineSelectWidget=function(t){d.ui.OutlineSelectWidget.super.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},d.inheritClass(d.ui.OutlineSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.OutlineSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.ButtonOptionWidget=function(t){d.ui.ButtonOptionWidget.super.call(this,t=t||{}),d.ui.mixin.ButtonElement.call(this,t),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button),this.setTitledElement(this.$button)},d.inheritClass(d.ui.ButtonOptionWidget,d.ui.OptionWidget),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.ButtonElement),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.IndicatorElement),d.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,d.ui.ButtonOptionWidget.static.highlightable=!1,d.ui.ButtonOptionWidget.prototype.setSelected=function(t){return d.ui.ButtonOptionWidget.super.prototype.setSelected.call(this,t),this.constructor.static.selectable&&this.setActive(t),this},d.ui.ButtonSelectWidget=function(t){d.ui.ButtonSelectWidget.super.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},d.inheritClass(d.ui.ButtonSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.ButtonSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.TabOptionWidget=function(t){(t=t||{}).href&&(t=Object.assign({$label:$("<a>").attr("href",t.href)},t)),d.ui.TabOptionWidget.super.call(this,t),this.$element.addClass("oo-ui-tabOptionWidget").attr("role","tab")},d.inheritClass(d.ui.TabOptionWidget,d.ui.OptionWidget),d.ui.TabOptionWidget.static.highlightable=!1,d.ui.TabOptionWidget.static.scrollIntoViewOnSelect=!0,d.ui.TabOptionWidget.prototype.scrollElementIntoView=function(t){var e;return d.ui.isMobile()&&this.getElementGroup()?(e=Math.max((this.getElementGroup().$element[0].clientWidth-this.$element[0].clientWidth)/2,0),d.ui.TabOptionWidget.super.prototype.scrollElementIntoView.call(this,Object.assign({padding:{left:e,right:e}},t))):d.ui.TabOptionWidget.super.prototype.scrollElementIntoView.call(this)},d.ui.TabSelectWidget=function(t){d.ui.TabSelectWidget.super.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget").attr("role","tablist"),this.toggleFramed(void 0===t.framed||t.framed),d.ui.isMobile()&&this.$element.addClass("oo-ui-tabSelectWidget-mobile")},d.inheritClass(d.ui.TabSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.TabSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.TabSelectWidget.prototype.isFramed=function(){return this.framed},d.ui.TabSelectWidget.prototype.toggleFramed=function(t){return(t=void 0===t?!this.framed:!!t)!==this.framed&&(this.framed=t,this.$element.toggleClass("oo-ui-tabSelectWidget-frameless",!t).toggleClass("oo-ui-tabSelectWidget-framed",t)),this},d.ui.ButtonMenuSelectWidget=function(t){d.ui.ButtonMenuSelectWidget.super.call(this,t=t||{}),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element;var e=t.menuClass||d.ui.MenuSelectWidget;this.clearOnSelect=!1!==t.clearOnSelect,this.menu=new e(Object.assign({widget:this,$floatableContainer:this.$element,spacing:4},t.menu)),this.connect(this,{click:"onButtonMenuClick"}),this.getMenu().connect(this,{select:"onMenuSelect",toggle:"onMenuToggle"}),this.$button.attr({"aria-expanded":"false","aria-haspopup":"true","aria-owns":this.menu.getElementId()}),this.$element.addClass("oo-ui-buttonMenuSelectWidget"),this.$overlay.append(this.menu.$element)},d.inheritClass(d.ui.ButtonMenuSelectWidget,d.ui.ButtonWidget),d.ui.ButtonMenuSelectWidget.prototype.getMenu=function(){return this.menu},d.ui.ButtonMenuSelectWidget.prototype.onMenuSelect=function(t){this.clearOnSelect&&t&&this.getMenu().selectItem()},d.ui.ButtonMenuSelectWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-buttonElement-pressed",t)},d.ui.ButtonMenuSelectWidget.prototype.onButtonMenuClick=function(){this.menu.toggle()},d.ui.TagItemWidget=function(t){d.ui.TagItemWidget.super.call(this,t=t||{}),d.ui.mixin.ItemWidget.call(this),d.ui.mixin.LabelElement.call(this,t),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),d.ui.mixin.DraggableElement.call(this,t),this.valid=void 0===t.valid||!!t.valid,this.fixed=!!t.fixed,this.closeButton=new d.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:d.ui.msg("ooui-item-remove")}),this.closeButton.setDisabled(this.isDisabled()),this.closeButton.connect(this,{click:"remove"}),this.$element.on("click",this.select.bind(this)).on("keydown",this.onKeyDown.bind(this)).on("mousedown",t=>{t.stopPropagation()}),this.$element.addClass("oo-ui-tagItemWidget").append(this.$label,this.closeButton.$element)},d.inheritClass(d.ui.TagItemWidget,d.ui.Widget),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.ItemWidget),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.LabelElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.FlaggedElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.TabIndexedElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.DraggableElement),d.ui.TagItemWidget.prototype.setFixed=function(t){return t=void 0===t?!this.fixed:!!t,this.fixed!==t&&(this.fixed=t,this.closeButton&&this.closeButton.toggle(!this.fixed),this.fixed||!this.elementGroup||this.elementGroup.isDraggable()||this.toggleDraggable(!this.fixed),this.$element.toggleClass("oo-ui-tagItemWidget-fixed",this.fixed),this.emit("fixed",this.isFixed())),this},d.ui.TagItemWidget.prototype.isFixed=function(){return this.fixed},d.ui.TagItemWidget.prototype.remove=function(){this.isDisabled()||this.isFixed()||this.emit("remove")},d.ui.TagItemWidget.prototype.onKeyDown=function(e){if(!(this.isDisabled()||this.isFixed()||e.keyCode!==d.ui.Keys.BACKSPACE&&e.keyCode!==d.ui.Keys.DELETE))return this.remove(),!1;if(e.keyCode===d.ui.Keys.ENTER)return this.select(),!1;if(e.keyCode===d.ui.Keys.LEFT||e.keyCode===d.ui.Keys.RIGHT){let t;return t="rtl"===d.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},this.emit("navigate",e.keyCode===d.ui.Keys.LEFT?t.left:t.right),!1}},d.ui.TagItemWidget.prototype.select=function(){this.isDisabled()||this.emit("select")},d.ui.TagItemWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},d.ui.TagItemWidget.prototype.isValid=function(){return this.valid},d.ui.TagMultiselectWidget=function(t){var e,i=window.requestAnimationFrame||setTimeout,o=$("<span>").addClass("oo-ui-tagMultiselectWidget-focusTrap");d.ui.TagMultiselectWidget.super.call(this,t=t||{}),d.ui.mixin.GroupWidget.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.DraggableGroupElement.call(this,t),d.ui.mixin.TitledElement.call(this,t),this.inputPosition=-1<this.constructor.static.allowedInputPositions.indexOf(t.inputPosition)?t.inputPosition:"inline",this.allowEditTags=void 0===t.allowEditTags||!!t.allowEditTags,this.allowArbitrary=!!t.allowArbitrary,this.allowDuplicates=!!t.allowDuplicates,this.allowedValues=t.allowedValues||[],this.allowDisplayInvalidTags=t.allowDisplayInvalidTags,this.hasInput="none"!==this.inputPosition,this.tagLimit=t.tagLimit,this.allowReordering=void 0===t.allowReordering||!!t.allowReordering,this.height=null,this.valid=!0,this.toggleDraggable(this.allowReordering),this.$content=$("<div>").addClass("oo-ui-tagMultiselectWidget-content"),this.$handle=$("<div>").addClass("oo-ui-tagMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content.append(this.$group.addClass("oo-ui-tagMultiselectWidget-group"))),this.aggregate({remove:"itemRemove",navigate:"itemNavigate",select:"itemSelect",fixed:"itemFixed"}),this.connect(this,{itemRemove:"onTagRemove",itemSelect:"onTagSelect",itemFixed:"onTagFixed",itemNavigate:"onTagNavigate",change:"onChangeTags"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$element.addClass("oo-ui-tagMultiselectWidget").append(this.$handle),this.hasInput?(t.inputWidget?this.input=t.inputWidget:this.input=new d.ui.TextInputWidget(Object.assign({placeholder:t.placeholder,classes:["oo-ui-tagMultiselectWidget-input"]},t.input)),this.input.setDisabled(this.isDisabled()),e={focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":d.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onInputKeyDown.bind(this),keypress:this.onInputKeyPress.bind(this)},this.input.$input.on(e),this.inputPlaceholder=this.input.$input.attr("placeholder"),"outline"===this.inputPosition?(this.input.$element.css("max-width","inherit"),this.$element.addClass("oo-ui-tagMultiselectWidget-outlined").append(this.input.$element)):(this.$element.addClass("oo-ui-tagMultiselectWidget-inlined"),this.$group.append(this.input.$input))):this.$content.append(o),this.setTabIndexedElement(this.hasInput?this.input.$input:o),t.selected&&this.setValue(t.selected),i(()=>{this.hasInput&&this.updateInputSize()})},d.inheritClass(d.ui.TagMultiselectWidget,d.ui.Widget),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.GroupWidget),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.DraggableGroupElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.TabIndexedElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.FlaggedElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.TitledElement),d.ui.TagMultiselectWidget.static.allowedInputPositions=["inline","outline","none"],d.ui.TagMultiselectWidget.prototype.onMouseDown=function(t){if(!(this.isDisabled()||this.hasInput&&t.target===this.input.$input[0]||t.which!==d.ui.MouseButtons.LEFT))return this.focus(),!1},d.ui.TagMultiselectWidget.prototype.onInputKeyPress=function(e){var i=e.metaKey||e.ctrlKey;if(!this.isDisabled()){let t;return e.which===d.ui.Keys.ENTER&&(t=this.doInputEnter(e,i)),this.updateInputSize(),t}},d.ui.TagMultiselectWidget.prototype.onInputKeyDown=function(e){var i=e.metaKey||e.ctrlKey,o=t=>{var e=this.input.getRange(),i=this.hasInput&&this.input.getValue();return!("forwards"===t&&e.to>i.length-1||"backwards"===t&&e.from<=0)};if(!this.isDisabled()){if(e.keyCode===d.ui.Keys.BACKSPACE)return this.doInputBackspace(e,i);if(e.keyCode===d.ui.Keys.ESCAPE)return this.doInputEscape(e);if(e.keyCode===d.ui.Keys.LEFT||e.keyCode===d.ui.Keys.RIGHT){let t;t="rtl"===d.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"};var n=e.keyCode===d.ui.Keys.LEFT?t.left:t.right;if(!this.hasInput||!o(n))return this.doInputArrow(e,n,i)}}},d.ui.TagMultiselectWidget.prototype.onInputFocus=function(){this.$element.addClass("oo-ui-tagMultiselectWidget-focus"),this.toggleValid(!0)},d.ui.TagMultiselectWidget.prototype.onInputBlur=function(){this.changing||(this.$element.removeClass("oo-ui-tagMultiselectWidget-focus"),this.addTagFromInput(),this.toggleValid(this.checkValidity()&&(!this.hasInput||!this.input.getValue())))},d.ui.TagMultiselectWidget.prototype.doInputEnter=function(){return this.addTagFromInput(),!1},d.ui.TagMultiselectWidget.prototype.doInputBackspace=function(t,e){if("inline"===this.inputPosition&&""===this.input.getValue()&&!this.isEmpty()){var i=this.getItems(),i=i[i.length-1];if(!i.isDisabled()&&!i.isFixed()&&(this.removeItems([i]),!e)){let t;"string"==typeof i.getLabel()?t=i.getLabel():i.getLabel()instanceof $&&(t=i.getLabel().text()),this.input.setValue(t)}return!1}},d.ui.TagMultiselectWidget.prototype.doInputEscape=function(){this.clearInput()},d.ui.TagMultiselectWidget.prototype.doInputArrow=function(t,e){"inline"!==this.inputPosition||this.isEmpty()||"backwards"!==e||this.getPreviousItem().focus()},d.ui.TagMultiselectWidget.prototype.onTagSelect=function(t){this.hasInput&&this.allowEditTags&&!t.isFixed()&&(this.input.getValue()&&this.addTagFromInput(),this.input.setValue(t.getLabel()),this.removeItems([t]),this.focus())},d.ui.TagMultiselectWidget.prototype.onTagFixed=function(t){var e=this.getItems();let i;for(i=0;i<e.length&&(e[i]===t||e[i].isFixed());i++);this.addItems([t],i)},d.ui.TagMultiselectWidget.prototype.onChangeTags=function(){var t,e=this.isUnderLimit();this.changing=!0,this.toggleValid(this.checkValidity()),this.hasInput&&(this.updateInputSize(),e||this.input.setValue(""),"outline"===this.inputPosition?(this.input.$input.attr("placeholder",e?this.inputPlaceholder:""),this.input.setDisabled(!e)):(t=document.activeElement===this.input.$input[0],this.$group.append(this.input.$input),this.input.$input.toggleClass("oo-ui-element-hidden",!e),t&&e&&this.input.focus())),this.updateIfHeightChanged(),this.changing=!1},d.ui.TagMultiselectWidget.prototype.setDisabled=function(e){d.ui.TagMultiselectWidget.super.prototype.setDisabled.call(this,e),this.hasInput&&this.input&&(e||this.updateInputSize(),this.input.setDisabled(!!e||!this.isUnderLimit())),this.items&&this.getItems().forEach(t=>{t.setDisabled(!!e)})},d.ui.TagMultiselectWidget.prototype.onTagRemove=function(t){this.removeTagByData(t.getData())},d.ui.TagMultiselectWidget.prototype.onTagNavigate=function(t,e){var i=this.getItems()[0];"forwards"===e?this.getNextItem(t).focus():"inline"!==!this.inputPosition&&t===i||this.getPreviousItem(t).focus()},d.ui.TagMultiselectWidget.prototype.getTagInfoFromInput=function(){var t=this.input.getValue();return{data:t,label:t}},d.ui.TagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.getTagInfoFromInput();t.data&&this.addTag(t.data,t.label)&&this.clearInput()},d.ui.TagMultiselectWidget.prototype.clearInput=function(){this.input.setValue("")},d.ui.TagMultiselectWidget.prototype.isDuplicateData=function(t){return!!this.findItemFromData(t)},d.ui.TagMultiselectWidget.prototype.isAllowedData=function(e){return!(!this.allowDuplicates&&this.isDuplicateData(e)||!this.allowArbitrary&&!this.getAllowedValues().some(t=>e===t))},d.ui.TagMultiselectWidget.prototype.getAllowedValues=function(){return this.allowedValues},d.ui.TagMultiselectWidget.prototype.addAllowedValue=function(t){-1===this.allowedValues.indexOf(t)&&this.allowedValues.push(t)},d.ui.TagMultiselectWidget.prototype.getValue=function(){return this.getItems().filter(t=>t.isValid()).map(t=>t.getData())},d.ui.TagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.clearItems(),t.forEach(t=>{"object"==typeof t?this.addTag(t.data,t.label):this.addTag(String(t))})},d.ui.TagMultiselectWidget.prototype.addTag=function(e,i){var o=this.isAllowedData(e);if(this.isUnderLimit()&&(o||this.allowDisplayInvalidTags)){i=this.createTagItemWidget(e,i);i.toggleValid(o),i.toggleDraggable(this.allowReordering);let t=this.getItems().length;if(!this.allowReordering){var n=this.getAllowedValues().indexOf(e);if(-1!==n){t=0;for(var[s,l]of this.getItems().entries()){l=this.getAllowedValues().indexOf(l.getData());if(!(-1!==l&&l<=n))break;t=s+1}}}return this.addItems([i],t),!0}return!1},d.ui.TagMultiselectWidget.prototype.isUnderLimit=function(){return!this.tagLimit||this.getItemCount()<this.tagLimit},d.ui.TagMultiselectWidget.prototype.removeTagByData=function(t){t=this.findItemFromData(t);this.removeItems([t])},d.ui.TagMultiselectWidget.prototype.createTagItemWidget=function(t,e){return new d.ui.TagItemWidget({data:t,label:e||t})},d.ui.TagMultiselectWidget.prototype.getNextItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[0]:e===this.items.length-1?this.hasInput?this.input:this.items[0]:this.items[e+1]},d.ui.TagMultiselectWidget.prototype.getPreviousItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[this.items.length-1]:0===e?this.hasInput?this.input:this.items[this.items.length-1]:this.items[e-1]},d.ui.TagMultiselectWidget.prototype.updateInputSize=function(){if("inline"!==this.inputPosition||this.isDisabled())this.updateIfHeightChanged();else if(0!==this.input.$input[0].scrollWidth){this.input.$input.css("width","1em");var e=this.$group.children().last(),i=d.ui.Element.static.getDir(this.$handle),o=this.input.$input.attr("placeholder"),o=(void 0===this.contentWidthWithPlaceholder&&""===this.input.getValue()&&void 0!==o&&(this.input.$input.val(o),this.contentWidthWithPlaceholder=this.input.$input[0].scrollWidth,this.input.$input.val("")),Math.max(this.input.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder)),t=this.input.$input.width();if(!(o<t)){let t;t=0===e.length?this.$content.innerWidth():"ltr"===i?this.$content.innerWidth()-e.position().left-e.outerWidth():e.position().left,o>(t-=13)&&(t=this.$content.innerWidth()-13),this.input.$input.width(Math.floor(t))}this.updateIfHeightChanged()}},d.ui.TagMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.emit("resize"))},d.ui.TagMultiselectWidget.prototype.checkValidity=function(){return this.getItems().every(t=>t.isValid())},d.ui.TagMultiselectWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},d.ui.TagMultiselectWidget.prototype.isValid=function(){return this.valid},d.ui.PopupTagMultiselectWidget=function(t){var e,i={popup:{}};t=t||{},d.ui.PopupTagMultiselectWidget.super.call(this,Object.assign({inputPosition:"none"},t)),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,t.popup||(e=new d.ui.TextInputWidget,i.popupInput=e,i.popup.$content=e.$element,i.popup.padded=!0,this.$element.addClass("oo-ui-popupTagMultiselectWidget-defaultPopup")),i.popup.$overlay=this.$overlay,i.popup.$autoCloseIgnore=this.hasInput?this.input.$element.add(this.$overlay):this.$overlay,t=Object.assign(i,t),d.ui.mixin.PopupElement.call(this,t),this.hasInput&&this.input.$input.on("focus",this.popup.toggle.bind(this.popup,!0)),this.popupInput=t.popupInput,this.popupInput&&this.popupInput.connect(this,{enter:"onPopupInputEnter"}),this.on("resize",this.popup.updateDimensions.bind(this.popup)),this.popup.connect(this,{toggle:"onPopupToggle"}),this.$tabIndexed.on("focus",this.onFocus.bind(this)),this.$element.append(this.popup.$element).addClass("oo-ui-popupTagMultiselectWidget"),d.ui.warnDeprecation("PopupTagMultiselectWidget: Deprecated widget. Use MenuTagMultiselectWidget instead. See T208821.")},d.inheritClass(d.ui.PopupTagMultiselectWidget,d.ui.TagMultiselectWidget),d.mixinClass(d.ui.PopupTagMultiselectWidget,d.ui.mixin.PopupElement),d.ui.PopupTagMultiselectWidget.prototype.onFocus=function(){this.popup.toggle(!0)},d.ui.PopupTagMultiselectWidget.prototype.onPopupToggle=function(t){t&&this.popupInput&&this.popupInput.focus()},d.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter=function(){this.popupInput&&(this.addTagByPopupValue(this.popupInput.getValue()),this.popupInput.setValue(""))},d.ui.PopupTagMultiselectWidget.prototype.onTagSelect=function(t){this.popupInput&&this.allowEditTags?(this.popupInput.setValue(t.getData()),this.removeItems([t]),this.popup.toggle(!0),this.popupInput.focus()):d.ui.PopupTagMultiselectWidget.super.prototype.onTagSelect.call(this,t)},d.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue=function(t,e){this.addTag(t,e)},d.ui.MenuTagMultiselectWidget=function(t){let e=$([]),i=(t=t||{}).options||[];var o=t.selected||[],n=(i=i.concat(o.map(t=>"string"==typeof t?{data:t,label:t}:t)),d.copy(t));n.options=i,n.selected=o,d.ui.MenuTagMultiselectWidget.super.call(this,n),e=e.add(this.$group),this.hasInput&&(e=e.add(this.input.$element)),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,this.clearInputOnChoose=void 0===t.clearInputOnChoose||!!t.clearInputOnChoose,this.menu=this.createMenuWidget(Object.assign({widget:this,hideOnChoose:!1,input:this.hasInput?this.input:null,$input:this.hasInput?this.input.$input:null,filterFromInput:!!this.hasInput,highlightOnFilter:!this.allowArbitrary,multiselect:!0,$autoCloseIgnore:e,$floatableContainer:(this.hasInput&&"outline"===this.inputPosition?this.input:this).$element,$overlay:this.$overlay,disabled:this.isDisabled()},t.menu)),this.addOptions(i),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle"}),this.hasInput&&this.input.connect(this,{change:"onInputChange"}),this.connect(this,{resize:"onResize"}),this.$overlay.append(this.menu.$element),this.$element.addClass("oo-ui-menuTagMultiselectWidget"),this.menu.$focusOwner.removeAttr("aria-expanded"),0<o.length&&this.setValue(o)},d.inheritClass(d.ui.MenuTagMultiselectWidget,d.ui.TagMultiselectWidget),d.ui.MenuTagMultiselectWidget.prototype.onResize=function(){this.menu.position()},d.ui.MenuTagMultiselectWidget.prototype.onInputFocus=function(){var t=this.isValid();d.ui.MenuTagMultiselectWidget.super.prototype.onInputFocus.call(this),this.isUnderLimit()&&(this.menu.toggle(!0),t||this.menu.highlightItem())},d.ui.MenuTagMultiselectWidget.prototype.onInputChange=function(){this.menu.toggle(!0)},d.ui.MenuTagMultiselectWidget.prototype.onMenuChoose=function(t,e){e&&!this.findItemFromData(t.getData())?this.addTag(t.getData(),t.getLabel()):this.removeTagByData(t.getData()),this.hasInput&&this.clearInputOnChoose&&this.input.setValue("")},d.ui.MenuTagMultiselectWidget.prototype.onMenuToggle=function(t){t||(this.menu.highlightItem(null),this.menu.scrollToTop()),setTimeout(()=>{this.menu.$focusOwner.removeAttr("aria-expanded")})},d.ui.MenuTagMultiselectWidget.prototype.onTagSelect=function(t){var e=this.menu.findItemFromData(t.getData());this.allowArbitrary?d.ui.MenuTagMultiselectWidget.super.prototype.onTagSelect.call(this,t):(this.hasInput&&this.menu.filterFromInput&&this.input.setValue(""),this.focus(),this.menu.highlightItem(e),this.menu.scrollItemIntoView(e))},d.ui.MenuTagMultiselectWidget.prototype.removeItems=function(t){d.ui.MenuTagMultiselectWidget.super.prototype.removeItems.call(this,t),t.forEach(t=>{t=this.menu.findItemFromData(t.getData());t&&this.menu.unselectItem(t)})},d.ui.MenuTagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.menu&&(this.clearItems(),t.forEach(t=>{let e,i;"string"==typeof t?e=i=t:(e=t.data,i=t.label);t=this.menu.getItemFromLabel(i)||this.menu.findItemFromData(e);t?(this.addTag(t.getData(),t.getLabel()),this.menu.selectItem(t)):this.allowArbitrary&&this.addTag(e,i)}))},d.ui.MenuTagMultiselectWidget.prototype.onChangeTags=function(){d.ui.MenuTagMultiselectWidget.super.prototype.onChangeTags.call(this),this.menu&&!this.isUnderLimit()&&this.menu.toggle(!1)},d.ui.MenuTagMultiselectWidget.prototype.setDisabled=function(t){d.ui.MenuTagMultiselectWidget.super.prototype.setDisabled.call(this,t),this.menu&&this.menu.setDisabled(t)},d.ui.MenuTagMultiselectWidget.prototype.initializeMenuSelection=function(){this.menu.highlightItem(this.allowArbitrary?null:this.menu.findFirstSelectableItem());var t=this.menu.findHighlightedItem();t&&this.menu.scrollItemIntoView(t)},d.ui.MenuTagMultiselectWidget.prototype.getTagInfoFromInput=function(){var t=this.input.getValue(),e=this.menu.findHighlightedItem()||this.menu.findItemFromData(t);return{data:e?e.getData():t,label:e?e.getLabel():t}},d.ui.MenuTagMultiselectWidget.prototype.createMenuWidget=function(t){return new d.ui.MenuSelectWidget(t)},d.ui.MenuTagMultiselectWidget.prototype.addOptions=function(t){const e=[],i=[];t.forEach(t=>{-1===e.indexOf(t.data)&&(e.push(t.data),i.push(this.createMenuOptionWidget(t.data,t.label,t.icon)))}),this.menu.addItems(i)},d.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget=function(t,e,i){return new d.ui.MenuOptionWidget({data:t,label:e||t,icon:i})},d.ui.MenuTagMultiselectWidget.prototype.getMenu=function(){return this.menu},d.ui.MenuTagMultiselectWidget.prototype.getAllowedValues=function(){let t=[];return this.menu&&(t=this.menu.getItems().map(t=>t.getData())),this.allowedValues.concat(t)},d.ui.SearchWidget=function(t){d.ui.SearchWidget.super.call(this,t=t||{}),this.query=t.input||new d.ui.SearchInputWidget({placeholder:t.placeholder,value:t.value}),this.results=new d.ui.SelectWidget,this.results.setFocusOwner(this.query.$input),this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},d.inheritClass(d.ui.SearchWidget,d.ui.Widget),d.ui.SearchWidget.prototype.onQueryKeydown=function(t){var e,t=t.which===d.ui.Keys.DOWN?1:t.which===d.ui.Keys.UP?-1:0;t&&(e=this.results.findHighlightedItem()||this.results.findSelectedItem(),e=this.results.findRelativeSelectableItem(e,t),this.results.highlightItem(e),e)&&e.scrollElementIntoView()},d.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},d.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.findHighlightedItem();t&&this.results.chooseItem(t)},d.ui.SearchWidget.prototype.getQuery=function(){return this.query},d.ui.SearchWidget.prototype.getResults=function(){return this.results}}(OO),function(u){"use strict";u.ui.Toolbar=function(t,e,i){u.isPlainObject(t)&&void 0===i&&(t=(i=t).toolFactory,e=i.toolGroupFactory),u.ui.Toolbar.super.call(this,i=i||{}),u.EventEmitter.call(this),u.ui.mixin.GroupElement.call(this,i),this.toolFactory=t,this.toolGroupFactory=e,this.groupsByName={},this.activeToolGroups=0,this.tools={},this.position=i.position||"top",this.$bar=$("<div>"),this.$after=$("<div>"),this.$actions=$("<div>"),this.$popups=$("<div>"),this.initialized=!1,this.narrow=!1,this.narrowThreshold=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$overlay=(!0===i.$overlay?u.ui.getDefaultOverlay():i.$overlay)||this.$element,this.$element.add(this.$bar).add(this.$group).add(this.$after).add(this.$actions).on("mousedown keydown",this.onPointerDown.bind(this)),this.$bar.addClass("oo-ui-toolbar-bar"),this.$group.addClass("oo-ui-toolbar-tools"),this.$after.addClass("oo-ui-toolbar-tools oo-ui-toolbar-after"),this.$popups.addClass("oo-ui-toolbar-popups"),this.$bar.append(this.$group,this.$after),i.actions&&this.$bar.append(this.$actions.addClass("oo-ui-toolbar-actions")),this.$bar.append($("<div>").css("clear","both")),this.$element.addClass("oo-ui-toolbar oo-ui-toolbar-position-"+this.position).append(this.$bar),this.$overlay.append(this.$popups)},u.inheritClass(u.ui.Toolbar,u.ui.Element),u.mixinClass(u.ui.Toolbar,u.EventEmitter),u.mixinClass(u.ui.Toolbar,u.ui.mixin.GroupElement),u.ui.Toolbar.prototype.getToolFactory=function(){return this.toolFactory},u.ui.Toolbar.prototype.getToolGroupFactory=function(){return this.toolGroupFactory},u.ui.Toolbar.prototype.insertItemElements=function(t){u.ui.mixin.GroupElement.prototype.insertItemElements.apply(this,arguments),"after"===t.align&&this.$after.append(t.$element)},u.ui.Toolbar.prototype.onPointerDown=function(t){var t=$(t.target).closest(".oo-ui-widget"),e=this.$element.closest(".oo-ui-widget");if(!t.length||t[0]===e[0])return!1},u.ui.Toolbar.prototype.onWindowResize=function(){this.setNarrow(this.$bar[0].clientWidth<=this.getNarrowThreshold())},u.ui.Toolbar.prototype.isNarrow=function(){return this.narrow},u.ui.Toolbar.prototype.setNarrow=function(t){t!==this.narrow&&(this.narrow=t,this.$element.add(this.$popups).toggleClass("oo-ui-toolbar-narrow",this.narrow),this.emit("resize"))},u.ui.Toolbar.prototype.getNarrowThreshold=function(){return null===this.narrowThreshold&&(this.narrowThreshold=this.$group[0].offsetWidth+this.$after[0].offsetWidth+this.$actions[0].offsetWidth),this.narrowThreshold},u.ui.Toolbar.prototype.initialize=function(){this.initialized||(this.initialized=!0,$(this.getElementWindow()).on("resize",this.onWindowResizeHandler),this.onWindowResize())},u.ui.Toolbar.prototype.setup=function(i){this.reset();var o=[];for(let t=0,e=i.length;t<e;t++){var n=i[t],s=("*"===n.include&&(void 0===n.type&&(n.type="list"),void 0===n.label)&&(n.label=u.ui.msg("ooui-toolbar-more")),this.getToolGroupFactory().lookup(n.type)?n.type:"bar"),s=this.getToolGroupFactory().create(s,this,n);o.push(s),(this.groupsByName[n.name]=s).connect(this,{active:"onToolGroupActive"})}this.addItems(o)},u.ui.Toolbar.prototype.onToolGroupActive=function(t){t?(this.activeToolGroups++,1===this.activeToolGroups&&this.emit("active",!0)):(this.activeToolGroups--,0===this.activeToolGroups&&this.emit("active",!1))},u.ui.Toolbar.prototype.getToolGroupByName=function(t){return this.groupsByName[t]||null},u.ui.Toolbar.prototype.reset=function(){this.groupsByName={},this.tools={};for(let t=0,e=this.items.length;t<e;t++)this.items[t].destroy();this.clearItems()},u.ui.Toolbar.prototype.destroy=function(){$(this.getElementWindow()).off("resize",this.onWindowResizeHandler),this.reset(),this.$element.remove()},u.ui.Toolbar.prototype.isToolAvailable=function(t){return!this.tools[t]},u.ui.Toolbar.prototype.reserveTool=function(t){this.tools[t.getName()]=t},u.ui.Toolbar.prototype.releaseTool=function(t){delete this.tools[t.getName()]},u.ui.Toolbar.prototype.getToolAccelerator=function(){},u.ui.Tool=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolGroup),u.ui.Tool.super.call(this,e=e||{}),this.toolGroup=t,this.toolbar=this.toolGroup.getToolbar(),this.active=!1,this.$title=$("<span>"),this.$accel=$("<span>"),this.$link=$("<a>"),this.title=null,this.checkIcon=new u.ui.IconWidget({icon:"check",classes:["oo-ui-tool-checkIcon"]}),this.displayBothIconAndLabel=(void 0!==e.displayBothIconAndLabel?e:this.constructor.static).displayBothIconAndLabel,this.narrowConfig=e.narrowConfig||this.constructor.static.narrowConfig,u.ui.mixin.IconElement.call(this,e),u.ui.mixin.FlaggedElement.call(this,e),u.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$link},e)),this.toolbar.connect(this,{updateState:"onUpdateState",resize:"onToolbarResize"}),this.$title.addClass("oo-ui-tool-title"),this.$accel.addClass("oo-ui-tool-accel").prop({dir:"ltr",lang:"en"}),this.$link.addClass("oo-ui-tool-link").append(this.checkIcon.$element,this.$icon,this.$title,this.$accel).attr("role","button"),u.ui.isMobile()||this.$link.append(this.$accel),this.$element.data("oo-ui-tool",this).addClass("oo-ui-tool").addClass("oo-ui-tool-name-"+this.constructor.static.name.replace(/^([^/]+)\/([^/]+).*$/,"$1-$2")).append(this.$link),this.setTitle(e.title||this.constructor.static.title)},u.inheritClass(u.ui.Tool,u.ui.Widget),u.mixinClass(u.ui.Tool,u.ui.mixin.IconElement),u.mixinClass(u.ui.Tool,u.ui.mixin.FlaggedElement),u.mixinClass(u.ui.Tool,u.ui.mixin.TabIndexedElement),u.ui.Tool.static.tagName="span",u.ui.Tool.static.name="",u.ui.Tool.static.group="",u.ui.Tool.static.title="",u.ui.Tool.static.displayBothIconAndLabel=!1,u.ui.Tool.static.autoAddToCatchall=!0,u.ui.Tool.static.autoAddToGroup=!0,u.ui.Tool.static.isCompatibleWith=function(){return!1},u.ui.Tool.static.narrowConfig=null,u.ui.Tool.prototype.onUpdateState=null,u.ui.Tool.prototype.onSelect=null,u.ui.Tool.prototype.isActive=function(){return this.active},u.ui.Tool.prototype.setActive=function(t){this.active=!!t,this.$element.toggleClass("oo-ui-tool-active",this.active),this.updateThemeClasses()},u.ui.Tool.prototype.setTitle=function(t){return this.title=u.ui.resolveMsg(t),this.updateTitle(),this.setDisplayBothIconAndLabel(this.displayBothIconAndLabel),this},u.ui.Tool.prototype.setDisplayBothIconAndLabel=function(t){return this.displayBothIconAndLabel=t,this.$element.toggleClass("oo-ui-tool-with-label",!!this.title&&this.displayBothIconAndLabel),this},u.ui.Tool.prototype.getTitle=function(){return this.title},u.ui.Tool.prototype.getName=function(){return this.constructor.static.name},u.ui.Tool.prototype.onToolbarResize=function(){this.narrowConfig&&(this.toolbar.isNarrow()?(void 0!==this.narrowConfig.displayBothIconAndLabel&&(this.wideDisplayBothIconAndLabel=this.displayBothIconAndLabel,this.setDisplayBothIconAndLabel(this.narrowConfig.displayBothIconAndLabel)),void 0!==this.narrowConfig.title&&(this.wideTitle=this.title,this.setTitle(this.narrowConfig.title)),void 0!==this.narrowConfig.icon&&(this.wideIcon=this.icon,this.setIcon(this.narrowConfig.icon))):(void 0!==this.wideDisplayBothIconAndLabel&&this.setDisplayBothIconAndLabel(this.wideDisplayBothIconAndLabel),void 0!==this.wideTitle&&this.setTitle(this.wideTitle),void 0!==this.wideIcon&&this.setIcon(this.wideIcon)))},u.ui.Tool.prototype.updateTitle=function(){var t=this.toolGroup.constructor.static.titleTooltips,e=this.toolGroup.constructor.static.accelTooltips,i=this.toolbar.getToolAccelerator(this.constructor.static.name),o=[];this.$title.text(this.title),this.$accel.text(i),t&&"string"==typeof this.title&&this.title.length&&o.push(this.title),e&&"string"==typeof i&&i.length&&o.push(i),o.length?this.$link.attr("title",o.join(" ")):this.$link.removeAttr("title")},u.ui.Tool.prototype.setIcon=function(t){return u.ui.mixin.IconElement.prototype.setIcon.call(this,t),this.$element.toggleClass("oo-ui-tool-with-icon",!!this.icon),this},u.ui.Tool.prototype.destroy=function(){this.toolbar.disconnect(this),this.$element.remove()},u.ui.ToolGroup=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolbar),u.ui.ToolGroup.super.call(this,e=e||{}),u.ui.mixin.GroupElement.call(this,e),this.toolbar=t,this.tools={},this.pressed=null,this.autoDisabled=!1,this.include=e.include||[],this.exclude=e.exclude||[],this.promote=e.promote||[],this.demote=e.demote||[],this.align=e.align||"before",this.onDocumentMouseKeyUpHandler=this.onDocumentMouseKeyUp.bind(this),this.$group.on({mousedown:this.onMouseKeyDown.bind(this),mouseup:this.onMouseKeyUp.bind(this),keydown:this.onMouseKeyDown.bind(this),keyup:this.onMouseKeyUp.bind(this),focus:this.onMouseOverFocus.bind(this),blur:this.onMouseOutBlur.bind(this),mouseover:this.onMouseOverFocus.bind(this),mouseout:this.onMouseOutBlur.bind(this)}),this.toolbar.getToolFactory().connect(this,{register:"onToolFactoryRegister"}),this.aggregate({disable:"itemDisable"}),this.connect(this,{itemDisable:"updateDisabled",disable:"onDisable"}),this.$group.addClass("oo-ui-toolGroup-tools"),this.$element.addClass("oo-ui-toolGroup").append(this.$group),this.onDisable(this.isDisabled()),this.populate()},u.inheritClass(u.ui.ToolGroup,u.ui.Widget),u.mixinClass(u.ui.ToolGroup,u.ui.mixin.GroupElement),u.ui.ToolGroup.static.titleTooltips=!1,u.ui.ToolGroup.static.accelTooltips=!1,u.ui.ToolGroup.static.autoDisable=!0,u.ui.ToolGroup.static.name=null,u.ui.ToolGroup.prototype.isDisabled=function(){return this.autoDisabled||u.ui.ToolGroup.super.prototype.isDisabled.apply(this,arguments)},u.ui.ToolGroup.prototype.updateDisabled=function(){let e=!0;if(this.constructor.static.autoDisable){for(let t=this.items.length-1;0<=t;t--)if(!this.items[t].isDisabled()){e=!1;break}this.autoDisabled=e}u.ui.ToolGroup.super.prototype.updateDisabled.apply(this,arguments)},u.ui.ToolGroup.prototype.onDisable=function(t){this.$group.toggleClass("oo-ui-toolGroup-disabled-tools",t),this.$group.toggleClass("oo-ui-toolGroup-enabled-tools",!t)},u.ui.ToolGroup.prototype.onMouseKeyDown=function(t){if(!this.isDisabled()&&(t.which===u.ui.MouseButtons.LEFT||t.which===u.ui.Keys.SPACE||t.which===u.ui.Keys.ENTER)&&(this.pressed=this.findTargetTool(t),this.pressed))return this.pressed.setActive(!0),this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onDocumentMouseKeyUpHandler,!0),!1},u.ui.ToolGroup.prototype.onDocumentMouseKeyUp=function(t){this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onDocumentMouseKeyUpHandler,!0),this.onMouseKeyUp(t)},u.ui.ToolGroup.prototype.onMouseKeyUp=function(t){var e=this.findTargetTool(t);this.isDisabled()||!this.pressed||this.pressed!==e||t.which!==u.ui.MouseButtons.LEFT&&t.which!==u.ui.Keys.SPACE&&t.which!==u.ui.Keys.ENTER||(this.pressed.onSelect(),this.pressed=null,t.preventDefault(),t.stopPropagation()),this.pressed=null},u.ui.ToolGroup.prototype.onMouseOverFocus=function(t){t=this.findTargetTool(t);this.pressed&&this.pressed===t&&this.pressed.setActive(!0)},u.ui.ToolGroup.prototype.onMouseOutBlur=function(t){t=this.findTargetTool(t);this.pressed&&this.pressed===t&&this.pressed.setActive(!1)},u.ui.ToolGroup.prototype.findTargetTool=function(t){t=$(t.target).closest(".oo-ui-tool-link");let e;return(e=t.length?t.parent().data("oo-ui-tool"):e)&&!e.isDisabled()?e:null},u.ui.ToolGroup.prototype.onToolFactoryRegister=function(){this.populate()},u.ui.ToolGroup.prototype.getToolbar=function(){return this.toolbar},u.ui.ToolGroup.prototype.populate=function(){var i=this.toolbar.getToolFactory(),o={},n=[],t=[],s=this.toolbar.getToolFactory().getTools(this.include,this.exclude,this.promote,this.demote);let l;for(let t=0,e=s.length;t<e;t++)if(l=s[t],i.lookup(l)&&(this.toolbar.isToolAvailable(l)||this.tools[l])){this.toolbar.tools[l]=!0;let t=this.tools[l];t||(this.tools[l]=t=i.create(l,this),t.updateTitle()),this.toolbar.reserveTool(t),n.push(t),o[l]=!0}for(l in this.tools)o[l]||(this.tools[l].destroy(),this.toolbar.releaseTool(this.tools[l]),t.push(this.tools[l]),delete this.tools[l]);t.length&&this.removeItems(t),this.$element.toggleClass("oo-ui-toolGroup-empty",!n.length),this.addItems(n),this.updateDisabled()},u.ui.ToolGroup.prototype.destroy=function(){this.clearItems(),this.toolbar.getToolFactory().disconnect(this);for(const t in this.tools)this.toolbar.releaseTool(this.tools[t]),this.tools[t].disconnect(this).destroy(),delete this.tools[t];this.$element.remove()},u.ui.ToolFactory=function(){u.ui.ToolFactory.super.call(this)},u.inheritClass(u.ui.ToolFactory,u.Factory),u.ui.ToolFactory.prototype.getTools=function(t,e,i,o){var n=[],s={},l=u.simpleArrayDifference(this.extract(t),this.extract(e)),t=this.extract(i,s),e=this.extract(o,s);for(let t=0,e=l.length;t<e;t++)s[l[t]]||n.push(l[t]);return t.concat(n).concat(e)},u.ui.ToolFactory.prototype.extract=function(n,s){var l=[];for(let o=0,t=(n=Array.isArray(n)?n:[n]).length;o<t;o++){let t=n[o],e,i;if("*"===t)for(e in this.registry)!(i=this.registry[e]).static.autoAddToCatchall||s&&s[e]||(l.push(e),s&&(s[e]=!0));else if("string"==typeof t&&(t={name:t}),u.isPlainObject(t))if(t.group)for(e in this.registry)(i=this.registry[e]).static.group!==t.group||!i.static.autoAddToGroup||s&&s[e]||(l.push(e),s&&(s[e]=!0));else!t.name||s&&s[t.name]||(l.push(t.name),s&&(s[t.name]=!0))}return l},u.ui.ToolGroupFactory=function(){u.Factory.call(this);var i=this.constructor.static.getDefaultClasses();for(let t=0,e=i.length;t<e;t++)this.register(i[t])},u.inheritClass(u.ui.ToolGroupFactory,u.Factory),u.ui.ToolGroupFactory.static.getDefaultClasses=function(){return[u.ui.BarToolGroup,u.ui.ListToolGroup,u.ui.MenuToolGroup]},u.ui.PopupTool=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolGroup),u.ui.PopupTool.super.call(this,t,e),u.ui.mixin.PopupElement.call(this,e),this.popup.connect(this,{toggle:"onPopupToggle"}),this.popup.setAutoFlip(!1),this.popup.setPosition("bottom"===t.getToolbar().position?"above":"below"),this.$element.addClass("oo-ui-popupTool"),this.popup.$element.addClass("oo-ui-popupTool-popup"),this.toolbar.$popups.append(this.popup.$element)},u.inheritClass(u.ui.PopupTool,u.ui.Tool),u.mixinClass(u.ui.PopupTool,u.ui.mixin.PopupElement),u.ui.PopupTool.prototype.onSelect=function(){return this.isDisabled()||this.popup.toggle(),!1},u.ui.PopupTool.prototype.onUpdateState=function(){},u.ui.PopupTool.prototype.onPopupToggle=function(t){this.setActive(t),this.toolGroup.emit("active",t)},u.ui.ToolGroupTool=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolGroup),u.ui.ToolGroupTool.super.call(this,t,e),this.innerToolGroup=this.createGroup(this.constructor.static.groupConfig),this.innerToolGroup.connect(this,{disable:"onToolGroupDisable",active:this.toolGroup.emit.bind(this.toolGroup,"active")}),this.$link.remove(),this.$element.addClass("oo-ui-toolGroupTool").append(this.innerToolGroup.$element)},u.inheritClass(u.ui.ToolGroupTool,u.ui.Tool),u.ui.ToolGroupTool.static.groupConfig={},u.ui.ToolGroupTool.prototype.onSelect=function(){return this.innerToolGroup.setActive(!this.innerToolGroup.active),!1},u.ui.ToolGroupTool.prototype.onToolGroupDisable=function(t){this.setDisabled(t)},u.ui.ToolGroupTool.prototype.onUpdateState=function(){this.setActive(!1)},u.ui.ToolGroupTool.prototype.createGroup=function(t){return"*"===t.include&&void 0===t.label&&(t.label=u.ui.msg("ooui-toolbar-more")),this.toolbar.getToolGroupFactory().create("list",this.toolbar,t)},u.ui.BarToolGroup=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolbar),u.ui.BarToolGroup.super.call(this,t,e),this.$element.addClass("oo-ui-barToolGroup"),this.$group.addClass("oo-ui-barToolGroup-tools")},u.inheritClass(u.ui.BarToolGroup,u.ui.ToolGroup),u.ui.BarToolGroup.static.titleTooltips=!0,u.ui.BarToolGroup.static.accelTooltips=!0,u.ui.BarToolGroup.static.name="bar",u.ui.PopupToolGroup=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolbar),e=Object.assign({indicator:void 0===e.indicator?"bottom"===t.position?"up":"down":e.indicator},e),u.ui.PopupToolGroup.super.call(this,t,e),this.active=!1,this.dragging=!1,this.onPopupDocumentMouseKeyUpHandler=this.onPopupDocumentMouseKeyUp.bind(this),this.$handle=$("<span>"),this.narrowConfig=e.narrowConfig||this.constructor.static.narrowConfig,u.ui.mixin.IconElement.call(this,e),u.ui.mixin.IndicatorElement.call(this,e),u.ui.mixin.LabelElement.call(this,e),u.ui.mixin.TitledElement.call(this,e),u.ui.mixin.FlaggedElement.call(this,e),u.ui.mixin.ClippableElement.call(this,Object.assign({$clippable:this.$group},e)),u.ui.mixin.FloatableElement.call(this,Object.assign({$floatable:this.$group,$floatableContainer:this.$handle,hideWhenOutOfView:!1,verticalPosition:"bottom"===this.toolbar.position?"above":"below"},e)),u.ui.mixin.TabIndexedElement.call(this,Object.assign({$tabIndexed:this.$handle},e)),this.$handle.on({keydown:this.onHandleMouseKeyDown.bind(this),keyup:this.onHandleMouseKeyUp.bind(this),mousedown:this.onHandleMouseKeyDown.bind(this),mouseup:this.onHandleMouseKeyUp.bind(this)}),this.toolbar.connect(this,{resize:"onToolbarResize"}),this.$handle.addClass("oo-ui-popupToolGroup-handle").attr({role:"button","aria-expanded":"false"}).append(this.$icon,this.$label,this.$indicator),void 0!==e.header&&this.$group.prepend($("<span>").addClass("oo-ui-popupToolGroup-header").text(e.header)),this.$element.addClass("oo-ui-popupToolGroup").prepend(this.$handle),this.$group.addClass("oo-ui-popupToolGroup-tools"),this.toolbar.$popups.append(this.$group)},u.inheritClass(u.ui.PopupToolGroup,u.ui.ToolGroup),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.IconElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.IndicatorElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.LabelElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.TitledElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.FlaggedElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.ClippableElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.FloatableElement),u.mixinClass(u.ui.PopupToolGroup,u.ui.mixin.TabIndexedElement),u.ui.PopupToolGroup.static.narrowConfig=null,u.ui.PopupToolGroup.prototype.setDisabled=function(){u.ui.PopupToolGroup.super.prototype.setDisabled.apply(this,arguments),this.isDisabled()&&this.isElementAttached()&&this.setActive(!1)},u.ui.PopupToolGroup.prototype.onToolbarResize=function(){this.narrowConfig&&(this.toolbar.isNarrow()?(void 0!==this.narrowConfig.invisibleLabel&&(this.wideInvisibleLabel=this.invisibleLabel,this.setInvisibleLabel(this.narrowConfig.invisibleLabel)),void 0!==this.narrowConfig.label&&(this.wideLabel=this.label,this.setLabel(this.narrowConfig.label)),void 0!==this.narrowConfig.icon&&(this.wideIcon=this.icon,this.setIcon(this.narrowConfig.icon))):(void 0!==this.wideInvisibleLabel&&this.setInvisibleLabel(this.wideInvisibleLabel),void 0!==this.wideLabel&&this.setLabel(this.wideLabel),void 0!==this.wideIcon&&this.setIcon(this.wideIcon)))},u.ui.PopupToolGroup.prototype.onPopupDocumentMouseKeyUp=function(t){t=$(t.target);t.closest(".oo-ui-popupToolGroup")[0]!==this.$element[0]&&t.closest(".oo-ui-popupToolGroup-tools")[0]!==this.$group[0]&&this.setActive(!1)},u.ui.PopupToolGroup.prototype.onMouseKeyUp=function(t){return this.isDisabled()||!this.pressed||this.pressed!==this.findTargetTool(t)||t.which!==u.ui.MouseButtons.LEFT&&t.which!==u.ui.Keys.SPACE&&t.which!==u.ui.Keys.ENTER||this.setActive(!1),u.ui.PopupToolGroup.super.prototype.onMouseKeyUp.call(this,t)},u.ui.PopupToolGroup.prototype.onMouseKeyDown=function(t){if(!this.isDisabled()&&t.which===u.ui.Keys.TAB){var e=$(document.activeElement),i=u.ui.findFocusable(this.$group);if(e[0]===i[0]&&t.shiftKey)return this.$handle.trigger("focus"),!1;i=u.ui.findFocusable(this.$group,!0);e[0]!==i[0]||t.shiftKey||(this.$handle.trigger("focus"),this.setActive(!1))}return u.ui.PopupToolGroup.super.prototype.onMouseKeyDown.call(this,t)},u.ui.PopupToolGroup.prototype.onHandleMouseKeyUp=function(t){if(!this.isDisabled()&&(t.which===u.ui.MouseButtons.LEFT||t.which===u.ui.Keys.SPACE||t.which===u.ui.Keys.ENTER))return!1},u.ui.PopupToolGroup.prototype.onHandleMouseKeyDown=function(t){var e;if(!this.isDisabled())return t.which===u.ui.Keys.TAB&&!t.shiftKey&&(e=u.ui.findFocusable(this.$group)).length?(e.trigger("focus"),!1):t.which===u.ui.MouseButtons.LEFT||t.which===u.ui.Keys.SPACE||t.which===u.ui.Keys.ENTER?(this.setActive(!this.active),!1):void 0},u.ui.PopupToolGroup.prototype.isActive=function(){return this.active},u.ui.PopupToolGroup.prototype.setActive=function(t){var e,i;this.active!==(t=!!t)&&((this.active=t)?(this.getElementDocument().addEventListener("mouseup",this.onPopupDocumentMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onPopupDocumentMouseKeyUpHandler,!0),this.$clippable.css({left:"",width:"","margin-left":"","min-width":""}),this.$element.addClass("oo-ui-popupToolGroup-active"),this.$group.addClass("oo-ui-popupToolGroup-active-tools"),this.$handle.attr("aria-expanded",!0),this.togglePositioning(!0),this.toggleClipping(!0),t="before"===this.align?"start":"end",i="before"===this.align?"end":"start",this.setHorizontalPosition(t),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.setHorizontalPosition(i),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.setHorizontalPosition("center"),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&(e=(i=this.$clippableScrollableContainer[0]===document.documentElement)?document.documentElement.clientWidth:this.$clippableScrollableContainer.width(),i=i?0:this.$clippableScrollableContainer.offset().left,this.toggleClipping(!1),this.setHorizontalPosition(t),this.$clippable.css({"margin-left":-(this.$element.offset().left-i),width:e,"min-width":e}))):(this.getElementDocument().removeEventListener("mouseup",this.onPopupDocumentMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onPopupDocumentMouseKeyUpHandler,!0),this.$element.removeClass("oo-ui-popupToolGroup-active"),this.$group.removeClass("oo-ui-popupToolGroup-active-tools"),this.$handle.attr("aria-expanded",!1),this.togglePositioning(!1),this.toggleClipping(!1)),this.emit("active",this.active),this.updateThemeClasses())},u.ui.ListToolGroup=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolbar),this.allowCollapse=(e=e||{}).allowCollapse,this.forceExpand=e.forceExpand,this.expanded=!!e.expanded,this.collapsibleTools=[],u.ui.ListToolGroup.super.call(this,t,e),this.$element.addClass("oo-ui-listToolGroup"),this.$group.addClass("oo-ui-listToolGroup-tools")},u.inheritClass(u.ui.ListToolGroup,u.ui.PopupToolGroup),u.ui.ListToolGroup.static.name="list",u.ui.ListToolGroup.prototype.populate=function(){u.ui.ListToolGroup.super.prototype.populate.call(this);let i=[];void 0!==this.allowCollapse?i=this.allowCollapse:void 0!==this.forceExpand&&(i=u.simpleArrayDifference(Object.keys(this.tools),this.forceExpand)),this.collapsibleTools=[];for(let t=0,e=i.length;t<e;t++)void 0!==this.tools[i[t]]&&this.collapsibleTools.push(this.tools[i[t]]);this.$group.append(this.getExpandCollapseTool().$element),this.getExpandCollapseTool().toggle(0!==this.collapsibleTools.length),this.updateCollapsibleState()},u.ui.ListToolGroup.prototype.getExpandCollapseTool=function(){if(void 0===this.expandCollapseTool){const t=function(){t.super.apply(this,arguments)};u.inheritClass(t,u.ui.Tool),t.prototype.onSelect=function(){this.toolGroup.expanded=!this.toolGroup.expanded,this.toolGroup.updateCollapsibleState(),this.setActive(!1)},t.prototype.onUpdateState=function(){},t.static.name="more-fewer",this.expandCollapseTool=new t(this)}return this.expandCollapseTool},u.ui.ListToolGroup.prototype.onMouseKeyUp=function(t){return(!$(t.target).closest(".oo-ui-tool-name-more-fewer").length||t.which!==u.ui.MouseButtons.LEFT&&t.which!==u.ui.Keys.SPACE&&t.which!==u.ui.Keys.ENTER?u.ui.ListToolGroup:u.ui.ListToolGroup.super).super.prototype.onMouseKeyUp.call(this,t)},u.ui.ListToolGroup.prototype.updateCollapsibleState=function(){var t="bottom"===this.toolbar.position,t=this.expanded===t?"expand":"collapse";this.getExpandCollapseTool().setIcon(t).setTitle(u.ui.msg(this.expanded?"ooui-toolgroup-collapse":"ooui-toolgroup-expand"));for(let t=0;t<this.collapsibleTools.length;t++)this.collapsibleTools[t].toggle(this.expanded);this.clip()},u.ui.MenuToolGroup=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).toolbar),u.ui.MenuToolGroup.super.call(this,t,e=e||{}),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$element.addClass("oo-ui-menuToolGroup"),this.$group.addClass("oo-ui-menuToolGroup-tools")},u.inheritClass(u.ui.MenuToolGroup,u.ui.PopupToolGroup),u.ui.MenuToolGroup.static.name="menu",u.ui.MenuToolGroup.prototype.onUpdateState=function(){var t=[];for(const e in this.tools)this.tools[e].isActive()&&t.push(this.tools[e].getTitle());this.setLabel(t.join(", ")||" ")}}(OO),function(u){"use strict";u.ui.ActionWidget=function(t){t=Object.assign({framed:!1},t),u.ui.ActionWidget.super.call(this,t),u.ui.mixin.PendingElement.call(this,t),this.action=t.action||"",this.modes=t.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},u.inheritClass(u.ui.ActionWidget,u.ui.ButtonWidget),u.mixinClass(u.ui.ActionWidget,u.ui.mixin.PendingElement),u.ui.ActionWidget.prototype.hasMode=function(t){return-1!==this.modes.indexOf(t)},u.ui.ActionWidget.prototype.getAction=function(){return this.action},u.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},u.ui.ActionSet=function(t){u.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},u.mixinClass(u.ui.ActionSet,u.EventEmitter),u.ui.ActionSet.static.specialFlags=["safe","primary"],u.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},u.ui.ActionSet.prototype.isSpecial=function(t){for(const e in this.special)if(t===this.special[e])return!0;return!1},u.ui.ActionSet.prototype.get=function(n){if(n){this.organize();let e,i;var s=[];for(const u in this.categorized){let t=n[u];if(t)for(Array.isArray(t)||(t=[t]),e=0,i=t.length;e<i;e++){var l=this.categorized[u][t[e]];Array.isArray(l)&&s.push.apply(s,l)}}let o;for(e=0,i=s.length;e<i;e++)o=s[e],(void 0!==n.visible&&o.isVisible()!==n.visible||void 0!==n.disabled&&o.isDisabled()!==n.disabled)&&(s.splice(e,1),i--,e--);for(e=0,i=s.length;e<i;e++){o=s[e];let t=s.lastIndexOf(o);for(;t!==e;)s.splice(t,1),i--,t=s.lastIndexOf(o)}return s}return this.list.slice()},u.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),Object.assign({},this.special)},u.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},u.ui.ActionSet.prototype.setMode=function(i){this.changing=!0;for(let t=0,e=this.list.length;t<e;t++){var o=this.list[t];o.toggle(o.hasMode(i))}return this.organized=!1,this.changing=!1,this.emit("change"),this},u.ui.ActionSet.prototype.setAbilities=function(i){for(let t=0,e=this.list.length;t<e;t++){var o=this.list[t],n=o.getAction();void 0!==i[n]&&o.setDisabled(!i[n])}return this},u.ui.ActionSet.prototype.forEach=function(t,e){return this.changed=!1,this.changing=!0,this.get(t).forEach(e),this.changing=!1,this.changed&&this.emit("change"),this},u.ui.ActionSet.prototype.add=function(i){this.changing=!0;for(let t=0,e=i.length;t<e;t++){var o=i[t];o.connect(this,{click:["emit","click",o],toggle:["onActionChange"]}),this.list.push(o)}return this.organized=!1,this.emit("add",i),this.changing=!1,this.emit("change"),this},u.ui.ActionSet.prototype.remove=function(i){this.changing=!0;for(let t=0,e=i.length;t<e;t++){var o=i[t],n=this.list.indexOf(o);-1!==n&&(o.disconnect(this),this.list.splice(n,1))}return this.organized=!1,this.emit("remove",i),this.changing=!1,this.emit("change"),this},u.ui.ActionSet.prototype.clear=function(){var t=this.list.slice();this.changing=!0;for(let t=0,e=this.list.length;t<e;t++)this.list[t].disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",t),this.changing=!1,this.emit("change"),this},u.ui.ActionSet.prototype.organize=function(){var o=this.constructor.static.specialFlags;if(!this.organized){this.categorized={},this.special={},this.others=[];for(let t=0,e=this.list.length;t<e;t++){var n=this.list[t];let e,i;for(const u in this.categories){this.categorized[u]||(this.categorized[u]={});let t=n[this.categories[u]]();for(Array.isArray(t)||(t=[t]),e=0,i=t.length;e<i;e++){var s=t[e];this.categorized[u][s]||(this.categorized[u][s]=[]),this.categorized[u][s].push(n)}}if(n.isVisible()){let t=!1;for(e=0,i=o.length;e<i;e++){var l=o[e];if(!this.special[l]&&n.hasFlag(l)){this.special[l]=n,t=!0;break}}t||this.others.push(n)}}this.organized=!0}return this},u.ui.Error=function(t,e){u.isPlainObject(t)&&void 0===e&&(t=(e=t).message),e=e||{},this.message=t instanceof $?t:String(t),this.recoverable=void 0===e.recoverable||!!e.recoverable,this.warning=!!e.warning},u.initClass(u.ui.Error),u.ui.Error.prototype.isRecoverable=function(){return this.recoverable},u.ui.Error.prototype.isWarning=function(){return this.warning},u.ui.Error.prototype.getMessage=function(){return this.message instanceof $?this.message.clone():$("<div>").text(this.message).contents()},u.ui.Error.prototype.getMessageText=function(){return this.message instanceof $?this.message.text():this.message},u.ui.Process=function(t,e){this.steps=[],void 0!==t&&this.next(t,e)},u.initClass(u.ui.Process),u.ui.Process.prototype.execute=function(){function i(i){return function(){var t=i.callback.call(i.context);if(!1===t)return $.Deferred().reject([]).promise();if("number"!=typeof t)return(t instanceof u.ui.Error?$.Deferred().reject([t]):Array.isArray(t)&&t.length&&t[0]instanceof u.ui.Error?$.Deferred().reject(t):t&&"function"==typeof t.then?$.when(t):$.Deferred().resolve()).promise();if(t<0)throw new Error("Cannot go back in time: flux capacitor is out of service");var e=$.Deferred();return setTimeout(e.resolve,t),e.promise()}}let o;if(this.steps.length){o=i(this.steps[0])();for(let t=1,e=this.steps.length;t<e;t++)o=o.then(i(this.steps[t]))}else o=$.Deferred().resolve().promise();return o},u.ui.Process.prototype.createStep=function(t,e){if("number"==typeof t||"function"==typeof t.then)return{callback:function(){return t},context:null};if("function"==typeof t)return{callback:t,context:e};throw new Error("Cannot create process step: number, promise or function expected")},u.ui.Process.prototype.first=function(t,e){return this.steps.unshift(this.createStep(t,e)),this},u.ui.Process.prototype.next=function(t,e){return this.steps.push(this.createStep(t,e)),this},u.ui.WindowInstance=function(){const t={opening:$.Deferred(),opened:$.Deferred(),closing:$.Deferred(),closed:$.Deferred()};this.deferreds=t,this.opening=t.opening.promise(),this.opened=this.opening.then(()=>t.opened),this.closing=this.opened.then(()=>t.closing),this.closed=this.closing.then(()=>t.closed)},u.initClass(u.ui.WindowInstance),u.ui.WindowInstance.prototype.isOpening=function(){return"pending"===this.deferreds.opened.state()},u.ui.WindowInstance.prototype.isOpened=function(){return"resolved"===this.deferreds.opened.state()&&"pending"===this.deferreds.closing.state()},u.ui.WindowInstance.prototype.isClosing=function(){return"resolved"===this.deferreds.closing.state()&&"pending"===this.deferreds.closed.state()},u.ui.WindowInstance.prototype.isClosed=function(){return"resolved"===this.deferreds.closed.state()},u.ui.WindowManager=function(t){u.ui.WindowManager.super.call(this,t=t||{}),u.EventEmitter.call(this),this.factory=t.factory,this.modal=void 0===t.modal||!!t.modal,this.windows={},this.compatOpened=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.lastSize=null,this.globalEvents=!1,this.$returnFocusTo=null,this.isolated=!1,this.$ariaHidden=null,this.$inert=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.onWindowFocusHandler=this.onWindowFocus.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.isModal()).toggleClass("oo-ui-windowManager-forceTrapFocus",!!t.forceTrapFocus),this.isModal()&&this.$element.attr("aria-hidden","true").attr("inert","")},u.inheritClass(u.ui.WindowManager,u.ui.Element),u.mixinClass(u.ui.WindowManager,u.EventEmitter),u.ui.WindowManager.static.sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},u.ui.WindowManager.static.defaultSize="medium",u.ui.WindowManager.prototype.isModal=function(){return this.modal},u.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)},u.ui.WindowManager.prototype.onWindowFocus=function(){var t=this.getCurrentWindow();t&&!u.ui.contains(t.$element[0],document.activeElement)&&t.focus()},u.ui.WindowManager.prototype.afterWindowResize=function(){var t=document.activeElement;this.currentWindow&&(this.updateWindowSize(this.currentWindow),t!==document.activeElement)&&t.focus()},u.ui.WindowManager.prototype.isOpening=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpening()},u.ui.WindowManager.prototype.isClosing=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isClosing()},u.ui.WindowManager.prototype.isOpened=function(t){return t===this.currentWindow&&!!this.lifecycle&&this.lifecycle.isOpened()},u.ui.WindowManager.prototype.hasWindow=function(t){for(const e in this.windows)if(this.windows[e]===t)return!0;return!1},u.ui.WindowManager.prototype.getSetupDelay=function(){return 0},u.ui.WindowManager.prototype.getReadyDelay=function(){return this.isModal()?u.ui.theme.getDialogTransitionDuration():0},u.ui.WindowManager.prototype.getHoldDelay=function(){return 0},u.ui.WindowManager.prototype.getTeardownDelay=function(){return this.isModal()?u.ui.theme.getDialogTransitionDuration():0},u.ui.WindowManager.prototype.getWindow=function(t){var e=$.Deferred();let i=this.windows[t];return i instanceof u.ui.Window?e.resolve(i):this.factory?this.factory.lookup(t)?(i=this.factory.create(t),this.addWindows([i]),e.resolve(i)):e.reject(new u.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):e.reject(new u.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),e.promise()},u.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},u.ui.WindowManager.prototype.openWindow=function(e,i,o,n){if(i=i||{},o=o||new u.ui.WindowInstance,n=n||$.Deferred(),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(t=>{o[t]=function(){return u.ui.warnDeprecation("Using the return value of openWindow as a promise is deprecated. Use .openWindow( ... ).opening."+t+"( ... ) instead."),n[t].apply(this,arguments)}}),"string"==typeof e)this.getWindow(e).then(t=>{this.openWindow(t,i,o,n)},t=>{o.deferreds.opening.reject(t)});else{let t;this.hasWindow(e)?this.lifecycle&&this.lifecycle.isOpened()?t="Cannot open window: another window is open":(this.preparingToOpen||this.lifecycle&&this.lifecycle.isOpening())&&(t="Cannot open window: another window is opening"):t="Cannot open window: window is not attached to manager",t?(n.reject(new u.ui.Error(t)),o.deferreds.opening.reject(new u.ui.Error(t))):(this.preparingToOpen=$.when(this.lifecycle&&this.lifecycle.closed),this.preparingToOpen.done(()=>{this.isModal()&&(this.toggleGlobalEvents(!0,e),this.toggleIsolation(!0)),this.$returnFocusTo=void 0!==i.$returnFocusTo?i.$returnFocusTo:$(document.activeElement),this.currentWindow=e,this.lifecycle=o,this.preparingToOpen=null,this.emit("opening",e,n,i),o.deferreds.opening.resolve(i),setTimeout(()=>{this.compatOpened=$.Deferred(),e.setup(i).then(()=>{n.notify({state:"setup"}),setTimeout(()=>{e.ready(i).then(()=>{n.notify({state:"ready"}),o.deferreds.opened.resolve(i),n.resolve(this.compatOpened.promise(),i),this.togglePreventIosScrolling(!0)},t=>{o.deferreds.opened.reject(),n.reject(),this.closeWindow(e),t instanceof Error&&setTimeout(()=>{throw t})})},this.getReadyDelay())},t=>{o.deferreds.opened.reject(),n.reject(),this.closeWindow(e),t instanceof Error&&setTimeout(()=>{throw t})})},this.getSetupDelay())}))}return o},u.ui.WindowManager.prototype.closeWindow=function(e,i){const o=$.Deferred();let n=this.lifecycle;"string"==typeof e?e=this.windows[e]:this.hasWindow(e)||(e=null);let t;return n?e?e!==this.currentWindow||this.lifecycle.isClosed()?t="Cannot close window: window already closed with different data":(this.preparingToClose||this.lifecycle.isClosing())&&(t="Cannot close window: window already closing with different data"):t="Cannot close window: window is not attached to manager":t="Cannot close window: no window is currently open",t&&((n=new u.ui.WindowInstance).deferreds.opening.resolve({}),n.deferreds.opened.resolve({})),["state","always","catch","pipe","then","promise","progress","done","fail"].forEach(t=>{n[t]=function(){return u.ui.warnDeprecation("Using the return value of closeWindow as a promise is deprecated. Use .closeWindow( ... ).closed."+t+"( ... ) instead."),o[t].apply(this,arguments)}}),t?(o.reject(new u.ui.Error(t)),n.deferreds.closing.reject(new u.ui.Error(t))):(this.preparingToClose=$.when(this.lifecycle.opened),this.preparingToClose.always(()=>{this.preparingToClose=null,this.emit("closing",e,o,i),n.deferreds.closing.resolve(i);var t=this.compatOpened;this.compatOpened=null,t.resolve(o.promise(),i),this.togglePreventIosScrolling(!1),setTimeout(()=>{e.hold(i).then(()=>{o.notify({state:"hold"}),setTimeout(()=>{e.teardown(i).then(()=>{o.notify({state:"teardown"}),this.isModal()&&(this.toggleGlobalEvents(!1),this.toggleIsolation(!1)),this.$returnFocusTo&&this.$returnFocusTo.length&&this.$returnFocusTo[0].focus(),this.currentWindow=null,this.lifecycle=null,n.deferreds.closed.resolve(i),o.resolve(i)})},this.getTeardownDelay())})},this.getHoldDelay())})),n},u.ui.WindowManager.prototype.addWindows=function(i){let o;if(Array.isArray(i)){o={};for(let t=0,e=i.length;t<e;t++){var n=i[t].constructor.static.name;if(!n)throw new Error("Windows must have a `name` static property defined.");o[n]=i[t]}}else u.isPlainObject(i)&&(o=i);for(const e in o){var t=o[e];this.windows[e]=t.toggle(!1),this.$element.append(t.$element),t.setManager(this)}},u.ui.WindowManager.prototype.removeWindows=function(t){const i=(t,e)=>{delete this.windows[t],e.$element.detach()};t=t.map(t=>{var e=this.windows[t];if(e)return e=i.bind(null,t,e),this.closeWindow(t).closed.then(e,e);throw new Error("Cannot remove window")});return $.when.apply($,t)},u.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},u.ui.WindowManager.prototype.updateWindowSize=function(t){var e,i;if(t===this.currentWindow)return e=t.getSize(),this.$element.removeClass("oo-ui-windowManager-size-"+this.lastSize).addClass("oo-ui-windowManager-size-"+e),e="full"===(this.lastSize=e),this.$element.toggleClass("oo-ui-windowManager-fullscreen",e),this.$element.toggleClass("oo-ui-windowManager-floating",!e),i=(e=$(this.getElementDocument().body)).data("windowManagerGlobalEvents")||[],e.add(e.parent()).toggleClass("oo-ui-windowManager-modal-active-fullscreen",i.some(t=>"full"===t.getSize())),t.setDimensions(t.getSizeProperties()),this.emit("resize",t),this},u.ui.WindowManager.prototype.togglePreventIosScrolling=function(t){var e=/ipad|iphone|ipod/i.test(navigator.userAgent),i=$(this.getElementDocument().body),o=(i.data("windowManagerGlobalEvents")||[]).length;return e&&1===o&&(e=u.ui.Element.static.getRootScrollableElement(i[0]),t?(this.iosOrigScrollPosition=e.scrollTop,"full"===this.getCurrentWindow().getSize()&&i.add(i.parent()).addClass("oo-ui-windowManager-ios-modal-ready")):(i.add(i.parent()).removeClass("oo-ui-windowManager-ios-modal-ready"),"full"===this.getCurrentWindow().getSize()&&(e.scrollTop=this.iosOrigScrollPosition))),this},u.ui.WindowManager.prototype.toggleGlobalEvents=function(t,e){var i=$(this.getElementDocument().body),o=$(this.getElementWindow()),n=i.data("windowManagerGlobalEvents")||[],s=(t=void 0===t?!!this.globalEvents:!!t,i.add(i.parent()));return t?this.globalEvents||(o.on({"orientationchange resize":this.onWindowResizeHandler,focus:this.onWindowFocusHandler}),n.push(e),this.globalEvents=!0):this.globalEvents&&(o.off({"orientationchange resize":this.onWindowResizeHandler,focus:this.onWindowFocusHandler}),n.pop(),this.globalEvents=!1),s.toggleClass("oo-ui-windowManager-modal-active",0<n.length),0===n.length&&s.removeClass("oo-ui-windowManager-modal-active-fullscreen"),i.data("windowManagerGlobalEvents",n),this},u.ui.WindowManager.prototype.toggleIsolation=function(t){if(this.isolated=void 0===t?!this.isolated:!!t,this.isolated){this.$element.removeAttr("aria-hidden").removeAttr("inert");let t=this.$element;for(var e=[],i=[];!t.is("body")&&t.length;){var o=t.siblings().not("script");t.removeAttr("aria-hidden").removeAttr("inert"),e.push.apply(e,o.not("[aria-hidden=true]").toArray()),i.push.apply(i,o.not("[inert]").toArray()),t=t.parent()}this.$ariaHidden=$(e),this.$inert=$(i),this.$ariaHidden.attr("aria-hidden","true"),this.$inert.attr("inert","")}else this.$ariaHidden.removeAttr("aria-hidden"),this.$inert.removeAttr("inert"),this.$ariaHidden=null,this.$inert=null,this.$element.attr("aria-hidden","true").attr("inert","");return this},u.ui.WindowManager.prototype.destroy=function(){this.clearWindows(),this.$element.remove()},u.ui.Window=function(t){u.ui.Window.super.call(this,t=t||{}),u.EventEmitter.call(this),this.manager=null,this.size=t.size||this.constructor.static.size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$focusTrapBefore=$("<div>").addClass("oo-ui-window-focusTrap").prop("tabIndex",0),this.$focusTrapAfter=this.$focusTrapBefore.clone(),this.$focusTraps=this.$focusTrapBefore.add(this.$focusTrapAfter),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabindex",-1),this.$frame.addClass("oo-ui-window-frame").append(this.$focusTrapBefore,this.$content,this.$focusTrapAfter),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},u.inheritClass(u.ui.Window,u.ui.Element),u.mixinClass(u.ui.Window,u.EventEmitter),u.ui.Window.static.size="medium",u.ui.Window.prototype.onMouseDown=function(t){if(t.target===this.$element[0])return!1},u.ui.Window.prototype.isInitialized=function(){return!!this.manager},u.ui.Window.prototype.isVisible=function(){return this.visible},u.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},u.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},u.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},u.ui.Window.prototype.getManager=function(){return this.manager},u.ui.Window.prototype.getSize=function(){var t=u.ui.Element.static.getDimensions(this.getElementWindow()),e=this.manager.constructor.static.sizes;let i=this.size;return i="full"!==(i=e[i]?i:this.manager.constructor.static.defaultSize)&&t.rect.right-t.rect.left<e[i].width?"full":i},u.ui.Window.prototype.getSizeProperties=function(){return this.manager.constructor.static.sizes[this.getSize()]},u.ui.Window.prototype.withoutSizeTransitions=function(t){var e=this.$frame.css("transition-property")+" "+this.$frame.css("transition-duration")+" "+this.$frame.css("transition-timing-function")+" "+this.$frame.css("transition-delay");this.$frame.css("transition","none"),t(),this.$frame.height(),this.$frame.css("transition",e)},u.ui.Window.prototype.getContentHeight=function(){const o=this.$body[0],n=this.$frame[0];let s;return this.withoutSizeTransitions(()=>{var t=n.style.height,e=o.style.position,i=o.scrollTop;n.style.height="1px",o.style.position="relative",s=this.getBodyHeight(),n.style.height=t,o.style.position=e,o.scrollTop=i}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+s+this.$foot.outerHeight(!0))},u.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},u.ui.Window.prototype.getDir=function(){return u.ui.Element.static.getDir(this.$content)||"ltr"},u.ui.Window.prototype.getSetupProcess=function(){return new u.ui.Process},u.ui.Window.prototype.getReadyProcess=function(){return new u.ui.Process},u.ui.Window.prototype.getHoldProcess=function(){return new u.ui.Process},u.ui.Window.prototype.getTeardownProcess=function(){return new u.ui.Process},u.ui.Window.prototype.setManager=function(t){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=t,this.initialize(),this},u.ui.Window.prototype.setSize=function(t){return this.size=t,this.updateSize(),this},u.ui.Window.prototype.updateSize=function(){if(this.manager)return this.manager.updateWindowSize(this),this;throw new Error("Cannot update window size, must be attached to a manager")},u.ui.Window.prototype.setDimensions=function(e){const i=this.$frame[0].style;let o;return void 0===e.height?this.withoutSizeTransitions(()=>{var t=i.width;this.$frame.css("width",e.width||""),o=this.getContentHeight(),i.width=t}):o=e.height,this.$frame.css({width:e.width||"",minWidth:e.minWidth||"",maxWidth:e.maxWidth||"",height:o||"",minHeight:e.minHeight||"",maxHeight:e.maxHeight||""}),this},u.ui.Window.prototype.initialize=function(){if(this.manager)return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$focusTraps.on("focus",this.onFocusTrapFocused.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$content.append(this.$head,this.$body,this.$foot),this;throw new Error("Cannot initialize window, must be attached to a manager")},u.ui.Window.prototype.onFocusTrapFocused=function(t){t=this.$focusTrapBefore.is(t.target);this.focus(t)},u.ui.Window.prototype.focus=function(t){t=u.ui.findFocusable(this.$content,!!t);return t?t.focus():this.$content.trigger("focus"),this},u.ui.Window.prototype.open=function(t){if(this.manager)return this.manager.openWindow(this,t);throw new Error("Cannot open window, must be attached to a manager")},u.ui.Window.prototype.close=function(t){if(this.manager)return this.manager.closeWindow(this,t);throw new Error("Cannot close window, must be attached to a manager")},u.ui.Window.prototype.setup=function(t){return this.toggle(!0),this.getSetupProcess(t).execute().then(()=>{this.updateSize(),this.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),this.$content.addClass("oo-ui-window-content-setup").width()})},u.ui.Window.prototype.ready=function(t){return this.$content.trigger("focus"),this.getReadyProcess(t).execute().then(()=>{this.$element.addClass("oo-ui-window-ready").width(),this.$content.addClass("oo-ui-window-content-ready").width()})},u.ui.Window.prototype.hold=function(t){return this.getHoldProcess(t).execute().then(()=>{var t=this.$content.find(u.ui.Element.static.getDocument(this.$content).activeElement);t.length&&t[0].blur(),this.$element.removeClass("oo-ui-window-ready oo-ui-window-setup").width(),this.$content.removeClass("oo-ui-window-content-ready oo-ui-window-content-setup").width()})},u.ui.Window.prototype.teardown=function(t){return this.getTeardownProcess(t).execute().then(()=>{this.$element.removeClass("oo-ui-window-active").width(),this.toggle(!1)})},u.ui.Dialog=function(t){u.ui.Dialog.super.call(this,t),u.ui.mixin.PendingElement.call(this),this.actions=new u.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDialogKeyDownHandler=this.onDialogKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},u.inheritClass(u.ui.Dialog,u.ui.Window),u.mixinClass(u.ui.Dialog,u.ui.mixin.PendingElement),u.ui.Dialog.static.name="",u.ui.Dialog.static.title="",u.ui.Dialog.static.actions=[],u.ui.Dialog.static.escapable=!0,u.ui.Dialog.prototype.getEscapeAction=function(){return""},u.ui.Dialog.prototype.onDialogKeyDown=function(t){var e;t.which===u.ui.Keys.ESCAPE&&this.constructor.static.escapable?null!==(e=this.getEscapeAction())&&(this.executeAction(e),t.preventDefault(),t.stopPropagation()):t.which===u.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)&&0<(e=this.actions.get({flags:"primary",visible:!0,disabled:!1})).length&&(this.executeAction(e[0].getAction()),t.preventDefault(),t.stopPropagation())},u.ui.Dialog.prototype.onActionClick=function(t){this.isPending()||this.executeAction(t.getAction())},u.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||(this.attachActions(),this.isOpening())||this.updateSize()},u.ui.Dialog.prototype.getActions=function(){return this.actions},u.ui.Dialog.prototype.getActionProcess=function(t){return(new u.ui.Process).next(()=>{t||this.close()})},u.ui.Dialog.prototype.getSetupProcess=function(i){return i=i||{},u.ui.Dialog.super.prototype.getSetupProcess.call(this,i).next(()=>{var t=this.constructor.static,e=(void 0!==i.actions?i:t).actions,t=(void 0!==i.title?i:t).title;this.title.setLabel(t),this.actions.add(this.getActionWidgets(e)),this.$element.on("keydown",this.onDialogKeyDownHandler)})},u.ui.Dialog.prototype.getTeardownProcess=function(t){return u.ui.Dialog.super.prototype.getTeardownProcess.call(this,t).first(()=>{this.$element.off("keydown",this.onDialogKeyDownHandler),this.actions.clear(),this.currentAction=null})},u.ui.Dialog.prototype.initialize=function(){u.ui.Dialog.super.prototype.initialize.call(this),this.title=new u.ui.LabelWidget,this.$content.addClass("oo-ui-dialog-content"),this.$element.attr("aria-labelledby",this.title.getElementId()),this.setPendingElement(this.$head)},u.ui.Dialog.prototype.getActionWidgets=function(i){var o=[];for(let t=0,e=i.length;t<e;t++)o.push(this.getActionWidget(i[t]));return o},u.ui.Dialog.prototype.getActionWidget=function(t){return new u.ui.ActionWidget(this.getActionWidgetConfig(t))},u.ui.Dialog.prototype.getActionWidgetConfig=function(t){return t},u.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},u.ui.Dialog.prototype.detachActions=function(){for(let t=0,e=this.attachedActions.length;t<e;t++)this.attachedActions[t].$element.detach();return this.attachedActions=[],this},u.ui.Dialog.prototype.executeAction=function(t){var e=this.actions.get({actions:[t],visible:!0});return e.length&&e.every(t=>t.isDisabled())?$.Deferred().reject().promise():(this.pushPending(),this.currentAction=t,this.getActionProcess(t).execute().always(this.popPending.bind(this)))},u.ui.MessageDialog=function(t){u.ui.MessageDialog.super.call(this,t),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},u.inheritClass(u.ui.MessageDialog,u.ui.Dialog),u.ui.MessageDialog.static.name="message",u.ui.MessageDialog.static.size="small",u.ui.MessageDialog.static.title=null,u.ui.MessageDialog.static.message=null,u.ui.MessageDialog.static.actions=[{action:"accept",label:u.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:u.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],u.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(t){return(t=void 0===t?!this.verticalActionLayout:!!t)!==this.verticalActionLayout&&(this.verticalActionLayout=t,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",t).toggleClass("oo-ui-messageDialog-actions-horizontal",!t)),this},u.ui.MessageDialog.prototype.getActionProcess=function(t){return t?new u.ui.Process(()=>{this.close({action:t})}):u.ui.MessageDialog.super.prototype.getActionProcess.call(this,t)},u.ui.MessageDialog.prototype.getSetupProcess=function(t){return t=t||{},u.ui.MessageDialog.super.prototype.getSetupProcess.call(this,t).next(()=>{this.title.setLabel((void 0!==t.title?t:this.constructor.static).title),this.message.setLabel((void 0!==t.message?t:this.constructor.static).message),this.size=(void 0!==t.size?t:this.constructor.static).size})},u.ui.MessageDialog.prototype.getReadyProcess=function(t){return u.ui.MessageDialog.super.prototype.getReadyProcess.call(this,t=t||{}).next(()=>{let t=this.actions.get();0<(t=t.filter(t=>-1<t.getFlags().indexOf("primary"))).length&&t[0].focus()})},u.ui.MessageDialog.prototype.getBodyHeight=function(){var t=this.container.$element,e=t[0].style.overflow,i=(t[0].style.overflow="hidden",u.ui.Element.static.reconsiderScrollbars(t[0]),this.text.$element.outerHeight(!0));return t[0].style.overflow=e,i},u.ui.MessageDialog.prototype.setDimensions=function(t){const i=this.container.$element;return u.ui.MessageDialog.super.prototype.setDimensions.call(this,t),setTimeout(()=>{var t=i[0].style.overflow,e=document.activeElement;i[0].style.overflow="hidden",u.ui.Element.static.reconsiderScrollbars(i[0]),e&&e!==document.activeElement&&e.focus&&e.focus(),i[0].style.overflow=t},300),this.fitActions(),setTimeout(()=>{this.fitActions()},300),this},u.ui.MessageDialog.prototype.initialize=function(){u.ui.MessageDialog.super.prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new u.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new u.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new u.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},u.ui.MessageDialog.prototype.getActionWidgetConfig=function(t){return Object.assign({},t,{framed:!1})},u.ui.MessageDialog.prototype.attachActions=function(){u.ui.MessageDialog.super.prototype.attachActions.call(this);var t=this.actions.getSpecial(),i=this.actions.getOthers();t.safe&&(this.$actions.append(t.safe.$element),t.safe.toggleFramed(!0));for(let t=0,e=i.length;t<e;t++)this.$actions.append(i[t].$element),i[t].toggleFramed(!0);t.primary&&(this.$actions.append(t.primary.$element),t.primary.toggleFramed(!0))},u.ui.MessageDialog.prototype.fitActions=function(){var t=this.verticalActionLayout;this.toggleVerticalActionLayout(!1),this.$actions[0].scrollWidth>this.$actions[0].clientWidth&&this.toggleVerticalActionLayout(!0),this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==t&&this.updateSize()},u.ui.ProcessDialog=function(t){u.ui.ProcessDialog.super.call(this,t),this.fitOnOpen=!1,this.$element.addClass("oo-ui-processDialog"),u.ui.isMobile()&&this.$element.addClass("oo-ui-isMobile")},u.inheritClass(u.ui.ProcessDialog,u.ui.Dialog),u.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},u.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction)},u.ui.ProcessDialog.prototype.initialize=function(){u.ui.ProcessDialog.super.prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new u.ui.ButtonWidget({label:u.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new u.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.connect(this,{labelChange:"fitLabel"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(u.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors oo-ui-element-hidden").append(this.$errorsTitle,$("<div>").addClass("oo-ui-processDialog-errors-actions").append(this.dismissButton.$element,this.retryButton.$element)),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$primaryActions,this.$location,this.$safeActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},u.ui.ProcessDialog.prototype.getActionWidgetConfig=function(e){function t(t){return e.flags===t||Array.isArray(e.flags)&&-1!==e.flags.indexOf(t)}return e=Object.assign({framed:!0},e),t("close")?Object.assign(e,{icon:"close",invisibleLabel:!0}):t("back")&&Object.assign(e,{icon:"previous",invisibleLabel:!0}),e},u.ui.ProcessDialog.prototype.attachActions=function(){u.ui.ProcessDialog.super.prototype.attachActions.call(this);var t=this.actions.getSpecial(),i=this.actions.getOthers();t.primary&&this.$primaryActions.append(t.primary.$element);for(let t=0,e=i.length;t<e;t++){var o=i[t];this.$otherActions.append(o.$element)}t.safe&&this.$safeActions.append(t.safe.$element)},u.ui.ProcessDialog.prototype.executeAction=function(t){return u.ui.ProcessDialog.super.prototype.executeAction.call(this,t).fail(t=>{this.showErrors(t||[])})},u.ui.ProcessDialog.prototype.setDimensions=function(){u.ui.ProcessDialog.super.prototype.setDimensions.apply(this,arguments),this.fitLabel(),this.$body.css("bottom",this.$foot.outerHeight(!0)),setTimeout(()=>{this.$body.css("bottom",this.$foot.outerHeight(!0))},300)},u.ui.ProcessDialog.prototype.fitLabel=function(){var t=this.getSizeProperties();let e;if("number"!=typeof t.width){if(!this.isOpened())return this.isOpening()?void(this.fitOnOpen||(this.manager.lifecycle.opened.done(this.fitLabel.bind(this)),this.fitOnOpen=!0)):void 0;e=this.$head.width()-20}else e=t.width-20;var t=this.$safeActions.width(),i=this.$primaryActions.width(),o=Math.max(t,i),n=this.title.$element.width();let s,l;return!u.ui.isMobile()&&2*o+n<e?s=l=o:l="ltr"===this.getDir()?(s=t,i):(s=i,t),this.$location.css({paddingLeft:s,paddingRight:l}),this},u.ui.ProcessDialog.prototype.showErrors=function(i){var t,o=[],e={};let n=!0,s=!1;for(let t=0,e=(i=i instanceof u.ui.Error?[i]:i).length;t<e;t++)i[t].isRecoverable()||(n=!1),i[t].isWarning()&&(s=!0),o.push(new u.ui.MessageWidget({type:"error",label:i[t].getMessage()}).$element[0]);this.$errorItems=$(o),n?(e[this.currentAction]=!0,(t=this.actions.get({actions:this.currentAction})).length&&this.retryButton.clearFlags().setFlags(t[0].getFlags())):(e[this.currentAction]=!1,this.actions.setAbilities(e)),s?this.retryButton.setLabel(u.ui.msg("ooui-dialog-process-continue")):this.retryButton.setLabel(u.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(n),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-element-hidden").scrollTop(0)},u.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-element-hidden"),this.$errorItems&&(this.$errorItems.remove(),this.$errorItems=null)},u.ui.ProcessDialog.prototype.getTeardownProcess=function(t){return u.ui.ProcessDialog.super.prototype.getTeardownProcess.call(this,t).first(()=>{this.hideErrors(),this.fitOnOpen=!1})},u.ui.getWindowManager=function(){return u.ui.windowManager||(u.ui.windowManager=new u.ui.WindowManager,$(u.ui.getTeleportTarget()).append(u.ui.windowManager.$element),u.ui.windowManager.addWindows([new u.ui.MessageDialog])),u.ui.windowManager},u.ui.alert=function(t,e){return u.ui.getWindowManager().openWindow("message",Object.assign({message:t,actions:[u.ui.MessageDialog.static.actions[0]]},e)).closed.then(()=>{})},u.ui.confirm=function(t,e){return u.ui.getWindowManager().openWindow("message",Object.assign({message:t},e)).closed.then(t=>!(!t||"accept"!==t.action))},u.ui.prompt=function(t,e){const i=u.ui.getWindowManager(),o=new u.ui.TextInputWidget(e&&e.textInput||{}),n=new u.ui.FieldLayout(o,{align:"top",label:t});t=i.openWindow("message",Object.assign({message:n.$element},e));return t.opened.then(()=>{o.on("enter",()=>{i.getCurrentWindow().close({action:"accept"})}),o.focus()}),t.closed.then(t=>t&&"accept"===t.action?o.getValue():null)}}(OO);
//# sourceMappingURL=oojs-ui.min.js.map